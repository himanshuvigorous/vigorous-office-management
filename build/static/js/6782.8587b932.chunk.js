"use strict";(self.webpackChunkca_admin=self.webpackChunkca_admin||[]).push([[6782],{76782:(e,t,n)=>{n.r(t),n.d(t,{default:()=>E});var a=n(89379),o=n(53986),l=n(73216),i=n(83003),d=n(65043),s=n(30064),r=n.n(s),c=n(24858),p=(n(78729),n(15187)),u=n(60184),h=n(39160),m=n(23156),x=n(47196),v=n(31174),b=n(78227),j=n(735),w=n(65512),y=n(96651),N=n(4938),g=n(55971),k=n(86178),f=n.n(k),C=(n(33007),n(31744),n(42837)),D=n(58215),A=n(21541),I=n(60446),O=n.n(I),T=n(51371),S=n(16973),L=n(3825),M=n(89427),V=n(70579);const Y=["date","checkInTime","checkOutTime","timeDurationStart","timeDurationEnd"];const E=function(){const{canCreate:e,canRead:t,canUpdate:n,canDelete:s}=(0,N.A)(),{setValue:k,control:I}=(0,c.mN)(),{userCompanyId:E,userBranchId:_,userType:P}=(0,j.A)(),{visitorList:R,totalVisitorCount:z,visitorGeneralList:q,loading:F}=(0,i.d4)(e=>e.visitor),{departmentListData:H,loading:B}=(0,i.d4)(e=>e.department),{branchList:G,loading:J}=(0,i.d4)(e=>e.branch),K=JSON.parse(localStorage.getItem("user_info_".concat(p.AU))),{employeList:U,loading:W}=(0,i.d4)(e=>e.employe),Z=(0,l.Zp)(),$=(0,i.wA)(),[Q,X]=(0,d.useState)(""),[ee,te]=(0,d.useState)({data:null,isOpen:!1}),ne=((0,c.FH)({control:I,name:"PDCompanyId",defaultValue:E}),(0,c.FH)({control:I,name:"PDBranchId",defaultValue:_})),ae=(0,c.FH)({control:I,name:"PdDepartmentId",defaultValue:""}),oe=(0,c.FH)({control:I,name:"employee",defaultValue:""}),le=(0,c.FH)({control:I,name:"category",defaultValue:""}),[ie,de]=(0,d.useState)({isOpen:!1,data:null}),[se,re]=(0,d.useState)({}),[ce,pe]=(0,d.useState)(!1),[ue,he]=(0,d.useState)(""),[me,xe]=(0,d.useState)(1),ve=[ne,oe,ae,le,Q].join("-"),[be,je]=(0,d.useState)(!1);(0,d.useEffect)(()=>{be?1===me?we():xe(1):je(e=>!0)},[ve]),(0,d.useEffect)(()=>{"manager"===(null===K||void 0===K?void 0:K.roleKey)&&"employee"===(null===K||void 0===K?void 0:K.userType)&&we()},[me]);const we=()=>{const e={page:me,limit:10,reqPayload:{departmentId:null!==K&&void 0!==K&&K.departmentId?null===K||void 0===K?void 0:K.departmentId:"",companyId:null===K||void 0===K?void 0:K.companyId,branchId:null===K||void 0===K?void 0:K.branchId,directorId:"",employeId:oe,category:le,text:Q,sort:!0,status:"",isPagination:!0}};$((0,D.Jc)(e))},ye=(e,t)=>{he(t),pe(!0),re(e)};return"manager"!==(null===K||void 0===K?void 0:K.roleKey)||"employee"!==(null===K||void 0===K?void 0:K.userType)?(0,V.jsx)(h.A,{children:(0,V.jsx)("div",{className:"bg-red-100 text-red-800 p-4 rounded-md mt-2",children:(0,V.jsx)("p",{className:"text-center font-semibold",children:"You are not a Manager. This page is viewable for Manager only."})})}):(0,V.jsxs)(h.A,{onChange:e=>{X(e)},children:[(0,V.jsx)("div",{className:"",children:(0,V.jsxs)("div",{class:"xl:flex justify-between items-center py-1 xl:space-y-0 space-y-2 overflow-y-auto",children:[(0,V.jsxs)("div",{className:"grid sm:grid-cols-2 grid-cols-1 md:grid-cols-4 sm:gap-3 gap-1",children:[(0,V.jsx)("div",{className:"",children:(0,V.jsx)(c.xI,{control:I,name:"category",rules:{required:"category is required"},render:e=>{let{field:t}=e;return(0,V.jsxs)(w.A,(0,a.A)((0,a.A)({},t),{},{defaultValue:"",disabled:F,className:" ".concat(p.Lp," "),showSearch:!0,filterOption:(e,t)=>String(null===t||void 0===t?void 0:t.children).toLowerCase().includes(e.toLowerCase()),children:[(0,V.jsx)(w.A.Option,{className:"",value:"",children:"Select Category"}),(0,V.jsx)(w.A.Option,{value:"general",children:"General Visitor"}),(0,V.jsx)(w.A.Option,{value:"client",children:" Client Visitor"})]}))}})}),(0,V.jsx)("div",{className:"",children:(0,V.jsx)(c.xI,{name:"employee",control:I,render:e=>{var t;let{field:n}=e;return(0,V.jsxs)(w.A,(0,a.A)((0,a.A)({},n),{},{className:" ".concat(p.Lp," "),disabled:F,popupClassName:"!z-[1580]",placeholder:"Select Employee",showSearch:!0,filterOption:(e,t)=>String(null===t||void 0===t?void 0:t.children).toLowerCase().includes(e.toLowerCase()),optionLabelProp:"children",onFocus:()=>(()=>{const e={text:"",status:!0,sort:!0,isTL:"",isHR:"",isPagination:!1,designationId:"",departmentId:null!==K&&void 0!==K&&K.departmentId?null===K||void 0===K?void 0:K.departmentId:"",companyId:null===K||void 0===K?void 0:K.companyId,branchId:null===K||void 0===K?void 0:K.branchId};$((0,C.qV)(e))})(),children:[(0,V.jsx)(w.A.Option,{value:"",children:"Select Employee"}),W?(0,V.jsx)(w.A.Option,{disabled:!0,children:(0,V.jsx)(M.A,{})}):null===(t=(0,p._o)(U))||void 0===t?void 0:t.map(e=>(0,V.jsx)(w.A.Option,{value:e._id,children:e.fullName},e._id))]}))}})})]}),(0,V.jsxs)("div",{className:"flex justify-end items-center gap-2 ",children:[(0,V.jsx)("button",{onClick:()=>{k("employee",""),k("PDBranchId",""),k("PdDepartmentId",""),k("category",""),k("PdCompanyId","")},className:"bg-header   py-[6px]  rounded-md  flex px-5 justify-center items-center  text-white",children:(0,V.jsx)("span",{className:"text-[12px]",children:"Reset"})}),e&&(0,V.jsx)(y.A,{placement:"topLeft",title:"Add Visitor",children:(0,V.jsxs)("button",{onClick:()=>{Z("/admin/client-visitor/create")},className:"bg-header p-2 rounded-md flex justify-center items-center space-x-2 text-white",children:[(0,V.jsx)(u.OiG,{}),(0,V.jsx)("span",{className:"text-[12px] text-nowrap tracking-wide",children:"Add Visitor"})]})})]})]})}),(0,V.jsx)("div",{className:"bg-[#ffffff]  w-full overflow-x-auto mt-1 rounded-xl",children:t&&(0,V.jsxs)("table",{className:"w-full max-w-full rounded-xl overflow-x-auto ",children:[(0,V.jsx)("thead",{className:"",children:(0,V.jsxs)("tr",{className:"border-b-[1px] border-[#DDDDDD] capitalize text-[12px] bg-header text-white font-[500] h-[40px]",children:[(0,V.jsx)("th",{className:"border-none p-2 whitespace-nowrap w-[8%]",children:"S.no."}),(0,V.jsx)("th",{className:"border-none p-2 whitespace-nowrap",children:"Visitor Name"}),(0,V.jsx)("th",{className:"border-none p-2 whitespace-nowrap",children:"Category type"}),(0,V.jsx)("th",{className:"border-none p-2 whitespace-nowrap",children:"Mobile Number"}),(0,V.jsx)("th",{className:"border-none p-2 whitespace-nowrap",children:"Employees"}),(0,V.jsx)("th",{className:"border-none p-2 !w-12 whitespace-nowrap",children:"Reason"}),(0,V.jsx)("th",{className:"border-none p-2 whitespace-nowrap",children:"Expected Checkin"}),(0,V.jsx)("th",{className:"border-none p-2 whitespace-nowrap",children:"Expected CheckOut"}),(0,V.jsx)("th",{className:"border-none p-2 whitespace-nowrap w-[20%]",children:"Employee Checkin"}),(0,V.jsx)("th",{className:"border-none p-2 whitespace-nowrap",children:"Employee Checkout"}),(0,V.jsx)("th",{className:"border-none p-2 whitespace-nowrap",children:"Cashbook Status"}),(0,V.jsx)("th",{className:"border-none p-2 whitespace-nowrap",children:"KM"}),(s||n)&&(0,V.jsx)("th",{className:"border-none p-2 whitespace-nowrap w-[8%]",children:"Action"})]})}),F?(0,V.jsx)("tr",{className:"bg-white bg-opacity-5 ",children:(0,V.jsx)("td",{colSpan:10,className:"px-6 py-2 whitespace-nowrap font-[600] text-sm text-gray-500",children:(0,V.jsx)(g.A,{})})}):(0,V.jsx)("tbody",{children:q&&(null===q||void 0===q?void 0:q.length)>0?null===q||void 0===q?void 0:q.map((e,t)=>{var l,i,d,c,p,h,b,j,w,N,g,k,C,I,T,S;return(0,V.jsxs)("tr",{className:"border-b-[1px] border-[#DDDDDD] ".concat(t%2===0?"bg-[#e9ecef]/80":"bg-white"," text-[#374151] text-[14px]"),children:[(0,V.jsx)("td",{className:"whitespace-nowrap border-none p-2 ",children:t+1+10*(me-1)}),(0,V.jsx)("td",{className:"whitespace-nowrap border-none p-2 ",children:null!==(l=null===e||void 0===e?void 0:e.name)&&void 0!==l?l:"-"}),(0,V.jsx)("td",{className:"whitespace-nowrap border-none p-2 ",children:"client"==(null===e||void 0===e?void 0:e.category)?"Client Visit":"General Visit"}),(0,V.jsx)("td",{className:"whitespace-nowrap border-none p-2",children:(null===e||void 0===e||null===(i=e.mobile)||void 0===i?void 0:i.code)+" "+(null===e||void 0===e||null===(d=e.mobile)||void 0===d?void 0:d.number)||"-"}),(0,V.jsx)("td",{className:"whitespace-nowrap border-none p-2 ",children:(0,V.jsx)("div",{className:"  ",children:null===e||void 0===e||null===(c=e.employeData)||void 0===c?void 0:c.map((e,t)=>null===e||void 0===e?void 0:e.fullName,[])})}),(0,V.jsx)("td",{className:"whitespace-nowrap border-none !w-12 p-2 ",children:null!==(p=null===e||void 0===e?void 0:e.reason)&&void 0!==p?p:"-"}),(0,V.jsx)("td",{className:"whitespace-nowrap border-none p-2 ",children:null!==e&&void 0!==e&&e.timeDurationStart?f()(null===e||void 0===e?void 0:e.timeDurationStart).format("DD-MM-YYYY hh:mm a"):"-"}),(0,V.jsx)("td",{className:"whitespace-nowrap border-none p-2 ",children:null!==e&&void 0!==e&&e.timeDurationEnd?f()(null===e||void 0===e?void 0:e.timeDurationEnd).format("DD-MM-YYYY hh:mm a"):"-"}),(0,V.jsx)("td",{className:"whitespace-nowrap border-none p-2 ",children:(0,V.jsxs)("div",{className:"flex justify-center items-center gap-2",children:[null!==e&&void 0!==e&&e.checkInTime?f()(null===e||void 0===e?void 0:e.checkInTime).format("DD-MM-YYYY hh:mm a"):(0,V.jsx)(y.A,{placement:"topLeft",title:"Checkin",children:(0,V.jsx)("button",{onClick:()=>{(async e=>{var t,n;const l=await(0,A.Lu)(),i=await(0,A.Aw)(null===l||void 0===l?void 0:l.lat,null===l||void 0===l?void 0:l.lng),{date:d,checkInTime:s,checkOutTime:r,timeDurationStart:c,timeDurationEnd:p}=e,u=(0,o.A)(e,Y),h=(0,a.A)((0,a.A)({},u),{},{checkInTime:O()(),checkInLocation:{latitude:null!==(t=null===l||void 0===l?void 0:l.lat)&&void 0!==t?t:0,longitude:null!==(n=l.lng)&&void 0!==n?n:0,address:null!==i&&void 0!==i?i:""}});$((0,D.o2)(h)).then(e=>{e.error||we()})})(e)},className:"px-2 py-1.5 text-xs rounded-md bg-header text-white border border-muted",type:"button",children:"check in"})}),e.checkInTime?(0,V.jsx)(u.Ny1,{onClick:()=>ye(e,"checkin"),className:" hover:text-[#337ab7] text-[#3c8dbc]",size:14}):""]})}),(0,V.jsx)("td",{className:"whitespace-nowrap border-none p-2",children:(0,V.jsxs)("div",{className:"flex justify-center items-center gap-2",children:[null!==e&&void 0!==e&&e.checkInTime?null!==e&&void 0!==e&&e.checkOutTime?f()(e.checkOutTime).format("DD-MM-YYYY hh:mm a"):(0,V.jsx)(y.A,{placement:"topLeft",title:"Checkout",children:(0,V.jsx)("button",{onClick:()=>(e=>{te({data:e,isOpen:!0})})(e),className:"px-2 py-1.5 text-xs rounded-md bg-header text-white border border-muted",type:"button",children:"Check Out"})}):"-",e.checkOutTime?(0,V.jsx)(u.Ny1,{onClick:()=>ye(e,"checkout"),className:" hover:text-[#337ab7] text-[#3c8dbc]",size:14}):""]})}),(0,V.jsx)("td",{className:"whitespace-nowrap border-none p-2 ",children:null!==e&&void 0!==e&&null!==(h=e.cashbookData)&&void 0!==h&&h._id?"Pending"===(null===e||void 0===e||null===(b=e.cashbookData)||void 0===b?void 0:b.status)?"Cashbook Requested":"Approved"===(null===e||void 0===e||null===(j=e.cashbookData)||void 0===j?void 0:j.status)?"Cashbook Approved":"Reject"===(null===e||void 0===e||null===(w=e.cashbookData)||void 0===w?void 0:w.status)?"Claim Rejected":"-":"Not Claimed"}),(0,V.jsx)("td",{className:"whitespace-nowrap border-none p-2 ",children:null!==(N=null===e||void 0===e?void 0:e.kilometer)&&void 0!==N?N:"-"}),(s||n)&&(0,V.jsx)("td",{className:"whitespace-nowrap border-none p-2",children:(0,V.jsxs)("span",{className:"py-1.5 flex justify-start items-center space-x-2",children:[n&&(0,V.jsx)(y.A,{placement:"topLeft",title:null!==e&&void 0!==e&&e.checkInTime||null!==e&&void 0!==e&&e.checkOutTime?"No Actions":"Edit",children:(0,V.jsx)("button",{disabled:!!(null!==e&&void 0!==e&&e.checkInTime||null!==e&&void 0!==e&&e.checkOutTime),onClick:()=>{Z("/admin/client-visitor/edit/".concat((0,v.w)(null===e||void 0===e?void 0:e._id)))},className:"px-2 py-1.5 text-xs rounded-md bg-transparent border border-muted",type:"button",children:(0,V.jsx)(m.Jcp,{className:null!==e&&void 0!==e&&e.checkInTime||null!==e&&void 0!==e&&e.checkOutTime?"hover:text-gray-500 text-gray-500":"hover:text-[#337ab7] text-[#3c8dbc]",size:16})})}),n&&(0,V.jsx)(y.A,{placement:"topLeft",title:null!==e&&void 0!==e&&null!==(g=e.cashbookData)&&void 0!==g&&g._id?"Pending"===(null===e||void 0===e||null===(k=e.cashbookData)||void 0===k?void 0:k.status)?"Cashbook Requested":"Approved"===(null===e||void 0===e||null===(C=e.cashbookData)||void 0===C?void 0:C.status)?"Cashbook Approved":"Reject"===(null===e||void 0===e||null===(I=e.cashbookData)||void 0===I?void 0:I.status)?"Claim Rejected":"-":"Claim Cashbook",children:(0,V.jsx)("button",{disabled:null===e||void 0===e||null===(T=e.cashbookData)||void 0===T?void 0:T._id,onClick:()=>de({isOpen:!0,data:e}),className:"px-2 py-1.5 text-xs rounded-md bg-transparent border border-muted",type:"button",children:(0,V.jsx)(L.p9$,{className:null!==e&&void 0!==e&&null!==(S=e.cashbookData)&&void 0!==S&&S._id?" text-gray-500":" hover:text-[#337ab7] text-[#3c8dbc]",size:16})})}),s&&(0,V.jsx)(y.A,{placement:"topLeft",title:null!==e&&void 0!==e&&e.checkInTime||null!==e&&void 0!==e&&e.checkOutTime?"No Actions":"Delete",children:(0,V.jsx)("button",{disabled:!!(null!==e&&void 0!==e&&e.checkInTime||null!==e&&void 0!==e&&e.checkOutTime),onClick:()=>(e=>{let t={_id:e};r().fire({title:"Warning",text:"Are you sure you want to delete!",icon:"warning",showCancelButton:!0,cancelButtonText:"No"}).then(e=>{e.isConfirmed&&$((0,D.sn)(t)).then(e=>{me>1&&1==(null===q||void 0===q?void 0:q.length)?xe(Number(me-1)):!e.error&&we()})})})(null===e||void 0===e?void 0:e._id),className:"px-2 py-1.5 text-xs rounded-md bg-transparent border border-muted",type:"button",children:(0,V.jsx)(x.tqC,{className:null!==e&&void 0!==e&&e.checkInTime||null!==e&&void 0!==e&&e.checkOutTime?"hover:text-gray-500 text-gray-500":"text-red-600 hover:text-red-500",size:16})})})]})})]})}):(0,V.jsx)("tr",{className:"bg-white bg-opacity-5 ",children:(0,V.jsx)("td",{colSpan:4,className:"px-6 py-2 whitespace-nowrap font-[600] text-sm text-gray-500",children:"Record Not Found"})})})]})}),(0,V.jsx)(S.A,{visible:ie,onCancel:()=>de({isOpen:!1,data:null}),onSuccess:we}),(0,V.jsx)(A.Ay,{setVisitorModal:te,visitorModal:ee,updateList:we}),(0,V.jsx)(T.A,{empDetailModalData:se,empCheckInDetailModalOpen:ce,checkIn:ue,setEmpCheckinDetailModalOpen:pe}),(null===q||void 0===q?void 0:q.length)>0&&(0,V.jsx)(b.A,{totalCount:z,pageSize:10,currentPage:me,onChange:e=>{xe(e)}})]})}}}]);
//# sourceMappingURL=6782.8587b932.chunk.js.map