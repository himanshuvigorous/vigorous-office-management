"use strict";(self.webpackChunkca_admin=self.webpackChunkca_admin||[]).push([[59],{80059:(e,t,s)=>{s.r(t),s.d(t,{default:()=>T});var a=s(89379),l=s(73216),d=s(83003),n=s(65043),r=s(30064),o=s.n(r),i=s(23156),c=s(47196),u=s(24858),m=s(39160),x=s(31174),p=s(15187),v=s(78227),h=s(30326),b=s(53913),j=s(65512),g=s(96651),N=s(4938),y=s(60446),f=s.n(y),w=s(55971),C=s(31744),D=s(89427),k=s(57944),S=s(60397),A=s(60184),I=s(83002),_=s(32620),P=s(70579);const T=function(){const{register:e,setValue:t,control:s,formState:{errors:r}}=(0,u.mN)(),y=(0,l.Zp)(),T=(0,d.wA)(),{projectmanagementList:O,totalprojectManagementCount:L,loading:B}=(0,d.d4)(e=>e.projectManagement),[H,M]=(0,n.useState)(""),z=JSON.parse(localStorage.getItem("user_info_".concat(p.AU))),[F,V]=(0,n.useState)(1),{companyList:E}=(0,d.d4)(e=>e.company),{branchList:W,loading:Y}=(0,d.d4)(e=>e.branch),q=(0,u.FH)({control:s,name:"PDCompanyId",defaultValue:""}),J=(0,u.FH)({control:s,name:"PDBranchId",defaultValue:""}),G=(0,u.FH)({control:s,name:"status",defaultValue:""}),U=[q,J,G,H].join("-"),[R,Z]=(0,n.useState)(!1),[K,Q]=(0,n.useState)(!1),[X,$]=(0,n.useState)([]);(0,n.useEffect)(()=>{R?1===F?ee():V(1):Z(e=>!0)},[U]),(0,n.useEffect)(()=>{ee()},[F]);const ee=async()=>{const e={page:F,limit:10,reqPayload:{directorId:"",companyId:"admin"===(null===z||void 0===z?void 0:z.userType)?q:"company"===(null===z||void 0===z?void 0:z.userType)?null===z||void 0===z?void 0:z._id:null===z||void 0===z?void 0:z.companyId,branchId:"company"===(null===z||void 0===z?void 0:z.userType)||"admin"===(null===z||void 0===z?void 0:z.userType)||"companyDirector"===(null===z||void 0===z?void 0:z.userType)?J:"companyBranch"===(null===z||void 0===z?void 0:z.userType)?null===z||void 0===z?void 0:z._id:null===z||void 0===z?void 0:z.branchId,text:H,sort:!0,status:G,isPagination:!0}};await T((0,k.j5)(e))},{canCreate:te,canRead:se,canUpdate:ae,canDelete:le}=(0,N.A)();(0,n.useEffect)(()=>{(q||"company"===(null===z||void 0===z?void 0:z.userType)||"companyDirector"===(null===z||void 0===z?void 0:z.userType))&&T((0,C.d0)({text:"",sort:!0,status:!0,isPagination:!1,companyId:"admin"===(null===z||void 0===z?void 0:z.userType)?q:"company"===(null===z||void 0===z?void 0:z.userType)?null===z||void 0===z?void 0:z._id:null===z||void 0===z?void 0:z.companyId}))},[q]);const de=async(e,t)=>{let s={_id:e,status:t};if(["Completed","Delivered","ForceClosed"].includes(t)){const{value:e}=await o().fire({title:"Enter remarks and date for ".concat(t," status"),html:'<input id="swal-input1" class="swal2-input" placeholder="Enter remarks..."><input id="swal-input2" type="date" class="swal2-input">',focusConfirm:!1,showCancelButton:!0,preConfirm:()=>{const e=document.getElementById("swal-input1").value,t=document.getElementById("swal-input2").value;return e&&t||o().showValidationMessage("Both fields are required"),{remark:e,date:t}}});if(!e)return;s=(0,a.A)((0,a.A)({},s),{},{remark:e.remark,date:new Date(e.date).toISOString()})}try{await T((0,k.hm)(s)),ee()}catch(l){console.error("Error updating status:",l)}};return(0,P.jsxs)(m.A,{onChange:e=>{M(e)},children:[(0,P.jsx)("div",{className:"",children:(0,P.jsxs)("div",{class:"sm:flex justify-between items-center py-1 lg:space-y-0 space-y-2 overflow-y-auto",children:[(0,P.jsxs)("div",{className:"grid sm:grid-cols-2 grid-cols-1 lg:grid-cols-2 sm:gap-3 gap-1.5",children:["admin"===(null===z||void 0===z?void 0:z.userType)&&(0,P.jsxs)("div",{className:"",children:[(0,P.jsxs)("select",(0,a.A)((0,a.A)({},e("PDCompanyId",{required:"company is required"})),{},{className:" ".concat(p.OJ," ").concat(r.PDCompanyId?"border-[1px] ":"border-gray-300"),showSearch:!0,filterOption:(e,t)=>String(null===t||void 0===t?void 0:t.children).toLowerCase().includes(e.toLowerCase()),children:[(0,P.jsx)("option",{className:"",value:"",children:"Select Comapany"}),null===E||void 0===E?void 0:E.map(e=>(0,P.jsx)("option",{value:null===e||void 0===e?void 0:e._id,children:null===e||void 0===e?void 0:e.fullName}))]})),r.PDCompanyId&&(0,P.jsx)("p",{className:"text-red-500 text-sm",children:r.PDCompanyId.message})]}),("admin"===(null===z||void 0===z?void 0:z.userType)||"company"===(null===z||void 0===z?void 0:z.userType)||"companyDirector"===(null===z||void 0===z?void 0:z.userType))&&(0,P.jsxs)("div",{className:"",children:[(0,P.jsx)(u.xI,{name:"PDBranchId",control:s,rules:{required:"Branch is required"},render:e=>{var t;let{field:s}=e;return(0,P.jsxs)(j.A,(0,a.A)((0,a.A)({},s),{},{className:"".concat(p.Lp," ").concat(r.PDBranchId?"border-[1px] ":"border-gray-300"),showSearch:!0,filterOption:(e,t)=>String(null===t||void 0===t?void 0:t.children).toLowerCase().includes(e.toLowerCase()),placeholder:"Select Branch",children:[(0,P.jsx)(j.A.Option,{value:"",children:"Select Branch"}),Y?(0,P.jsx)(j.A.Option,{disabled:!0,children:(0,P.jsx)(D.A,{})}):null===(t=(0,p._o)(W))||void 0===t?void 0:t.map(e=>(0,P.jsx)(j.A.Option,{value:null===e||void 0===e?void 0:e._id,children:null===e||void 0===e?void 0:e.fullName},null===e||void 0===e?void 0:e._id))]}))}}),r.PDBranchId&&(0,P.jsx)("p",{className:"text-red-500 text-sm",children:r.PDBranchId.message})]}),(0,P.jsx)(u.xI,{name:"status",control:s,rules:{},render:e=>{let{field:t}=e;return(0,P.jsxs)(j.A,(0,a.A)((0,a.A)({},t),{},{className:" w-32 ".concat(p.Lp," ").concat(r.status?"border-[1px] ":"border-gray-300"),placeholder:"Select Status",showSearch:!0,filterOption:(e,t)=>String(null===t||void 0===t?void 0:t.children).toLowerCase().includes(e.toLowerCase()),children:[(0,P.jsx)(j.A.Option,{value:"",children:"Select Status"}),null===p.VL||void 0===p.VL?void 0:p.VL.map(e=>(0,P.jsxs)(j.A.Option,{value:e,children:[" ",e," "]},e))]}))}})]}),(0,P.jsxs)("div",{className:"flex justify-end items-center gap-2 ",children:[(0,P.jsx)("button",{onClick:()=>{t("status",""),t("PDBranchId",""),t("PdDepartmentId",""),t("PdCompanyId","")},className:"bg-header   py-[6px]  rounded-md  flex px-5 justify-center items-center  text-white",children:(0,P.jsx)("span",{className:"text-[12px]",children:"Reset"})}),te&&(0,P.jsx)(g.A,{placement:"topLeft",title:"",children:(0,P.jsxs)("button",{onClick:()=>{y("/admin/project-management/create")},className:"bg-header px-2 py-1.5 rounded-md flex whitespace-nowrap justify-center items-center space-x-2 text-white",children:[(0,P.jsx)(i.OiG,{}),(0,P.jsx)("span",{className:"text-[12px]",children:"Add New Project"})]})})]})]})}),(0,P.jsx)("div",{className:"bg-[#ffffff]  w-full overflow-x-auto mt-1 rounded-xl",children:se&&(0,P.jsxs)("table",{className:"w-full max-w-full rounded-xl overflow-x-auto",children:[(0,P.jsx)("thead",{className:"",children:(0,P.jsxs)("tr",{className:"border-b-[1px] border-[#DDDDDD] capitalize text-[12px] bg-header text-white font-[500] h-[40px]",children:[(0,P.jsx)("th",{className:"border-none p-2 w-[5%]",children:"S.No."}),(0,P.jsx)("th",{className:"border-none p-2 w-[15%]",children:"Project Code"}),(0,P.jsx)("th",{className:"border-none p-2 w-[20%]",children:"Title"}),(0,P.jsx)("th",{className:"border-none p-2 w-[15%]",children:"Customer"}),(0,P.jsx)("th",{className:"border-none p-2 w-[10%]",children:"Start Date"}),(0,P.jsx)("th",{className:"border-none p-2 w-[15%]",children:"Status"}),(0,P.jsx)("th",{className:"border-none p-2 w-[10%]",children:"Team Lead"}),(ae||le)&&(0,P.jsx)("th",{className:"border-none p-2 w-[10%]",children:"Action"})]})}),B?(0,P.jsx)("tr",{className:"bg-white bg-opacity-5",children:(0,P.jsx)("td",{colSpan:8,className:"px-6 py-2 whitespace-nowrap font-[600] text-sm text-gray-500",children:(0,P.jsx)(w.A,{})})}):(0,P.jsx)("tbody",{children:O&&(null===O||void 0===O?void 0:O.length)>0?null===O||void 0===O?void 0:O.map((e,t)=>{var s,a,l,d,n;return(0,P.jsxs)("tr",{className:"".concat(t%2===0?"bg-[#e9ecef]/80":"bg-white"," border-b-[1px] border-[#DDDDDD] text-[#374151] text-[14px]"),children:[(0,P.jsx)("td",{className:"p-2 text-center",children:t+1+10*(F-1)}),(0,P.jsx)("td",{className:"p-2",children:null!==(s=null===e||void 0===e?void 0:e.projectCode)&&void 0!==s?s:"-"}),(0,P.jsx)("td",{className:"p-2",children:null!==(a=null===e||void 0===e?void 0:e.title)&&void 0!==a?a:"-"}),(0,P.jsx)("td",{className:"p-2",children:null!==(l=null===e||void 0===e?void 0:e.customerName)&&void 0!==l?l:"-"}),(0,P.jsx)("td",{className:"p-2",children:null!==e&&void 0!==e&&e.startDate?f()(e.startDate).format("DD-MM-YYYY"):"-"}),(0,P.jsx)("td",{className:"p-2",children:(0,P.jsx)("div",{className:"flex flex-col gap-1",children:(0,P.jsx)("span",{className:"".concat("NotStarted"===(null===e||void 0===e?void 0:e.status)?"bg-yellow-100 border-yellow-500":"Working"===(null===e||void 0===e?void 0:e.status)?"bg-blue-100 border-blue-500":"OnHold"===(null===e||void 0===e?void 0:e.status)?"bg-orange-100 border-orange-500":"Completed"===(null===e||void 0===e?void 0:e.status)?"bg-green-100 border-green-500":"Maintenance"===(null===e||void 0===e?void 0:e.status)?"bg-purple-100 border-purple-500":"Delivered"===(null===e||void 0===e?void 0:e.status)?"bg-teal-100 border-teal-500":"ForceClosed"===(null===e||void 0===e?void 0:e.status)?"bg-red-100 border-red-500":"bg-gray-100 border-gray-500"," border-[1px] px-2 py-1 rounded-lg text-black text-[12px] inline-block"),children:null!==(d=null===e||void 0===e?void 0:e.status)&&void 0!==d?d:"-"})})}),(0,P.jsx)("td",{className:"p-2",children:null!==(n=null===e||void 0===e?void 0:e.teamLeadName)&&void 0!==n?n:"-"}),(ae||le)&&(0,P.jsx)("td",{className:"p-2",children:(0,P.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,P.jsx)("button",{onClick:()=>y("/admin/project-invoicing/".concat((0,x.w)(JSON.stringify(e)))),className:"p-1 text-xs rounded-md bg-transparent border border-muted",title:"View Status History",children:(0,P.jsx)(_.sNT,{className:"hover:text-[#337ab7] text-[#3c8dbc]",size:16})}),(0,P.jsx)("button",{onClick:()=>{return t=e.statusLogs,$(t),void Q(!0);var t},className:"p-1 text-xs rounded-md bg-transparent border border-muted",title:"View Status History",children:(0,P.jsx)(S.ZoW,{className:"hover:text-[#337ab7] text-[#3c8dbc]",size:16})}),ae&&(0,P.jsx)("button",{onClick:()=>y("/admin/project-management/edit/".concat((0,x.w)(e._id))),className:"p-1 text-xs rounded-md bg-transparent border border-muted",title:"Edit",children:(0,P.jsx)(i.Jcp,{className:"hover:text-[#337ab7] text-[#3c8dbc]",size:16})}),le&&(0,P.jsx)("button",{onClick:()=>(e=>{let t={_id:e};o().fire({title:"Warning",text:"Are you sure you want to delete!",icon:"warning",showCancelButton:!0,cancelButtonText:"No"}).then(e=>{e.isConfirmed&&T((0,k.GJ)(t)).then(e=>{F>1&&1==(null===O||void 0===O?void 0:O.length)?V(Number(F-1)):ee()})})})(e._id),className:"p-1 rounded-md bg-transparent border border-muted",title:"Delete",children:(0,P.jsx)(c.tqC,{className:"text-red-600 hover:text-red-500",size:16})}),(0,P.jsx)(h.A,{menu:{items:["Working"!==(null===e||void 0===e?void 0:e.status)&&{key:"Working",label:(0,P.jsxs)("span",{className:"flex items-center text-green-600 hover:text-green-500",children:[(0,P.jsx)(A.GH9,{className:"mr-2",size:16}),"Start Working"]}),onClick:()=>de(null===e||void 0===e?void 0:e._id,"Working")},"OnHold"!==(null===e||void 0===e?void 0:e.status)&&{key:"OnHold",label:(0,P.jsxs)("span",{className:"flex items-center text-amber-600 hover:text-amber-500",children:[(0,P.jsx)(A.cUV,{className:"mr-2",size:16}),"Put On Hold"]}),onClick:()=>de(null===e||void 0===e?void 0:e._id,"OnHold")},"Completed"!==(null===e||void 0===e?void 0:e.status)&&{key:"Completed",label:(0,P.jsxs)("span",{className:"flex items-center text-blue-600 hover:text-blue-500",children:[(0,P.jsx)(A.A7C,{className:"mr-2",size:16}),"Mark Completed"]}),onClick:()=>de(null===e||void 0===e?void 0:e._id,"Completed")},"Maintenance"!==(null===e||void 0===e?void 0:e.status)&&{key:"Maintenance",label:(0,P.jsxs)("span",{className:"flex items-center text-purple-600 hover:text-purple-500",children:[(0,P.jsx)(A.xdT,{className:"mr-2",size:16}),"Needs Maintenance"]}),onClick:()=>de(null===e||void 0===e?void 0:e._id,"Maintenance")},"Delivered"!==(null===e||void 0===e?void 0:e.status)&&{key:"Delivered",label:(0,P.jsxs)("span",{className:"flex items-center text-cyan-600 hover:text-cyan-500",children:[(0,P.jsx)(A.dv1,{className:"mr-2",size:16}),"Mark Delivered"]}),onClick:()=>de(null===e||void 0===e?void 0:e._id,"Delivered")},"ForceClosed"!==(null===e||void 0===e?void 0:e.status)&&{key:"ForceClosed",danger:!0,label:(0,P.jsxs)("span",{className:"flex items-center text-red-600 hover:text-red-500",children:[(0,P.jsx)(A.mal,{className:"mr-2",size:16}),"Force Close"]}),onClick:()=>de(null===e||void 0===e?void 0:e._id,"ForceClosed")}].filter(Boolean)},trigger:["click"],children:(0,P.jsx)("button",{className:"px-2 py-1.5 text-xs rounded-md bg-transparent border border-muted",type:"button",children:(0,P.jsx)(I.xWf,{className:"hover:text-[#337ab7] text-[#3c8dbc]",size:16})})})]})})]},e._id)}):(0,P.jsx)("tr",{className:"bg-white bg-opacity-5",children:(0,P.jsx)("td",{colSpan:8,className:"px-6 py-2 whitespace-nowrap font-[600] text-center text-sm text-gray-500",children:"data Not Found"})})})]})}),(0,P.jsx)(b.A,{title:"Project Status History",visible:K,onCancel:()=>Q(!1),footer:null,width:800,className:"antmodalclassName",children:(0,P.jsx)("div",{className:"max-h-[60vh] overflow-y-auto",children:(0,P.jsx)("div",{className:"timeline-container",children:null===X||void 0===X?void 0:X.map((e,t)=>(0,P.jsxs)("div",{className:"mb-6",children:[(0,P.jsxs)("div",{className:"flex justify-between items-start",children:[(0,P.jsxs)("div",{className:"flex items-center",children:[(0,P.jsx)("div",{className:"w-3 h-3 rounded-full ".concat("NotStarted"===e.status?"bg-yellow-500":"Working"===e.status?"bg-blue-500":"OnHold"===e.status?"bg-orange-500":"Completed"===e.status?"bg-green-500":"Maintenance"===e.status?"bg-purple-500":"Delivered"===e.status?"bg-teal-500":"ForceClosed"===e.status?"bg-red-500":"bg-gray-500")}),(0,P.jsxs)("div",{className:"ml-3",children:[(0,P.jsx)("div",{className:"font-medium",children:e.status}),(0,P.jsx)("div",{className:"text-sm text-gray-500",children:f()(e.date).format("DD-MM-YYYY HH:mm")})]})]}),(0,P.jsxs)("div",{className:"text-sm text-gray-500",children:["by ",e.userName," (",e.userType,")"]})]}),e.remark&&(0,P.jsx)("div",{className:"ml-6 mt-2 p-3 bg-gray-50 rounded text-sm",children:e.remark}),t<X.length-1&&(0,P.jsx)("div",{className:"ml-[5px] mt-2 h-4 border-l-2 border-dashed border-gray-300"})]},t))})})}),(null===O||void 0===O?void 0:O.length)>0&&(0,P.jsx)(v.A,{totalCount:L,pageSize:10,currentPage:F,onChange:e=>{V(e)}})]})}}}]);
//# sourceMappingURL=59.f818dacd.chunk.js.map