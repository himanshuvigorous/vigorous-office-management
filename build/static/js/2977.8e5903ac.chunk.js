"use strict";(self.webpackChunkca_admin=self.webpackChunkca_admin||[]).push([[2977],{32977:(e,t,n)=>{n.r(t),n.d(t,{default:()=>I});var l=n(89379),s=n(24858),i=n(83003),a=n(35475),o=n(73216),d=n(15187),r=n(65043),c=n(39160),m=n(65512),u=n(17995),v=n(89427),x=n(48883),p=n(31421),h=n(31174),j=n(53727),y=n(75337),b=n(97826),g=n(94084),A=n(86178),f=n.n(A),N=n(30064),S=n.n(N),T=n(70579);const I=function(){const{loading:e}=(0,i.d4)(e=>e.projectManagement),{register:t,handleSubmit:n,control:A,watch:N,formState:{errors:I},setValue:G,getValues:C}=(0,s.mN)({defaultValues:{billing:{duration:"Weekly",schedule:{weekly:{day:"Monday"},monthly:{date:1},quartAndYearly:{month:"January",date:1}}},projectType:"product",priority:"Medium",billingType:"isBillable",employeIds:[],items:[{type:"",amount:0,name:"",expenseId:"",serverId:"",GSTRate:0,GSTAmount:0,amountAfterGST:0,remark:""}],tags:[],filePath:[],subTotal:0,finalAmount:0}}),[O]=(0,a.ok)(),k=O.get("element")?(0,h.Yc)(O.get("element")):"",w=k?JSON.parse(k):"",_=(0,i.wA)(),q=(0,o.Zp)(),{ServerManagementList:Q,loading:F}=(JSON.parse(localStorage.getItem("user_info_".concat(d.AU))),(0,i.d4)(e=>e.serverManagement)),{projectserviceList:R,loading:D}=(0,i.d4)(e=>e.projectservice),{fields:B,append:M,remove:H}=(0,s.jz)({control:A,name:"items"}),J=(0,s.FH)({control:A,name:"items",defaultValue:[]});(0,r.useEffect)(()=>{const e=(J||[]).reduce((e,t)=>e+(Number(null===t||void 0===t?void 0:t.amount)||0),0),t=e;G("subTotal",e),G("finalAmount",t)},[J,G]),(0,r.useEffect)(()=>{_((0,x.dQ)({companyId:null===w||void 0===w?void 0:w.companyId,branchId:null===w||void 0===w?void 0:w.branchId,text:"",sort:!0,status:"",isPagination:!1})),_((0,p.J8)({companyId:null===w||void 0===w?void 0:w.companyId,branchId:null===w||void 0===w?void 0:w.branchId,text:"",sort:!0,status:"",isPagination:!1}))},[]);const L=(e,t,n)=>{const l=t*n/100,s=t+l;G("items.".concat(e,".GSTAmount"),l),G("items.".concat(e,".amountAfterGST"),s),P()},V=()=>(N("items")||[]).reduce((e,t)=>e+(t.amount||0),0),W=()=>(N("items")||[]).reduce((e,t)=>e+(t.GSTAmount||0),0),E=()=>(N("items")||[]).reduce((e,t)=>e+(t.amountAfterGST||0),0),P=()=>{const e=V(),t=W(),n=E();G("subTotal",e),G("GSTTotal",t),G("finalWithGSTAmount",n)};return(0,T.jsx)(c.A,{children:(0,T.jsx)("div",{className:"gap-4",children:(0,T.jsxs)("form",{autoComplete:"off",className:"mt-5 md:px-1",onSubmit:n(e=>{var t,n,l,s;const i={companyId:null===w||void 0===w?void 0:w.companyId,directorId:null===w||void 0===w?void 0:w.directorId,branchId:null===w||void 0===w?void 0:w.branchId,managerId:"",projectId:null===w||void 0===w?void 0:w._id,invoiceType:"debit",invoiceDate:(0,d.Tk)(null===e||void 0===e?void 0:e.invoiceDate),clientId:(null===w||void 0===w?void 0:w.clientId)||"",items:(null===(t=e.items)||void 0===t?void 0:t.map(e=>{var t,n;return{type:e.type,amount:e.amount?+e.amount:0,name:"service"===e.type?null===(t=R.find(t=>t._id===e.expenseId))||void 0===t?void 0:t.name:"server"===e.type?null===(n=Q.find(t=>t._id===e.expenseId))||void 0===n?void 0:n.serverName:null===e||void 0===e?void 0:e.name,expenseId:"service"===e.type?e.expenseId||"":null,serverId:"server"===e.type?e.expenseId||"":null,GSTRate:+(null===e||void 0===e?void 0:e.GSTRate),GSTAmount:+(null===e||void 0===e?void 0:e.GSTAmount),amountAfterGST:+(null===e||void 0===e?void 0:e.amountAfterGST),remark:e.remark||""}}))||[],subTotal:(null===(n=e.items)||void 0===n?void 0:n.length)>0?+e.subTotal:0,GSTTotal:(null===(l=e.items)||void 0===l?void 0:l.length)>0?+(null===e||void 0===e?void 0:e.GSTTotal):0,finalWithGSTAmount:(null===(s=e.items)||void 0===s?void 0:s.length)>0?+(null===e||void 0===e?void 0:e.finalWithGSTAmount):0,terms:""};S().fire({title:"Are you sure?",text:"Once submitted, this entry cannot be edited. Do you want to proceed?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, submit it!"}).then(e=>{e.isConfirmed&&_((0,b.zw)(i)).then(e=>{e.error||q(-1)})})}),children:[(0,T.jsxs)("div",{className:"p-2",children:[(0,T.jsx)("h2",{className:"text-lg font-semibold mb-4 text-gray-700 border-b pb-2",children:"Services & Servers"}),(0,T.jsxs)("div",{className:"space-y-4",children:[B.map((e,t)=>{var n,i,a,o,r,c,u,x,p,h,y,b,g,f,S,C,O,k,w,_;return(0,T.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-2 border rounded p-2",children:[(0,T.jsxs)("div",{className:"",children:[(0,T.jsx)("label",{className:"".concat(d.Q0),children:"Type"}),(0,T.jsx)(s.xI,{control:A,name:"items.".concat(t,".type"),rules:{required:"Type is required"},render:e=>{let{field:n}=e;return(0,T.jsxs)(m.A,(0,l.A)((0,l.A)({},n),{},{className:"".concat(d.Hy),placeholder:"Select Type",onChange:e=>{n.onChange(e),G("items.".concat(t,".expenseId"),""),G("items.".concat(t,".name"),"")},children:[(0,T.jsx)(m.A.Option,{value:"",children:"Select Type"}),["service","server","other"].map(e=>(0,T.jsx)(m.A.Option,{value:e,children:e.charAt(0).toUpperCase()+e.slice(1)},e))]}))}}),(null===(n=I.items)||void 0===n||null===(i=n[t])||void 0===i?void 0:i.type)&&(0,T.jsx)("p",{className:"text-red-500 text-sm",children:null===(a=I.items)||void 0===a||null===(o=a[t])||void 0===o||null===(r=o.type)||void 0===r?void 0:r.message})]}),(0,T.jsxs)("div",{className:"",children:[(0,T.jsx)("label",{className:"".concat(d.Q0),children:"service"===N("items.".concat(t,".type"))?"Service":"server"===N("items.".concat(t,".type"))?"Server":"Name"}),"other"===N("items.".concat(t,".type"))?(0,T.jsx)(s.xI,{name:"items.".concat(t,".name"),control:A,rules:{required:"Name is required"},render:e=>{let{field:t}=e;return(0,T.jsx)("input",(0,l.A)((0,l.A)({},t),{},{type:"text",className:"".concat(d.Ol),placeholder:"Enter name"}))}}):(0,T.jsx)(s.xI,{control:A,name:"items.".concat(t,".expenseId"),rules:{required:"".concat("service"===N("items.".concat(t,".type"))?"Service":"Server"," is required")},render:e=>{var n,s;let{field:i}=e;return(0,T.jsxs)(m.A,(0,l.A)((0,l.A)({},i),{},{loading:"service"===N("items.".concat(t,".type"))?D:F,className:"".concat(d.Hy),showSearch:!0,filterOption:(e,t)=>String(null===t||void 0===t?void 0:t.children).toLowerCase().includes(e.toLowerCase()),onChange:(e,n)=>{i.onChange(e);const l=(null===n||void 0===n?void 0:n.children)||"";G("items.".concat(t,".name"),l)},children:[(0,T.jsxs)(m.A.Option,{value:"",children:["Select ","service"===N("items.".concat(t,".type"))?"Service":"Server"]}),"service"===N("items.".concat(t,".type"))?D?(0,T.jsx)(m.A.Option,{disabled:!0,children:(0,T.jsx)(v.A,{})}):null===(n=(0,d._o)(R,"name"))||void 0===n?void 0:n.map(e=>(0,T.jsx)(m.A.Option,{value:null===e||void 0===e?void 0:e._id,children:null===e||void 0===e?void 0:e.name},null===e||void 0===e?void 0:e._id)):F?(0,T.jsx)(m.A.Option,{disabled:!0,children:(0,T.jsx)(v.A,{})}):null===(s=(0,d._o)(Q,"serverName"))||void 0===s?void 0:s.map(e=>(0,T.jsx)(m.A.Option,{value:null===e||void 0===e?void 0:e._id,children:null===e||void 0===e?void 0:e.serverName},null===e||void 0===e?void 0:e._id))]}))}}),(null===(c=I.items)||void 0===c||null===(u=c[t])||void 0===u?void 0:u.expenseId)&&"other"!==N("items.".concat(t,".type"))&&(0,T.jsx)("p",{className:"text-red-500 text-sm",children:null===(x=I.items)||void 0===x||null===(p=x[t])||void 0===p||null===(h=p.expenseId)||void 0===h?void 0:h.message}),(null===(y=I.items)||void 0===y||null===(b=y[t])||void 0===b?void 0:b.name)&&"other"===N("items.".concat(t,".type"))&&(0,T.jsx)("p",{className:"text-red-500 text-sm",children:null===(g=I.items)||void 0===g||null===(f=g[t])||void 0===f||null===(S=f.name)||void 0===S?void 0:S.message})]}),(0,T.jsxs)("div",{className:"",children:[(0,T.jsx)("label",{className:"".concat(d.Q0),children:"Amount"}),(0,T.jsx)(s.xI,{name:"items.".concat(t,".amount"),control:A,rules:{required:"Amount is required",min:0},render:e=>{let{field:n}=e;return(0,T.jsx)("input",(0,l.A)((0,l.A)({},n),{},{type:"number",step:"0.01",min:"0",className:"".concat(d.Ol),placeholder:"Amount",onChange:e=>{const l=parseFloat(e.target.value)||0;n.onChange(l);const s=N("items.".concat(t,".GSTRate"))||0;L(t,l,s)}}))}}),(null===(C=I.items)||void 0===C||null===(O=C[t])||void 0===O?void 0:O.amount)&&(0,T.jsx)("p",{className:"text-red-500 text-sm",children:null===(k=I.items)||void 0===k||null===(w=k[t])||void 0===w||null===(_=w.amount)||void 0===_?void 0:_.message})]}),(0,T.jsxs)("div",{className:"",children:[(0,T.jsx)("label",{className:"".concat(d.Q0),children:"GST %"}),(0,T.jsx)(s.xI,{name:"items.".concat(t,".GSTRate"),control:A,render:e=>{let{field:n}=e;return(0,T.jsxs)(m.A,(0,l.A)((0,l.A)({},n),{},{className:"".concat(d.Hy),placeholder:"GST %",onChange:e=>{n.onChange(e);const l=N("items.".concat(t,".amount"))||0;L(t,l,e)},children:[(0,T.jsx)(m.A.Option,{value:0,children:"0%"}),(0,T.jsx)(m.A.Option,{value:5,children:"5%"}),(0,T.jsx)(m.A.Option,{value:12,children:"12%"}),(0,T.jsx)(m.A.Option,{value:18,children:"18%"}),(0,T.jsx)(m.A.Option,{value:28,children:"28%"})]}))}})]}),(0,T.jsxs)("div",{className:"",children:[(0,T.jsx)("label",{className:"".concat(d.Q0),children:"GST Amt"}),(0,T.jsxs)("div",{className:"".concat(d.Ol," bg-gray-100 flex items-center justify-center"),children:["\u20b9",(N("items.".concat(t,".GSTAmount"))||0).toFixed(2)]})]}),(0,T.jsxs)("div",{className:"",children:[(0,T.jsx)("label",{className:"".concat(d.Q0),children:"Total"}),(0,T.jsxs)("div",{className:"".concat(d.Ol," bg-gray-100 flex items-center justify-center"),children:["\u20b9",(N("items.".concat(t,".amountAfterGST"))||0).toFixed(2)]})]}),(0,T.jsxs)("div",{className:"flex items-end md:col-span-2 w-full",children:[(0,T.jsxs)("div",{className:"w-full",children:[(0,T.jsx)("label",{className:"".concat(d.Q0),children:"Remark"}),(0,T.jsx)(s.xI,{name:"items.".concat(t,".remark"),control:A,render:e=>{let{field:t}=e;return(0,T.jsx)("input",(0,l.A)((0,l.A)({},t),{},{type:"text",className:"".concat(d.Ol," flex-grow"),placeholder:"Remark"}))}})]}),(0,T.jsx)("button",{type:"button",onClick:()=>H(t),className:"ml-2 text-red-500 h-10 px-2 flex items-center justify-center bg-red-50 rounded",children:(0,T.jsx)(j.A,{})})]})]},e.id)}),(0,T.jsxs)("button",{type:"button",onClick:()=>M({type:"",expenseId:"",name:"",amount:0,GSTRate:0,GSTAmount:0,amountAfterGST:0,remark:""}),className:"mt-2 text-blue-500 flex items-center",children:[(0,T.jsx)(y.A,{className:"mr-1"})," Add Item"]})]})]}),(0,T.jsxs)("div",{className:"p-2",children:[(0,T.jsx)("h2",{className:"text-lg font-semibold mb-4 text-gray-700 border-b pb-2",children:"Financial Summary"}),(0,T.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,T.jsxs)("div",{className:"bg-blue-50 p-3 rounded",children:[(0,T.jsx)("p",{className:"text-gray-600",children:"Subtotal:"}),(0,T.jsxs)("p",{className:"text-xl font-bold text-blue-600",children:["\u20b9",V().toFixed(2)]})]}),(0,T.jsxs)("div",{className:"bg-green-50 p-3 rounded",children:[(0,T.jsx)("p",{className:"text-gray-600",children:"Total GST:"}),(0,T.jsxs)("p",{className:"text-xl font-bold text-green-600",children:["\u20b9",W().toFixed(2)]})]}),(0,T.jsxs)("div",{className:"bg-purple-50 p-3 rounded",children:[(0,T.jsx)("p",{className:"text-gray-600",children:"Total with GST:"}),(0,T.jsxs)("p",{className:"text-xl font-bold text-purple-600",children:["\u20b9",E().toFixed(2)]})]})]})]}),(0,T.jsxs)("div",{children:[(0,T.jsxs)("label",{className:"".concat(d.Q0),children:["Invoice Date ",(0,T.jsx)("span",{className:"text-red-600",children:"*"})]}),(0,T.jsx)(s.xI,{name:"invoiceDate",control:A,rules:{required:"Invoice date is required"},render:e=>{let{field:t}=e;return(0,T.jsx)(g.A,{field:t,errors:I,disabledDate:e=>e&&e.isAfter(f()(),"day")})}}),I.invoiceDate&&(0,T.jsx)("p",{className:"text-red-500 text-sm",children:"Invoice date is required"})]}),(0,T.jsx)("div",{className:"flex justify-end",children:(0,T.jsx)("button",{type:"submit",disabled:e,className:"".concat(e?"bg-gray-400":"bg-header"," text-white p-2 px-4 rounded mt-3"),children:e?(0,T.jsx)(u.A,{}):"Create Invoice"})})]})})})}}}]);
//# sourceMappingURL=2977.8e5903ac.chunk.js.map