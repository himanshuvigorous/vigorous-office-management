"use strict";(self.webpackChunkca_admin=self.webpackChunkca_admin||[]).push([[4766],{34766:(e,t,n)=>{n.r(t),n.d(t,{default:()=>F});var a=n(89379),l=n(53986),o=n(73216),i=n(83003),d=n(65043),s=n(30064),r=n.n(s),c=n(24858),u=n(78729),p=n(15187),h=n(60184),m=n(39160),v=n(23156),x=n(47196),b=n(31174),j=n(78227),w=n(735),y=n(65512),f=n(96651),N=n(4938),g=n(55971),k=n(86178),D=n.n(k),A=n(33007),C=n(31744),I=n(42837),O=n(58215),T=n(21541),S=n(60446),L=n.n(S),Y=n(51371),V=n(16973),_=n(3825),M=n(89427),P=n(94084),E=n(70579);const q=["date","checkInTime","checkOutTime","timeDurationStart","timeDurationEnd"];const F=function(){const{canCreate:e,canRead:t,canUpdate:n,canDelete:s}=(0,N.A)(),{setValue:k,control:S}=(0,c.mN)(),{userCompanyId:F,userBranchId:R,userType:z}=(0,w.A)(),{visitorList:B,totalVisitorCount:H,visitorGeneralList:G,loading:U}=(0,i.d4)(e=>e.visitor),{departmentListData:J,loading:K}=(0,i.d4)(e=>e.department),{branchList:W,loading:Z}=(0,i.d4)(e=>e.branch),$=JSON.parse(localStorage.getItem("user_info_".concat(p.AU))),{employeList:Q,loading:X}=(0,i.d4)(e=>e.employe),ee=(0,o.Zp)(),te=(0,i.wA)(),[ne,ae]=(0,d.useState)(""),[le,oe]=(0,d.useState)({data:null,isOpen:!1}),ie=(0,c.FH)({control:S,name:"PDCompanyId",defaultValue:F}),de=(0,c.FH)({control:S,name:"PDBranchId",defaultValue:R}),se=(0,c.FH)({control:S,name:"PdDepartmentId",defaultValue:""}),re=(0,c.FH)({control:S,name:"employee",defaultValue:""}),ce=(0,c.FH)({control:S,name:"startDate",defaultValue:""}),ue=(0,c.FH)({control:S,name:"endDate",defaultValue:""}),pe=(0,c.FH)({control:S,name:"category",defaultValue:""}),[he,me]=(0,d.useState)({isOpen:!1,data:null}),[ve,xe]=(0,d.useState)({}),[be,je]=(0,d.useState)(!1),[we,ye]=(0,d.useState)("");(0,d.useEffect)(()=>{"admin"===z&&te((0,u.Ar)({text:"",sort:!0,status:!0,isPagination:!1}))},[]);const[fe,Ne]=(0,d.useState)(1),ge=[de,re,se,pe,ne,ce,ue].join("-"),[ke,De]=(0,d.useState)(!1);(0,d.useEffect)(()=>{ke?1===fe?Ae():Ne(1):De(e=>!0)},[ge]),(0,d.useEffect)(()=>{Ae()},[fe]);const Ae=()=>{var e,t;const n={page:fe,limit:10,reqPayload:{companyId:ie,branchId:de,directorId:"",employeId:re,category:pe,departmentId:se,text:ne,sort:!0,status:"",isPagination:!0,startDate:ce?null===(e=L()(ce))||void 0===e?void 0:e.format("YYYY-MM-DD"):null,endDate:ue?null===(t=L()(ue))||void 0===t?void 0:t.format("YYYY-MM-DD"):null}};te((0,O.Jc)(n))},Ce=(e,t)=>{ye(t),je(!0),xe(e)};return(0,E.jsxs)(m.A,{onChange:e=>{ae(e)},children:[(0,E.jsx)("div",{className:"",children:(0,E.jsxs)("div",{class:"xl:flex justify-between items-center py-1 xl:space-y-0 space-y-2 overflow-y-auto",children:[(0,E.jsxs)("div",{className:"grid sm:grid-cols-2 grid-cols-1 md:grid-cols-6 sm:gap-3 gap-1",children:[(0,E.jsx)("div",{className:"",children:(0,E.jsx)(c.xI,{control:S,name:"category",rules:{required:"category is required"},render:e=>{let{field:t}=e;return(0,E.jsxs)(y.A,(0,a.A)((0,a.A)({},t),{},{defaultValue:"",disabled:U,className:" ".concat(p.Lp," "),showSearch:!0,filterOption:(e,t)=>String(null===t||void 0===t?void 0:t.children).toLowerCase().includes(e.toLowerCase()),children:[(0,E.jsx)(y.A.Option,{className:"",value:"",children:"Select Category"}),(0,E.jsx)(y.A.Option,{value:"general",children:"General Visitor"}),(0,E.jsx)(y.A.Option,{value:"client",children:" Client Visitor"})]}))}})}),("admin"===(null===$||void 0===$?void 0:$.userType)||"company"===(null===$||void 0===$?void 0:$.userType)||"companyDirector"===(null===$||void 0===$?void 0:$.userType))&&(0,E.jsx)("div",{className:"",children:(0,E.jsx)(c.xI,{control:S,name:"PDBranchId",rules:{required:"Branch is required"},render:e=>{var t;let{field:n}=e;return(0,E.jsxs)(y.A,(0,a.A)((0,a.A)({},n),{},{defaultValue:"",disabled:U,onFocus:()=>{te((0,C.d0)({text:"",sort:!0,status:!0,isPagination:!1,companyId:"admin"===(null===$||void 0===$?void 0:$.userType)?ie:"company"===(null===$||void 0===$?void 0:$.userType)?null===$||void 0===$?void 0:$._id:null===$||void 0===$?void 0:$.companyId}))},className:"".concat(p.Lp," "),showSearch:!0,filterOption:(e,t)=>String(null===t||void 0===t?void 0:t.children).toLowerCase().includes(e.toLowerCase()),children:[(0,E.jsx)(y.A.Option,{value:"",children:"Select Branch"}),Z?(0,E.jsx)(y.A.Option,{disabled:!0,children:(0,E.jsx)(M.A,{})}):null===(t=(0,p._o)(W))||void 0===t?void 0:t.map(e=>(0,E.jsx)(y.A.Option,{value:null===e||void 0===e?void 0:e._id,children:null===e||void 0===e?void 0:e.fullName},null===e||void 0===e?void 0:e._id))]}))}})}),(0,E.jsx)("div",{className:"",children:(0,E.jsx)(c.xI,{control:S,name:"PdDepartmentId",rules:{required:"Department is required"},render:e=>{var t;let{field:n}=e;return(0,E.jsxs)(y.A,(0,a.A)((0,a.A)({},n),{},{defaultValue:"",disabled:U,onFocus:()=>{te((0,A.UU)({text:"",sort:!0,status:!0,companyId:"admin"===(null===$||void 0===$?void 0:$.userType)?ie:"company"===(null===$||void 0===$?void 0:$.userType)?null===$||void 0===$?void 0:$._id:null===$||void 0===$?void 0:$.companyId,branchId:de,isPagination:!1}))},className:"".concat(p.Lp," "),showSearch:!0,filterOption:(e,t)=>String(null===t||void 0===t?void 0:t.children).toLowerCase().includes(e.toLowerCase()),children:[(0,E.jsx)(y.A.Option,{value:"",children:"Select Department"}),K?(0,E.jsx)(y.A.Option,{disabled:!0,children:(0,E.jsx)(M.A,{})}):null===(t=(0,p._o)(J))||void 0===t?void 0:t.map(e=>(0,E.jsx)(y.A.Option,{value:null===e||void 0===e?void 0:e._id,children:null===e||void 0===e?void 0:e.name},null===e||void 0===e?void 0:e._id))]}))}})}),(0,E.jsx)("div",{className:"",children:(0,E.jsx)(c.xI,{name:"employee",control:S,render:e=>{var t;let{field:n}=e;return(0,E.jsxs)(y.A,(0,a.A)((0,a.A)({},n),{},{className:" ".concat(p.Lp," "),disabled:U,popupClassName:"!z-[1580]",placeholder:"Select Employee",showSearch:!0,filterOption:(e,t)=>String(null===t||void 0===t?void 0:t.children).toLowerCase().includes(e.toLowerCase()),optionLabelProp:"children",onFocus:()=>(()=>{const e={text:"",status:!0,sort:!0,isTL:"",isHR:"",isPagination:!1,designationId:"",departmentId:"",companyId:ie,branchId:de};te((0,I.qV)(e))})(),children:[(0,E.jsx)(y.A.Option,{value:"",children:"Select Employee"}),X?(0,E.jsx)(y.A.Option,{disabled:!0,children:(0,E.jsx)(M.A,{})}):null===(t=(0,p._o)(Q))||void 0===t?void 0:t.map(e=>(0,E.jsx)(y.A.Option,{value:e._id,children:e.fullName},e._id))]}))}})}),(0,E.jsx)(c.xI,{name:"startDate",control:S,render:e=>{let{field:t}=e;return(0,E.jsx)(P.A,{report:!0,defaultValue:L()().subtract(1,"month"),size:"middle",field:t})}}),(0,E.jsx)(c.xI,{name:"endDate",control:S,render:e=>{let{field:t}=e;return(0,E.jsx)(P.A,{report:!0,defaultValue:L()(),size:"middle",field:t})}})]}),(0,E.jsxs)("div",{className:"flex justify-end items-center gap-2 ",children:[(0,E.jsx)("button",{onClick:()=>{k("employee",""),k("PDBranchId",""),k("PdDepartmentId",""),k("category",""),k("PdCompanyId",""),k("startDate",null),k("endDate",null)},className:"bg-header   py-[6px]  rounded-md  flex px-5 justify-center items-center  text-white",children:(0,E.jsx)("span",{className:"text-[12px]",children:"Reset"})}),e&&(0,E.jsx)(f.A,{placement:"topLeft",title:"Add Visitor",children:(0,E.jsxs)("button",{onClick:()=>{ee("/admin/client-visitor/create")},className:"bg-header p-2 rounded-md flex justify-center items-center space-x-2 text-white",children:[(0,E.jsx)(h.OiG,{}),(0,E.jsx)("span",{className:"text-[12px] text-nowrap tracking-wide",children:"Add Visitor"})]})})]})]})}),(0,E.jsx)("div",{className:"bg-[#ffffff]  w-full overflow-x-auto mt-1 rounded-xl",children:t&&(0,E.jsxs)("table",{className:"w-full max-w-full rounded-xl overflow-x-auto ",children:[(0,E.jsx)("thead",{className:"",children:(0,E.jsxs)("tr",{className:"border-b-[1px] border-[#DDDDDD] capitalize text-[12px] bg-header text-white font-[500] h-[40px]",children:[(0,E.jsx)("th",{className:"border-none p-2 whitespace-nowrap w-[8%]",children:"S.no."}),(0,E.jsx)("th",{className:"border-none p-2 whitespace-nowrap",children:"Visitor Name"}),(0,E.jsx)("th",{className:"border-none p-2 whitespace-nowrap",children:"Category type"}),(0,E.jsx)("th",{className:"border-none p-2 whitespace-nowrap",children:"Mobile Number"}),(0,E.jsx)("th",{className:"border-none p-2 whitespace-nowrap",children:"Employees"}),(0,E.jsx)("th",{className:"border-none p-2 !w-12 whitespace-nowrap",children:"Reason"}),(0,E.jsx)("th",{className:"border-none p-2 whitespace-nowrap",children:"Expected Checkin"}),(0,E.jsx)("th",{className:"border-none p-2 whitespace-nowrap",children:"Expected CheckOut"}),(0,E.jsx)("th",{className:"border-none p-2 whitespace-nowrap w-[20%]",children:"Employee Checkin"}),(0,E.jsx)("th",{className:"border-none p-2 whitespace-nowrap",children:"Employee Checkout"}),(0,E.jsx)("th",{className:"border-none p-2 whitespace-nowrap",children:"Cashbook Status"}),(0,E.jsx)("th",{className:"border-none p-2 whitespace-nowrap",children:"KM"}),(s||n)&&(0,E.jsx)("th",{className:"border-none p-2 whitespace-nowrap w-[8%]",children:"Action"})]})}),U?(0,E.jsx)("tr",{className:"bg-white bg-opacity-5 ",children:(0,E.jsx)("td",{colSpan:10,className:"px-6 py-2 whitespace-nowrap font-[600] text-sm text-gray-500",children:(0,E.jsx)(g.A,{})})}):(0,E.jsx)("tbody",{children:G&&(null===G||void 0===G?void 0:G.length)>0?null===G||void 0===G?void 0:G.map((e,t)=>{var o,i,d,c,u,p,m,j,w,y,N,g,k,A,C,I;return(0,E.jsxs)("tr",{className:"border-b-[1px] border-[#DDDDDD] ".concat(t%2===0?"bg-[#e9ecef]/80":"bg-white"," text-[#374151] text-[14px]"),children:[(0,E.jsx)("td",{className:"whitespace-nowrap border-none p-2 ",children:t+1+10*(fe-1)}),(0,E.jsx)("td",{className:"whitespace-nowrap border-none p-2 ",children:null!==(o=null===e||void 0===e?void 0:e.name)&&void 0!==o?o:"-"}),(0,E.jsx)("td",{className:"whitespace-nowrap border-none p-2 ",children:"client"==(null===e||void 0===e?void 0:e.category)?"Client Visit":"General Visit"}),(0,E.jsx)("td",{className:"whitespace-nowrap border-none p-2",children:(null===e||void 0===e||null===(i=e.mobile)||void 0===i?void 0:i.code)+" "+(null===e||void 0===e||null===(d=e.mobile)||void 0===d?void 0:d.number)||"-"}),(0,E.jsx)("td",{className:"whitespace-nowrap border-none p-2 ",children:(0,E.jsx)("div",{className:"  ",children:null===e||void 0===e||null===(c=e.employeData)||void 0===c?void 0:c.map((e,t)=>null===e||void 0===e?void 0:e.fullName,[])})}),(0,E.jsx)("td",{className:"whitespace-nowrap border-none !w-12 p-2 ",children:null!==(u=null===e||void 0===e?void 0:e.reason)&&void 0!==u?u:"-"}),(0,E.jsx)("td",{className:"whitespace-nowrap border-none p-2 ",children:null!==e&&void 0!==e&&e.timeDurationStart?D()(null===e||void 0===e?void 0:e.timeDurationStart).format("DD-MM-YYYY hh:mm a"):"-"}),(0,E.jsx)("td",{className:"whitespace-nowrap border-none p-2 ",children:null!==e&&void 0!==e&&e.timeDurationEnd?D()(null===e||void 0===e?void 0:e.timeDurationEnd).format("DD-MM-YYYY hh:mm a"):"-"}),(0,E.jsx)("td",{className:"whitespace-nowrap border-none p-2 ",children:(0,E.jsxs)("div",{className:"flex justify-center items-center gap-2",children:[null!==e&&void 0!==e&&e.checkInTime?D()(null===e||void 0===e?void 0:e.checkInTime).format("DD-MM-YYYY hh:mm a"):(0,E.jsx)(f.A,{placement:"topLeft",title:"Checkin",children:(0,E.jsx)("button",{onClick:()=>{(async e=>{var t,n;const o=await(0,T.Lu)(),i=await(0,T.Aw)(null===o||void 0===o?void 0:o.lat,null===o||void 0===o?void 0:o.lng),{date:d,checkInTime:s,checkOutTime:r,timeDurationStart:c,timeDurationEnd:u}=e,p=(0,l.A)(e,q),h=(0,a.A)((0,a.A)({},p),{},{checkInTime:L()(),checkInLocation:{latitude:null!==(t=null===o||void 0===o?void 0:o.lat)&&void 0!==t?t:0,longitude:null!==(n=o.lng)&&void 0!==n?n:0,address:null!==i&&void 0!==i?i:""}});te((0,O.o2)(h)).then(e=>{e.error||Ae()})})(e)},className:"px-2 py-1.5 text-xs rounded-md bg-header text-white border border-muted",type:"button",children:"check in"})}),e.checkInTime?(0,E.jsx)(h.Ny1,{onClick:()=>Ce(e,"checkin"),className:" hover:text-[#337ab7] text-[#3c8dbc]",size:14}):""]})}),(0,E.jsx)("td",{className:"whitespace-nowrap border-none p-2",children:(0,E.jsxs)("div",{className:"flex justify-center items-center gap-2",children:[null!==e&&void 0!==e&&e.checkInTime?null!==e&&void 0!==e&&e.checkOutTime?D()(e.checkOutTime).format("DD-MM-YYYY hh:mm a"):(0,E.jsx)(f.A,{placement:"topLeft",title:"Checkout",children:(0,E.jsx)("button",{onClick:()=>(e=>{oe({data:e,isOpen:!0})})(e),className:"px-2 py-1.5 text-xs rounded-md bg-header text-white border border-muted",type:"button",children:"Check Out"})}):"-",e.checkOutTime?(0,E.jsx)(h.Ny1,{onClick:()=>Ce(e,"checkout"),className:" hover:text-[#337ab7] text-[#3c8dbc]",size:14}):""]})}),(0,E.jsx)("td",{className:"whitespace-nowrap border-none p-2 ",children:null!==e&&void 0!==e&&null!==(p=e.cashbookData)&&void 0!==p&&p._id?"Pending"===(null===e||void 0===e||null===(m=e.cashbookData)||void 0===m?void 0:m.status)?"Cashbook Requested":"Approved"===(null===e||void 0===e||null===(j=e.cashbookData)||void 0===j?void 0:j.status)?"Cashbook Approved":"Reject"===(null===e||void 0===e||null===(w=e.cashbookData)||void 0===w?void 0:w.status)?"Claim Rejected":"-":"Not Claimed"}),(0,E.jsx)("td",{className:"whitespace-nowrap border-none p-2 ",children:null!==(y=null===e||void 0===e?void 0:e.kilometer)&&void 0!==y?y:"-"}),(s||n)&&(0,E.jsx)("td",{className:"whitespace-nowrap border-none p-2",children:(0,E.jsxs)("span",{className:"py-1.5 flex justify-start items-center space-x-2",children:[n&&(0,E.jsx)(f.A,{placement:"topLeft",title:null!==e&&void 0!==e&&e.checkInTime||null!==e&&void 0!==e&&e.checkOutTime?"No Actions":"Edit",children:(0,E.jsx)("button",{disabled:!!(null!==e&&void 0!==e&&e.checkInTime||null!==e&&void 0!==e&&e.checkOutTime),onClick:()=>{ee("/admin/client-visitor/edit/".concat((0,b.w)(null===e||void 0===e?void 0:e._id)))},className:"px-2 py-1.5 text-xs rounded-md bg-transparent border border-muted",type:"button",children:(0,E.jsx)(v.Jcp,{className:null!==e&&void 0!==e&&e.checkInTime||null!==e&&void 0!==e&&e.checkOutTime?"hover:text-gray-500 text-gray-500":"hover:text-[#337ab7] text-[#3c8dbc]",size:16})})}),n&&(0,E.jsx)(f.A,{placement:"topLeft",title:null!==e&&void 0!==e&&null!==(N=e.cashbookData)&&void 0!==N&&N._id?"Pending"===(null===e||void 0===e||null===(g=e.cashbookData)||void 0===g?void 0:g.status)?"Cashbook Requested":"Approved"===(null===e||void 0===e||null===(k=e.cashbookData)||void 0===k?void 0:k.status)?"Cashbook Approved":"Reject"===(null===e||void 0===e||null===(A=e.cashbookData)||void 0===A?void 0:A.status)?"Claim Rejected":"-":"Claim Cashbook",children:(0,E.jsx)("button",{disabled:null===e||void 0===e||null===(C=e.cashbookData)||void 0===C?void 0:C._id,onClick:()=>me({isOpen:!0,data:e}),className:"px-2 py-1.5 text-xs rounded-md bg-transparent border border-muted",type:"button",children:(0,E.jsx)(_.p9$,{className:null!==e&&void 0!==e&&null!==(I=e.cashbookData)&&void 0!==I&&I._id?" text-gray-500":" hover:text-[#337ab7] text-[#3c8dbc]",size:16})})}),s&&(0,E.jsx)(f.A,{placement:"topLeft",title:null!==e&&void 0!==e&&e.checkInTime||null!==e&&void 0!==e&&e.checkOutTime?"No Actions":"Delete",children:(0,E.jsx)("button",{disabled:!!(null!==e&&void 0!==e&&e.checkInTime||null!==e&&void 0!==e&&e.checkOutTime),onClick:()=>(e=>{let t={_id:e};r().fire({title:"Warning",text:"Are you sure you want to delete!",icon:"warning",showCancelButton:!0,cancelButtonText:"No"}).then(e=>{e.isConfirmed&&te((0,O.sn)(t)).then(e=>{fe>1&&1==(null===G||void 0===G?void 0:G.length)?Ne(Number(fe-1)):!e.error&&Ae()})})})(null===e||void 0===e?void 0:e._id),className:"px-2 py-1.5 text-xs rounded-md bg-transparent border border-muted",type:"button",children:(0,E.jsx)(x.tqC,{className:null!==e&&void 0!==e&&e.checkInTime||null!==e&&void 0!==e&&e.checkOutTime?"hover:text-gray-500 text-gray-500":"text-red-600 hover:text-red-500",size:16})})})]})})]})}):(0,E.jsx)("tr",{className:"bg-white bg-opacity-5 ",children:(0,E.jsx)("td",{colSpan:4,className:"px-6 py-2 whitespace-nowrap font-[600] text-sm text-gray-500",children:"Record Not Found"})})})]})}),(0,E.jsx)(V.A,{visible:he,onCancel:()=>me({isOpen:!1,data:null}),onSuccess:Ae}),(0,E.jsx)(T.Ay,{setVisitorModal:oe,visitorModal:le,updateList:Ae}),(0,E.jsx)(Y.A,{empDetailModalData:ve,empCheckInDetailModalOpen:be,checkIn:we,setEmpCheckinDetailModalOpen:je}),(null===G||void 0===G?void 0:G.length)>0&&(0,E.jsx)(j.A,{totalCount:H,pageSize:10,currentPage:fe,onChange:e=>{Ne(e)}})]})}}}]);
//# sourceMappingURL=4766.d7c1efc2.chunk.js.map