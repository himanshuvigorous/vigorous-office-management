"use strict";(self.webpackChunkca_admin=self.webpackChunkca_admin||[]).push([[8628],{96247:(e,a,t)=>{t.r(a),t.d(a,{default:()=>V});var d=t(89379),n=t(24858),l=t(39160),s=t(83003),o=t(73216),i=t(65043),r=t(15187),c=(t(31744),t(78729),t(66015)),u=(t(42837),t(31536)),m=t(88967),v=t(31174),p=t(66497),x=t(20126),h=t(96603),y=t(65512),N=t(94084),j=t(60184),b=t(86178),A=t.n(b),g=t(60446),f=t.n(g),I=t(17995),S=t(89427),q=(t(30295),t(70579));const V=()=>{var e;const{purchaseexpenceIdEnc:a}=(0,o.g)(),t=(0,v.Yc)(a),{loading:b}=(0,s.d4)(e=>e.purchaseExpence),{register:g,handleSubmit:V,control:T,watch:E,formState:{errors:D},setValue:_}=(0,n.mN)({defaultValues:{typeSelection:"Vendor"}}),O=(0,s.wA)(),Q=(0,o.Zp)(),C=(0,n.FH)({control:T,name:"typeSelection"}),{AssetTypeListData:H}=((0,n.FH)({control:T,name:"vendorId",defaultValue:""}),(0,s.d4)(e=>e.AssetType)),{companyList:w}=(0,s.d4)(e=>e.company),{branchList:P}=(0,s.d4)(e=>e.branch),F=JSON.parse(localStorage.getItem("user_info_".concat(r.AU))),{expenseTypeList:k}=(0,s.d4)(e=>e.expenceHead),L=(0,n.FH)({control:T,name:"PDCompanyId",defaultValue:""}),G=(0,n.FH)({control:T,name:"PDBranchId",defaultValue:""}),{vendorDataList:Y,totalVendorCount:B,loading:M}=(0,s.d4)(e=>e.vendor),[U,J]=(0,i.useState)(!1),[W,Z]=(0,i.useState)({attachments:[]}),{purchaseExpenceDetails:z}=(0,s.d4)(e=>e.purchaseExpence);(0,i.useEffect)(()=>{O((0,p.Wv)({_id:t}))},[t]);(0,i.useEffect)(()=>{_("typeSelection","Vendor")},[]),(0,i.useEffect)(()=>{_("totalAmount",Number(E("amount"))+Number(E("gstAmount")))},[E("amount"),E("gstAmount")]);const K=()=>{O((0,x.Pe)({companyId:null===z||void 0===z?void 0:z.companyId,branchId:null===z||void 0===z?void 0:z.branchId,isPagination:!1,text:"",sort:!0,status:!0,groupId:""}))};return(0,i.useEffect)(()=>{z&&(_("typeSelection",null===z||void 0===z?void 0:z.purchaseType),_("quantity",null===z||void 0===z?void 0:z.quantity),_("Name",null===z||void 0===z?void 0:z.vendorOtherName),_("amount",null===z||void 0===z?void 0:z.totalAmount),_("naration",null===z||void 0===z?void 0:z.naration),_("fileUploadLink",null===z||void 0===z?void 0:z.attachment),_("gstAmount",null===z||void 0===z?void 0:z.totalGSTAmount),_("totalAmount",null===z||void 0===z?void 0:z.grandTotal),_("date",f()(null===z||void 0===z?void 0:z.purchaseDate)),Z({attachments:null===z||void 0===z?void 0:z.attachment}),_("assetNameId",null===z||void 0===z?void 0:z.assetName),(null===z||void 0===z?void 0:z.expenseHeadId)&&O((0,u.dV)({directorId:"",companyId:null===z||void 0===z?void 0:z.companyId,branchId:null===z||void 0===z?void 0:z.branchId,text:"",sort:!0,status:"",isPagination:!1})).then(e=>{if(!e.error){var a,t,d;const n=null===e||void 0===e||null===(a=e.payload)||void 0===a||null===(t=a.data)||void 0===t||null===(d=t.docs)||void 0===d?void 0:d.find(e=>(null===z||void 0===z?void 0:z.expenseHeadId)===e._id),l={value:null===n||void 0===n?void 0:n._id,label:null===n||void 0===n?void 0:n.name};_("expencehead",l)}}),(null===z||void 0===z?void 0:z.vendorId)&&O((0,x.Pe)({companyId:null===z||void 0===z?void 0:z.companyId,branchId:null===z||void 0===z?void 0:z.branchId,text:"",sort:!0,status:!0,groupId:""})).then(e=>{if(!e.error){var a,t,d;const n=null===e||void 0===e||null===(a=e.payload)||void 0===a||null===(t=a.data)||void 0===t||null===(d=t.docs)||void 0===d?void 0:d.find(e=>(null===z||void 0===z?void 0:z.vendorId)===e._id);_("vendorId",null===n||void 0===n?void 0:n._id)}}))},[z]),(0,q.jsx)(l.A,{children:(0,q.jsx)("div",{className:"gap-4",children:(0,q.jsxs)("form",{autoComplete:"off",className:"mt-2 md:px-1",onSubmit:V(e=>{var a;const d={_id:t,companyId:null===z||void 0===z?void 0:z.companyId,branchId:null===z||void 0===z?void 0:z.branchId,directorId:null===z||void 0===z?void 0:z.directorId,vendorId:null===e||void 0===e?void 0:e.vendorId,expenseHeadId:null===e||void 0===e||null===(a=e.expencehead)||void 0===a?void 0:a.value,quantity:"Vendor"===C?+(null===e||void 0===e?void 0:e.quantity):"",assetNameId:"Vendor"===C?null===z||void 0===z?void 0:z.assetNameId:"",assetName:(null===z||void 0===z?void 0:z.assetName)||"",totalAmount:+(null===e||void 0===e?void 0:e.amount),totalGSTAmount:+(null===e||void 0===e?void 0:e.gstAmount),grandTotal:+(null===e||void 0===e?void 0:e.totalAmount),purchaseDate:f()(null===e||void 0===e?void 0:e.date).format("YYYY-MM-DD"),status:"Pending",purchaseType:null===e||void 0===e?void 0:e.typeSelection,attachment:null===W||void 0===W?void 0:W.attachments,vendorOtherName:null===e||void 0===e?void 0:e.Name};O((0,p.dc)(d)).then(e=>{e.error||Q(-1)})}),children:[(0,q.jsxs)("div",{className:"col-span-2",children:[(0,q.jsx)(n.xI,{name:"typeSelection",control:T,rules:{required:"Client Selection Type is required"},render:e=>{let{field:a}=e;return(0,q.jsxs)(h.Ay.Group,(0,d.A)((0,d.A)({},a),{},{onChange:e=>{a.onChange(e)},optionType:"button",buttonStyle:"solid",block:!0,defaultValue:"Vendor",className:"  ".concat(D.clientSelection?"border-[1px] ":"border-gray-300"),children:[(0,q.jsx)(h.Ay,{value:"Vendor",children:"Asset"}),(0,q.jsx)(h.Ay,{value:"Other",children:"Other"})]}))}}),D.clientSelection&&(0,q.jsx)("p",{className:"text-red-500 text-sm",children:D.clientSelection.message})]}),(0,q.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-1 md:gap-8 md:my-1 px-3 md:mt-4",children:[(0,q.jsxs)("div",{className:"",children:[(0,q.jsxs)("label",{className:"".concat(r.Q0),children:["Vendor ","Vendor"===C&&(0,q.jsx)("span",{className:"text-red-600",children:"*"})]}),(0,q.jsx)(n.xI,{control:T,name:"vendorId",rules:{required:"Vendor"===C&&" vendor is required"},render:e=>{let{field:a}=e;return(0,q.jsxs)(y.A,(0,d.A)((0,d.A)({},a),{},{defaultValue:"",className:"".concat(r.Hy," "),onFocus:K,showSearch:!0,filterOption:(e,a)=>String(null===a||void 0===a?void 0:a.children).toLowerCase().includes(e.toLowerCase()),children:[(0,q.jsx)(y.A.Option,{value:"",children:"Select Vendor"}),M?(0,q.jsx)(y.A.Option,{disabled:!0,children:(0,q.jsx)(S.A,{})}):null===Y||void 0===Y?void 0:Y.map((e,a)=>(0,q.jsx)("option",{value:null===e||void 0===e?void 0:e._id,children:null===e||void 0===e?void 0:e.fullName}))]}))}}),D.vendorId&&(0,q.jsx)("p",{className:"text-red-500 text-sm",children:D.vendorId.message})]}),"Other"===C&&(0,q.jsxs)("div",{className:"",children:[(0,q.jsxs)("label",{className:"".concat(r.Q0),children:["Name",(0,q.jsx)("span",{className:"text-red-600",children:"*"})]}),(0,q.jsx)("textarea",(0,d.A)((0,d.A)({},g("Name",{required:"Name is required"})),{},{className:" ".concat(r.Ol," ").concat(D.Name?"border-[1px] ":"border-gray-300"),placeholder:"Enter Name"})),D.Name&&(0,q.jsx)("p",{className:"text-red-500 text-sm",children:D.Name.message})]}),"Vendor"===C&&(0,q.jsxs)(q.Fragment,{children:[(0,q.jsxs)("div",{className:"",children:[(0,q.jsxs)("label",{className:"".concat(r.Q0),children:["Asset Name  ",(0,q.jsx)("span",{className:"text-red-600",children:"*"})]}),(0,q.jsx)("input",(0,d.A)((0,d.A)({type:"text"},g("assetNameId",{required:"Asset Name is required"})),{},{disabled:!0,className:" ".concat(r.id," ").concat(D.quantity?"border-[1px] ":"border-gray-300"),placeholder:"Enter AssetName"})),D.assetNameId&&(0,q.jsx)("p",{className:"text-red-500 text-sm",children:D.assetNameId.message})]}),(0,q.jsxs)("div",{className:"",children:[(0,q.jsxs)("label",{className:"".concat(r.Q0),children:["Quantity",(0,q.jsx)("span",{className:"text-red-600",children:"*"})]}),(0,q.jsx)("input",(0,d.A)((0,d.A)({type:"number"},g("quantity",{required:"Quantity is required"})),{},{disabled:!0,className:" ".concat(r.id," ").concat(D.quantity?"border-[1px] ":"border-gray-300"),placeholder:"Enter Quantity"})),D.quantity&&(0,q.jsx)("p",{className:"text-red-500 text-sm",children:D.quantity.message})]})]}),"Other"===(0,n.FH)({control:T,name:"typeSelection"})&&(0,q.jsxs)("div",{className:"w-full",children:[(0,q.jsx)("label",{className:"".concat(r.Q0),children:"Expense Head"}),(0,q.jsx)(n.xI,{name:"expencehead",control:T,rules:{required:"Expence Head is required"},render:e=>{let{field:a}=e;return(0,q.jsx)(c.Ay,(0,d.A)((0,d.A)({onFocus:()=>{const e={directorId:"",companyId:"admin"===(null===F||void 0===F?void 0:F.userType)?L:"company"===(null===F||void 0===F?void 0:F.userType)?null===F||void 0===F?void 0:F._id:null===F||void 0===F?void 0:F.companyId,branchId:"company"===(null===F||void 0===F?void 0:F.userType)||"admin"===(null===F||void 0===F?void 0:F.userType)||"companyDirector"===(null===F||void 0===F?void 0:F.userType)?G:"companyBranch"===(null===F||void 0===F?void 0:F.userType)?null===F||void 0===F?void 0:F._id:null===F||void 0===F?void 0:F.branchId,text:"",sort:!0,status:"",isPagination:!1};O((0,u.dV)(e))}},a),{},{options:null===k||void 0===k?void 0:k.map(e=>({value:null===e||void 0===e?void 0:e._id,label:null===e||void 0===e?void 0:e.name})),classNamePrefix:"react-select",className:"".concat(r.Ph," ").concat(D.expencehead?"border-[1px] ":"border-gray-300"),placeholder:"Select Expence Head"}))}}),D.expencehead&&(0,q.jsx)("p",{className:"text-red-500 text-sm",children:D.expencehead.message})]}),(0,q.jsxs)("div",{className:"",children:[(0,q.jsxs)("label",{className:"".concat(r.Q0),children:["Amount",(0,q.jsx)("span",{className:"text-red-600",children:"*"})]}),(0,q.jsx)("input",(0,d.A)((0,d.A)({type:"number",step:"0.01"},g("amount",{required:"Amount is required"})),{},{className:" ".concat(r.Ol," ").concat(D.amount?"border-[1px] ":"border-gray-300"),placeholder:"Enter Amount"})),D.amount&&(0,q.jsx)("p",{className:"text-red-500 text-sm",children:D.amount.message})]}),(0,q.jsxs)("div",{className:"",children:[(0,q.jsx)("label",{className:"".concat(r.Q0),children:"Gst Amount"}),(0,q.jsx)("input",(0,d.A)((0,d.A)({type:"number",step:"0.01"},g("gstAmount")),{},{className:" ".concat(r.Ol," ").concat(D.gstAmount?"border-[1px] ":"border-gray-300"),placeholder:"Enter Gst Amount"})),D.gstAmount&&(0,q.jsx)("p",{className:"text-red-500 text-sm",children:D.gstAmount.message})]}),(0,q.jsxs)("div",{className:"",children:[(0,q.jsx)("label",{className:"".concat(r.Q0),children:"Total Amount"}),(0,q.jsx)("input",(0,d.A)((0,d.A)({type:"number",step:"0.01",disabled:!0},g("totalAmount")),{},{className:" ".concat(r.id," ").concat(D.totalAmount?"border-[1px] ":"border-gray-300"),placeholder:"Enter Total Amount"})),D.totalAmount&&(0,q.jsx)("p",{className:"text-red-500 text-sm",children:D.totalAmount.message})]}),(0,q.jsxs)("div",{children:[(0,q.jsx)("label",{className:"".concat(r.Q0),children:"Bill Date"}),(0,q.jsx)(n.xI,{name:"date",control:T,render:e=>{let{field:a}=e;return(0,q.jsx)(N.A,{field:a,errors:D,disabledDate:e=>e&&e.isAfter(A()().endOf("day"),"day")})}}),D.date&&(0,q.jsx)("p",{className:"text-red-500 text-sm",children:" Bill Date is required"})]}),(0,q.jsxs)("div",{className:"",children:[(0,q.jsx)("label",{className:"".concat(r.Q0),children:"Documents"}),U?(0,q.jsx)("div",{className:"space-y-2"}):(0,q.jsxs)("div",{className:"space-y-4",children:[(0,q.jsx)("input",{type:"file",onChange:e=>{const a={filePath:e.target.files[0],isVideo:!1,isMultiple:!1};O((0,m.Sg)(a)).then(e=>{var a;null!==e&&void 0!==e&&null!==(a=e.payload)&&void 0!==a&&a.data&&Z(a=>{var t;return(0,d.A)((0,d.A)({},a),{},{attachments:[...(null===a||void 0===a?void 0:a.attachments)||[],null===e||void 0===e||null===(t=e.payload)||void 0===t?void 0:t.data]})})})},className:"hidden",id:"file-upload"}),(0,q.jsxs)("label",{htmlFor:"file-upload",className:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-600 bg-white cursor-pointer",children:[(0,q.jsx)(j.chT,{className:"mr-2"})," Add Documents"]}),(0,q.jsx)("div",{className:"space-y-2",children:null===W||void 0===W||null===(e=W.attachments)||void 0===e?void 0:e.map((e,a)=>(0,q.jsxs)("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded-md",children:[(0,q.jsxs)("a",{href:"".concat("https://vigapi.vigorousit.com","/public/").concat(e),className:"flex items-center space-x-2",target:"_blank",rel:"noopener noreferrer",children:[(0,q.jsx)(j.chT,{className:"text-gray-500"}),(0,q.jsx)("span",{className:"text-sm text-gray-600",children:e})]}),(0,q.jsx)("button",{type:"button",onClick:()=>(e=>{Z(a=>{const t=null===a||void 0===a?void 0:a.attachments.filter((a,t)=>t!==e);return(0,d.A)((0,d.A)({},a),{},{attachments:t})})})(a),className:"text-red-500 hover:text-red-700",children:(0,q.jsx)(j.QCr,{})})]},a))})]})]})]}),(0,q.jsx)("div",{className:"flex justify-end",children:(0,q.jsx)("button",{type:"submit",disabled:b,className:"".concat(b?"bg-gray-400":"bg-header"," text-white p-2 px-4 rounded"),children:b?(0,q.jsx)(I.A,{}):"Submit"})})]})})})}}}]);
//# sourceMappingURL=8628.c93c6f43.chunk.js.map