"use strict";(self.webpackChunkca_admin=self.webpackChunkca_admin||[]).push([[3870],{73870:(e,l,s)=>{s.r(l),s.d(l,{default:()=>g});var a=s(89379),t=s(65043),i=s(39160),n=s(15187),d=s(24858),o=s(65512),c=s(83003),r=s(89427),u=(s(78729),s(31744)),v=s(8928),m=s(70337),h=s(47196),x=s(17995),p=s(47989),k=s(73216),N=s(31174),b=s(71985),j=s(70579);const g=()=>{var e,l,s,g,f,A,T,S,I,G,P,C,w,D,O,R,L,_,F,Q,q,Y,H,E,B,V,M,z,$,J,U,X;const{invoiceIdEnc:Z}=(0,k.g)(),K=(0,N.Yc)(Z),{register:W,handleSubmit:ee,control:le,watch:se,reset:ae,formState:{errors:te},setValue:ie}=(0,d.mN)({defaultValues:{totalAmount:0,totalDiscount:0,totalDiscountedPrice:0,tasks:[{gstAmount:"",gstRate:"",amount:"",hsnCode:"",taskType:""}]}}),ne=(0,d.FH)({control:le,name:"tasks",defaultValue:""}),[de,oe]=(0,t.useState)({totalAmount:0,totalDiscount:0,totalDiscountedPrice:0,totalGST:0,totalFinalAmount:0}),{fields:ce,append:re,remove:ue}=(0,d.jz)({control:le,name:"tasks"}),{loading:ve}=(0,c.d4)(e=>e.invoice),{invoiceDetails:me,loading:he}=(0,c.d4)(e=>e.invoice),{gstTypeList:xe,loading:pe}=(0,c.d4)(e=>e.gstType),[ke,Ne]=(0,t.useState)(""),[be,je]=(0,t.useState)(!1),ge=(0,c.wA)(),[ye,fe]=((0,k.Zp)(),(0,t.useState)(!1)),[Ae,Te]=(0,t.useState)([]),Se=JSON.parse(localStorage.getItem("user_info_".concat(n.AU))),{branchList:Ie,branchListloading:Ge}=(0,c.d4)(e=>e.branch),{officeAddressListData:Pe,loading:Ce}=(0,c.d4)(e=>e.officeAddress),{clientList:we,loading:De}=(0,c.d4)(e=>e.client),Oe=null===Pe||void 0===Pe?void 0:Pe.find(e=>e._id===se("invoiceLayout")),Re=null===we||void 0===we?void 0:we.find(e=>e._id===se("client")),[Le,_e]=(0,t.useState)(!1),[Fe,Qe]=(0,t.useState)(!1);(0,t.useEffect)(()=>{K&&(async()=>{_e(!0);try{await ge((0,p.Gg)({_id:K}))}catch(e){console.error("Failed to fetch invoice details:",e)}finally{_e(!1)}})()},[K]),(0,t.useEffect)(()=>{me&&(async()=>{if(Te([]),Qe(!0),ae(),me)try{console.log(...(null===me||void 0===me?void 0:me.clientCompletedTaskData)||[],"invoiceDetails"),Te([...(null===me||void 0===me?void 0:me.clientCompletedTaskData)||[],{_id:"other",financialYear:"-",status:"Completed",taskName:"Other",description:"Other",HSNCode:"-",GSTRate:0,GSTName:"-",taskFee:0}]);const e=await ge((0,u.d0)({text:"",sort:!0,status:!0,isPagination:!1,companyId:null===me||void 0===me?void 0:me.companyId}));null!==e&&void 0!==e&&e.error||ie("PDBranchId",null===me||void 0===me?void 0:me.branchId),ge((0,b.Bw)({directorId:"",companyId:null===me||void 0===me?void 0:me.companyId,branchId:null===me||void 0===me?void 0:me.branchId,text:"",sort:!0,status:"",isPagination:!1}));const l=await ge((0,m.Aq)({companyId:null===me||void 0===me?void 0:me.companyId,branchId:null===me||void 0===me?void 0:me.branchId,groupId:"",directorId:"",organizationId:"",industryId:"",text:"",sort:!0,status:!0,isPagination:!1}));null!==l&&void 0!==l&&l.error||ie("client",null===me||void 0===me?void 0:me.clientId);const s=await ge((0,v.XY)({companyId:null===me||void 0===me?void 0:me.companyId,branchId:null===me||void 0===me?void 0:me.branchId,directorId:"",text:"",sort:!0,status:!0,type:"invoice",isPagination:!1,bankAccountId:"",isGSTEnabled:""}));null!==s&&void 0!==s&&s.error||ie("invoiceLayout",null===me||void 0===me?void 0:me.invoiceLayoutId),ie("tasks",[]),fe(!0)}catch(e){console.error("Error fetching invoice-related data:",e)}else Te([]),ie("tasks",[]);Qe(!1)})()},[me]),(0,t.useEffect)(()=>{var e;if(Re&&Oe)if(null!==Re&&void 0!==Re&&null!==(e=Re.clientProfile)&&void 0!==e&&e.GSTNumber&&null!==Oe&&void 0!==Oe&&Oe.isGSTEnabled){var l,s;je(!0);const e=null===Re||void 0===Re||null===(l=Re.clientProfile)||void 0===l?void 0:l.GSTNumber,a=null===Oe||void 0===Oe?void 0:Oe.gstNumber;(null===e||void 0===e?void 0:e.slice(0,2))===(null===a||void 0===a?void 0:a.slice(0,2))?Ne("interstate"):null!==Re&&void 0!==Re&&null!==(s=Re.clientProfile)&&void 0!==s&&s.GSTNumber||null===Oe||void 0===Oe||!Oe.isGSTEnabled?Ne("intrastate"):(je(!0),Ne("interstate"))}else je(!1),Ne("");else je(!1),Ne("")},[Re,Oe]),(0,t.useEffect)(()=>{if(!ne||0===ne.length)return void oe({totalAmount:0,totalDiscount:0,totalDiscountedPrice:0,totalGST:0,totalFinalAmount:0});const e=ne.reduce((e,l)=>(e.totalAmount+=Number(l.amount)||0,e.totalDiscount+=Number(l.discount)||0,e.totalDiscountedPrice+=Number(l.discountedPrice)||0,e.totalGST+=Number(l.gstPrice)||0,e.totalFinalAmount+=Number(l.finalAmount)||0,e),{totalAmount:0,totalDiscount:0,totalDiscountedPrice:0,totalGST:0,totalFinalAmount:0});oe(e)},[ne]),(0,t.useEffect)(()=>{var e;ye&&(null===me||void 0===me||null===(e=me.taskList)||void 0===e||e.forEach(e=>{if("other"!==e.taskType){const l={taskName:null===e||void 0===e?void 0:e.taskName,taskType:null===e||void 0===e?void 0:e.taskId,tasktypeId:null===e||void 0===e?void 0:e.taskId,hsnCode:e.HSNCode,gstRate:e.GSTRate,amount:e.taskAmount,finalAmount:e.calculatedAmount,discount:e.discount,discountedPrice:e.discountAmount,gstPrice:e.gstAmount,financialYear:null===e||void 0===e?void 0:e.financialYear};re(l)}else{const l={taskName:null===e||void 0===e?void 0:e.taskName,description:null===e||void 0===e?void 0:e.taskName,taskType:"other",tasktypeId:"other",hsnCode:e.HSNCode,gstRate:e.GSTRate,amount:e.taskAmount,finalAmount:e.calculatedAmount,discount:e.discount,discountedPrice:e.discountAmount,gstPrice:e.gstAmount,gstTypeId:e.GSTRate,financialYear:null};re(l)}fe(!1)}))},[ye,me]);return(0,j.jsx)(i.A,{children:Le||Fe?(0,j.jsx)(r.A,{}):(0,j.jsxs)("form",{autoComplete:"off",className:"mt-2 md:px-1",onSubmit:ee(async e=>{var l,s,a,t;const i=null===e||void 0===e||null===(l=e.tasks)||void 0===l||null===(s=l.filter(e=>"other"!==e.taskType))||void 0===s?void 0:s.map(e=>{const l=Ae.find(l=>l._id===e.taskType);return{taskType:"task",taskId:e.taskType,taskName:null===l||void 0===l?void 0:l.taskName,HSNCode:e.hsnCode,GSTRate:+e.gstRate,taskAmount:+e.amount,calculatedAmount:+e.finalAmount,gstAmount:+e.gstPrice,discount:+e.discount,discountAmount:+e.discountedPrice,financialYear:null===e||void 0===e?void 0:e.financialYear}}),n=null===e||void 0===e||null===(a=e.tasks)||void 0===a||null===(t=a.filter(e=>"other"===e.taskType))||void 0===t?void 0:t.map(e=>{Ae.find(e=>e._id===e.taskType);return{taskType:"other",taskId:null,taskName:null===e||void 0===e?void 0:e.description,HSNCode:e.hsnCode,GSTRate:+e.gstRate,taskAmount:+e.amount,calculatedAmount:+e.finalAmount,gstAmount:+e.gstPrice,discount:+e.discount,discountAmount:+e.discountedPrice,financialYear:null}}),d={_id:null===me||void 0===me?void 0:me._id,companyId:null===me||void 0===me?void 0:me.companyId,directorId:null===me||void 0===me?void 0:me.directorId,branchId:null===me||void 0===me?void 0:me.branchId,clientId:null===me||void 0===me?void 0:me.clientId,invoiceLayoutId:null===e||void 0===e?void 0:e.invoiceLayout,taskList:[...i,...n],totalAmount:+(null===de||void 0===de?void 0:de.totalAmount),discountAmount:+(null===de||void 0===de?void 0:de.totalDiscount),grandTotal:+(null===de||void 0===de?void 0:de.totalFinalAmount),isAllTask:(null===e||void 0===e?void 0:e.isAlltask)||!1,isIGST:"intrastate"===ke,isDiscount:!0,SGST:be?+(null===de||void 0===de?void 0:de.totalGST)/2:null,CGST:be?+(null===de||void 0===de?void 0:de.totalGST)/2:null,IGST:be?+(null===de||void 0===de?void 0:de.totalGST):null};await ge((0,p.rY)(d)).then(e=>{})}),children:[(0,j.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-1 md:gap-8 md:my-1  md:mt-4",children:("admin"===(null===Se||void 0===Se?void 0:Se.userType)||"company"===(null===Se||void 0===Se?void 0:Se.userType)||"companyDirector"===(null===Se||void 0===Se?void 0:Se.userType))&&(0,j.jsxs)("div",{className:"",children:[(0,j.jsxs)("label",{className:"".concat(n.Q0),children:["Branch ",(0,j.jsx)("span",{className:"text-red-600",children:"*"})]}),(0,j.jsx)(d.xI,{control:le,name:"PDBranchId",rules:{required:"Branch is required"},render:e=>{var l;let{field:s}=e;return(0,j.jsxs)(o.A,(0,a.A)((0,a.A)({},s),{},{defaultValue:"",disabled:!0,className:"".concat(n.Hy," "),children:[(0,j.jsx)(o.A.Option,{value:"",children:"Select Branch"}),Ge?(0,j.jsx)(o.A.Option,{disabled:!0,children:(0,j.jsx)(r.A,{})}):null===(l=(0,n._o)(Ie,"fullName"))||void 0===l?void 0:l.map(e=>(0,j.jsx)(o.A.Option,{value:null===e||void 0===e?void 0:e._id,children:null===e||void 0===e?void 0:e.fullName},null===e||void 0===e?void 0:e._id))]}))}}),te.PDBranchId&&(0,j.jsx)("p",{className:"text-red-500 text-sm",children:te.PDBranchId.message})]})}),(0,j.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 ",children:[(0,j.jsxs)("div",{className:"w-full",children:[(0,j.jsxs)("label",{className:"".concat(n.Q0),children:["Client ",(0,j.jsx)("span",{className:"text-red-600",children:"*"})]}),(0,j.jsx)(d.xI,{name:"client",control:le,rules:{required:" client is required"},render:e=>{var l;let{field:s}=e;return(0,j.jsxs)(o.A,(0,a.A)((0,a.A)({},s),{},{defaultValue:"",showSearch:!0,disabled:!0,filterOption:(e,l)=>String(null===l||void 0===l?void 0:l.children).toLowerCase().includes(e.toLowerCase()),className:" ".concat(n.Hy," ").concat(te.invoiceLayout?"border-[1px] ":"border-gray-300"),children:[(0,j.jsx)(o.A.Option,{className:"",value:"",children:"Select client"}),De?(0,j.jsx)(o.A.Option,{disabled:!0,children:(0,j.jsx)(r.A,{})}):null===(l=(0,n._o)(we,"fullName"))||void 0===l?void 0:l.map(e=>(0,j.jsx)(o.A.Option,{value:null===e||void 0===e?void 0:e._id,children:null===e||void 0===e?void 0:e.fullName}))]}))}}),te.client&&(0,j.jsx)("p",{className:"text-red-500 text-sm mt-1",children:te.client.message})]}),(0,j.jsxs)("div",{className:"",children:[(0,j.jsxs)("label",{className:"".concat(n.Q0),children:["Firm Layout Name",(0,j.jsx)("span",{className:"text-red-600",children:"*"})]}),(0,j.jsx)(d.xI,{control:le,name:"invoiceLayout",rules:{required:"Task Name is required"},render:e=>{var l;let{field:s}=e;return(0,j.jsxs)(o.A,(0,a.A)((0,a.A)({},s),{},{onChange:e=>{ie("invoiceLayout",e),ie("tasks",[])},defaultValue:"",className:" ".concat(n.Hy," ").concat(te.invoiceLayout?"border-[1px] ":"border-gray-300"),showSearch:!0,filterOption:(e,l)=>String(null===l||void 0===l?void 0:l.children).toLowerCase().includes(e.toLowerCase()),children:[(0,j.jsx)(o.A.Option,{className:"",value:"",children:"Select Layout"}),Ce?(0,j.jsx)(o.A.Option,{disabled:!0,children:(0,j.jsx)(r.A,{})}):null===(l=(0,n._o)(Pe,"firmName"))||void 0===l?void 0:l.map(e=>(0,j.jsx)(o.A.Option,{value:null===e||void 0===e?void 0:e._id,children:null===e||void 0===e?void 0:e.firmName}))]}))}}),te.invoiceLayout&&(0,j.jsx)("p",{className:"text-red-500 text-sm",children:te.invoiceLayout.message})]})]}),(0,j.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 my-3",children:[Re&&(0,j.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 p-2 shadow-sm",children:[(0,j.jsx)("h3",{className:"text-sm font-semibold text-gray-800 mb-1 pb-0.5 border-b border-gray-100",children:"Client Details"}),(0,j.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,j.jsx)(y,{label:"Client",value:null===Re||void 0===Re?void 0:Re.fullName}),(0,j.jsx)(y,{label:"GST Number",value:(null===Re||void 0===Re||null===(e=Re.clientProfile)||void 0===e?void 0:e.GSTNumber)||"-"}),(0,j.jsx)(y,{label:"Address",value:"".concat(null!==(l=null===Re||void 0===Re||null===(s=Re.addresses)||void 0===s||null===(g=s.primary)||void 0===g?void 0:g.city)&&void 0!==l?l:"-"," , ").concat(null!==(f=null===Re||void 0===Re||null===(A=Re.addresses)||void 0===A||null===(T=A.primary)||void 0===T?void 0:T.state)&&void 0!==f?f:"-",", ").concat(null!==(S=null===Re||void 0===Re||null===(I=Re.addresses)||void 0===I||null===(G=I.primary)||void 0===G?void 0:G.country)&&void 0!==S?S:"-"," , ").concat(null!==(P=null===Re||void 0===Re||null===(C=Re.addresses)||void 0===C||null===(w=C.primary)||void 0===w?void 0:w.pinCode)&&void 0!==P?P:"-")}),(0,j.jsx)(y,{label:"Mobile",value:"".concat(null===Re||void 0===Re||null===(D=Re.mobile)||void 0===D?void 0:D.code," ").concat(null===Re||void 0===Re||null===(O=Re.mobile)||void 0===O?void 0:O.number)})]})]}),Oe&&(0,j.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 p-2 shadow-sm",children:[(0,j.jsx)("h3",{className:"text-sm font-semibold text-gray-800 mb-1 pb-0.5 border-b border-gray-100",children:"Firm Details"}),(0,j.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,j.jsx)(y,{label:"Firm Name",value:null===Oe||void 0===Oe?void 0:Oe.firmName}),(0,j.jsx)(y,{label:"GST Number",value:null!==Oe&&void 0!==Oe&&Oe.isGSTEnabled?null===Oe||void 0===Oe?void 0:Oe.gstNumber:"-"}),(0,j.jsx)(y,{label:"Address",value:"".concat(null!==(R=null===Oe||void 0===Oe||null===(L=Oe.address)||void 0===L?void 0:L.city)&&void 0!==R?R:"-",", ").concat(null!==(_=null===Oe||void 0===Oe||null===(F=Oe.address)||void 0===F?void 0:F.state)&&void 0!==_?_:"-",", ").concat(null!==(Q=null===Oe||void 0===Oe||null===(q=Oe.address)||void 0===q?void 0:q.country)&&void 0!==Q?Q:"-"," , ").concat(null!==(Y=null===Oe||void 0===Oe||null===(H=Oe.address)||void 0===H?void 0:H.pinCode)&&void 0!==Y?Y:"-")}),(0,j.jsx)(y,{label:"Mobile",value:"".concat(null===Oe||void 0===Oe||null===(E=Oe.mobile)||void 0===E?void 0:E.code," ").concat(null===Oe||void 0===Oe||null===(B=Oe.mobile)||void 0===B?void 0:B.number)})]})]})]}),(0,j.jsxs)("div",{className:"space-y-2",children:[Re&&Oe&&(0,j.jsxs)("div",{children:[ce.map((e,l)=>{var s,t,i,c,u,v,m,x,p,k,N,b,g,y,f,A,T,S,I,G,P,C,w,D,O,R,L,_,F,Q,q,Y,H,E,B,V,M,z,$,J,U,X,Z,K,ee,ae,ne,de,oe,ce,re,ve,me,he,ke,Ne,je;return(0,j.jsxs)("div",{className:"border border-gray-300 rounded-md",children:[(0,j.jsx)("div",{className:"flex flex-col items-end",children:(0,j.jsx)("div",{className:"w-full bg-header flex justify-end items-center rounded-tl-md rounded-tr-md p-1",children:(0,j.jsx)("button",{type:"button",onClick:()=>ue(l),children:(0,j.jsx)(h.tqC,{className:"text-white w-12 hover:text-white",size:20})})})}),(0,j.jsxs)("div",{className:"grid sm:grid-cols-2 gap-2 md:grid-cols-4 p-3",children:[(0,j.jsxs)("div",{className:se("isAlltask")?"hidden w-full":"block w-full",children:[(0,j.jsx)("label",{className:"".concat(n.Q0),children:"Task"}),(0,j.jsx)(d.xI,{control:le,name:"tasks[".concat(l,"].taskType"),rules:{required:"Task Type is required"},render:e=>{let{field:s}=e;return(0,j.jsxs)(o.A,(0,a.A)((0,a.A)({},s),{},{defaultValue:"",className:"".concat(n.Hy),showSearch:!0,filterOption:(e,l)=>String(null===l||void 0===l?void 0:l.children).toLowerCase().includes(e.toLowerCase()),onChange:e=>{if(e){const s=null===Ae||void 0===Ae?void 0:Ae.find(l=>l._id===e);if(s){const e=be?null===s||void 0===s?void 0:s.GSTRate:0;ie("tasks[".concat(l,"].tasktypeId"),null===s||void 0===s?void 0:s._id),ie("tasks[".concat(l,"].amount"),null===s||void 0===s?void 0:s.taskFee),ie("tasks[".concat(l,"].gstRate"),e),ie("tasks[".concat(l,"].hsnCode"),null===s||void 0===s?void 0:s.HSNCode),ie("tasks[".concat(l,"].discount"),0),ie("tasks[".concat(l,"].discountedPrice"),null===s||void 0===s?void 0:s.taskFee),ie("tasks[".concat(l,"].gstPrice"),(null===s||void 0===s?void 0:s.taskFee)*e/100),ie("tasks[".concat(l,"].finalAmount"),(null===s||void 0===s?void 0:s.taskFee)*e/100+(null===s||void 0===s?void 0:s.taskFee)),ie("tasks[".concat(l,"].financialYear"),null===s||void 0===s?void 0:s.financialYear)}}else ie("tasks[".concat(l,"].tasktypeId"),""),ie("tasks[".concat(l,"].amount"),0),ie("tasks[".concat(l,"].gstRate"),0),ie("tasks[".concat(l,"].hsnCode"),""),ie("tasks[".concat(l,"].discount"),0),ie("tasks[".concat(l,"].discountedPrice"),0),ie("tasks[".concat(l,"].gstPrice"),0),ie("tasks[".concat(l,"].gstTypeId"),0),ie("tasks[".concat(l,"].finalAmount"),0),ie("tasks[".concat(l,"].financialYear"),null);s.onChange(e)},children:[(0,j.jsx)(o.A.Option,{value:"",children:"Select Task"}),null===Ae||void 0===Ae?void 0:Ae.filter(e=>{var s;return!(null===(s=se("tasks"))||void 0===s?void 0:s.map((e,s)=>s!==l&&e.taskType).filter(Boolean)).includes(e._id)}).map(e=>(0,j.jsx)(o.A.Option,{value:null===e||void 0===e?void 0:e._id,children:null===e||void 0===e?void 0:e.taskName},null===e||void 0===e?void 0:e._id))]}))}}),(null===(s=te.tasks)||void 0===s||null===(t=s[l])||void 0===t?void 0:t.taskType)&&(0,j.jsx)("p",{className:"text-red-500 text-sm",children:null===(i=te.tasks)||void 0===i||null===(c=i[l])||void 0===c||null===(u=c.taskType)||void 0===u?void 0:u.message})]}),(0,j.jsxs)("div",{className:se("isAlltask")?"block w-full":"hidden w-full",children:[(0,j.jsx)("label",{className:"".concat(n.Q0),children:"Task"}),(0,j.jsx)("input",(0,a.A)((0,a.A)({type:"text",disabled:!0},W("tasks[".concat(l,"].taskName"))),{},{className:"".concat(n.Ol),placeholder:"Task Name"})),(null===(v=te.tasks)||void 0===v||null===(m=v[l])||void 0===m?void 0:m.taskName)&&(0,j.jsx)("p",{className:"text-red-500 text-sm",children:null===(x=te.tasks)||void 0===x||null===(p=x[l])||void 0===p||null===(k=p.taskName)||void 0===k?void 0:k.message})]}),(0,j.jsxs)("div",{className:"w-full",children:[(0,j.jsx)("label",{className:"".concat(n.Q0),children:"HSN code"}),(0,j.jsx)("input",(0,a.A)((0,a.A)({type:"text",disabled:"other"!==se("tasks[".concat(l,"].tasktypeId"))},W("tasks[".concat(l,"].hsnCode"),{required:"other"===se("tasks[".concat(l,"].tasktypeId"))&&"HSN Code is required",pattern:{value:/^\d{4}(\d{2})?(\d{2})?$/,message:"HSN Code must be 4, 6, or 8 digits"}})),{},{className:"".concat(n.Ol),placeholder:"HSN CODE"})),(null===(N=te.tasks)||void 0===N||null===(b=N[l])||void 0===b?void 0:b.hsnCode)&&(0,j.jsx)("p",{className:"text-red-500 text-sm",children:null===(g=te.tasks)||void 0===g||null===(y=g[l])||void 0===y||null===(f=y.hsnCode)||void 0===f?void 0:f.message})]}),se("tasks[".concat(l,"].tasktypeId"))&&"other"!==se("tasks[".concat(l,"].tasktypeId"))&&(0,j.jsxs)("div",{className:"w-full",children:[(0,j.jsx)("label",{className:"".concat(n.Q0),children:"Financial Year"}),(0,j.jsx)("input",(0,a.A)((0,a.A)({type:"text",disabled:!0},W("tasks[".concat(l,"].financialYear"),{})),{},{className:"".concat(n.id),placeholder:"Financial Year"})),(null===(A=te.tasks)||void 0===A||null===(T=A[l])||void 0===T?void 0:T.financialYear)&&(0,j.jsx)("p",{className:"text-red-500 text-sm",children:null===(S=te.tasks)||void 0===S||null===(I=S[l])||void 0===I||null===(G=I.financialYear)||void 0===G?void 0:G.message})]}),"other"===se("tasks[".concat(l,"].tasktypeId"))&&(0,j.jsxs)("div",{className:"w-full",children:[(0,j.jsx)("label",{className:"".concat(n.Q0),children:"Description"}),(0,j.jsx)("input",(0,a.A)((0,a.A)({type:"text"},W("tasks[".concat(l,"].description"),{})),{},{className:"".concat(n.Ol),placeholder:"Description"})),(null===(P=te.tasks)||void 0===P||null===(C=P[l])||void 0===C?void 0:C.description)&&(0,j.jsx)("p",{className:"text-red-500 text-sm",children:null===(w=te.tasks)||void 0===w||null===(D=w[l])||void 0===D||null===(O=D.description)||void 0===O?void 0:O.message})]}),(0,j.jsxs)("div",{className:"w-full",children:[(0,j.jsx)("label",{className:"".concat(n.Q0),children:"Amount"}),(0,j.jsx)("input",(0,a.A)((0,a.A)({type:"number",step:"0.01"},W("tasks[".concat(l,"].amount"),{required:"other"===se("tasks[".concat(l,"].tasktypeId"))&&"Amount is required",min:{value:0,message:"Amount cannot be negative"}})),{},{className:"".concat(n.Ol),placeholder:"Amount",disabled:"other"!==se("tasks[".concat(l,"].tasktypeId")),onChange:e=>{if("other"===se("tasks[".concat(l,"].tasktypeId"))){var s;const a=Number(e.target.value),t=Number(se("tasks[".concat(l,"].gstRate"))),i=a-(null!==(s=Number(se("tasks[".concat(l,"].discount"))))&&void 0!==s?s:0),n=i*t/100,d=i+n;ie("tasks[".concat(l,"].discountedPrice"),i),ie("tasks[".concat(l,"].gstPrice"),n),ie("tasks[".concat(l,"].finalAmount"),d)}}})),(null===(R=te.tasks)||void 0===R||null===(L=R[l])||void 0===L?void 0:L.amount)&&(0,j.jsx)("p",{className:"text-red-500 text-sm",children:null===(_=te.tasks)||void 0===_||null===(F=_[l])||void 0===F||null===(Q=F.amount)||void 0===Q?void 0:Q.message})]}),(0,j.jsxs)("div",{className:"w-full",children:[(0,j.jsx)("label",{className:"".concat(n.Q0),children:"Discount"}),(0,j.jsx)("input",(0,a.A)((0,a.A)({type:"number",step:"0.01"},W("tasks[".concat(l,"].discount"),{min:{value:0,message:"Discount cannot be negative"},validate:e=>{const s=Number(se("tasks[".concat(l,"].amount")));return!(Number(e)>s)||"Discount cannot exceed amount"}})),{},{className:"".concat(n.Ol),placeholder:"Discount",onChange:e=>{const s=Math.max(0,Number(e.target.value)),a=Number(se("tasks[".concat(l,"].amount"))),t=Math.min(s,a);ie("tasks[".concat(l,"].discount"),t);const i=a-t,n=i*Number(se("tasks[".concat(l,"].gstRate")))/100,d=i+n;ie("tasks[".concat(l,"].discountedPrice"),i),ie("tasks[".concat(l,"].gstPrice"),n),ie("tasks[".concat(l,"].finalAmount"),d)}})),(null===(q=te.tasks)||void 0===q||null===(Y=q[l])||void 0===Y?void 0:Y.discount)&&(0,j.jsx)("p",{className:"text-red-500 text-sm",children:null===(H=te.tasks)||void 0===H||null===(E=H[l])||void 0===E||null===(B=E.discount)||void 0===B?void 0:B.message})]}),(0,j.jsxs)("div",{className:"w-full",children:[(0,j.jsx)("label",{className:"".concat(n.Q0),children:"Discounted Price"}),(0,j.jsx)("input",(0,a.A)((0,a.A)({type:"number",step:"0.01",disabled:!0},W("tasks[".concat(l,"].discountedPrice"),{})),{},{className:"".concat(n.Ol),placeholder:"discountedPrice"})),(null===(V=te.tasks)||void 0===V||null===(M=V[l])||void 0===M?void 0:M.discountedPrice)&&(0,j.jsx)("p",{className:"text-red-500 text-sm",children:null===(z=te.tasks)||void 0===z||null===($=z[l])||void 0===$||null===(J=$.discountedPrice)||void 0===J?void 0:J.message})]}),be&&(0,j.jsxs)(j.Fragment,{children:["other"===se("tasks[".concat(l,"].tasktypeId"))?(0,j.jsxs)("div",{className:"",children:[(0,j.jsxs)("label",{className:"".concat(n.Q0),children:["Gst Rate ",(0,j.jsx)("span",{className:"text-red-600",children:"*"})]}),(0,j.jsx)(d.xI,{name:"tasks[".concat(l,"].gstTypeId"),control:le,rules:{required:"GST Rate is required"},render:e=>{var s,t;let{field:i}=e;return(0,j.jsxs)(o.A,(0,a.A)((0,a.A)({},i),{},{showSearch:!0,placeholder:"Select GST Rate",className:"".concat(n.Hy," ").concat(null!==te&&void 0!==te&&null!==(s=te.tasks)&&void 0!==s&&null!==(t=s[l])&&void 0!==t&&t.gstTypeId?"border-[1px] ":"border-gray-300"),onChange:e=>{ie("tasks[".concat(l,"].gstRate"),e),ie("tasks[".concat(l,"].gstTypeId"),e);const s=Number(e),a=Number(se("tasks[".concat(l,"].discountedPrice"))),t=a*s/100,i=a+t;ie("tasks[".concat(l,"].gstPrice"),t),ie("tasks[".concat(l,"].finalAmount"),i)},children:[(0,j.jsx)(o.A.Option,{value:"",children:"Select GST Type"}),pe?(0,j.jsx)(o.A.Option,{disabled:!0,children:(0,j.jsx)(r.A,{})}):null===xe||void 0===xe?void 0:xe.map(e=>(0,j.jsxs)(o.A.Option,{value:null===e||void 0===e?void 0:e.percentage,children:[null===e||void 0===e?void 0:e.percentage," %"]},null===e||void 0===e?void 0:e._id))]}))}}),(null===te||void 0===te||null===(U=te.tasks)||void 0===U||null===(X=U[l])||void 0===X?void 0:X.gstTypeId)&&(0,j.jsx)("p",{className:"text-red-500 text-sm",children:null===te||void 0===te||null===(Z=te.tasks)||void 0===Z||null===(K=Z[l])||void 0===K||null===(ee=K.gstTypeId)||void 0===ee?void 0:ee.message})]}):(0,j.jsxs)("div",{className:"w-full",children:[(0,j.jsx)("label",{className:"".concat(n.Q0),children:"Gst Rate"}),(0,j.jsx)("input",(0,a.A)((0,a.A)({type:"text",disabled:!0},W("tasks[".concat(l,"].gstRate"),{required:"other"===se("tasks[".concat(l,"].tasktypeId"))&&"GST Rate is required",pattern:{value:/^\d+(\.\d{1,2})?$/,message:"Enter a valid GST Rate (e.g., 5, 12.5)"},min:{value:0,message:"GST Rate cannot be less than 0%"},max:{value:100,message:"GST Rate cannot be more than 100%"}})),{},{className:"".concat(n.Ol),placeholder:"GST Rate"})),(null===te||void 0===te||null===(ae=te.tasks)||void 0===ae||null===(ne=ae[l])||void 0===ne?void 0:ne.gstRate)&&(0,j.jsx)("p",{className:"text-red-500 text-sm",children:te.tasks[l].gstRate.message})]}),(0,j.jsxs)("div",{className:"w-full",children:[(0,j.jsx)("label",{className:"".concat(n.Q0),children:"Gst Price"}),(0,j.jsx)("input",(0,a.A)((0,a.A)({type:"text",disabled:!0},W("tasks[".concat(l,"].gstPrice"),{})),{},{className:"".concat(n.Ol),placeholder:"gst Price"})),(null===te||void 0===te||null===(de=te.tasks)||void 0===de||null===(oe=de[l])||void 0===oe?void 0:oe.gstPrice)&&(0,j.jsx)("p",{className:"text-red-500 text-sm",children:null===te||void 0===te||null===(ce=te.tasks)||void 0===ce||null===(re=ce[l])||void 0===re||null===(ve=re.gstPrice)||void 0===ve?void 0:ve.message})]})]}),(0,j.jsxs)("div",{className:"w-full",children:[(0,j.jsx)("label",{className:"".concat(n.Q0),children:"Final Amount"}),(0,j.jsx)("input",(0,a.A)((0,a.A)({type:"number",step:"0.01",disabled:!0},W("tasks[".concat(l,"].finalAmount"),{})),{},{className:"".concat(n.Ol),placeholder:"Final Amount"})),(null===(me=te.tasks)||void 0===me||null===(he=me[l])||void 0===he?void 0:he.finalAmount)&&(0,j.jsx)("p",{className:"text-red-500 text-sm",children:null===(ke=te.tasks)||void 0===ke||null===(Ne=ke[l])||void 0===Ne||null===(je=Ne.finalAmount)||void 0===je?void 0:je.message})]})]})]})}),Ae.length>(null===ce||void 0===ce?void 0:ce.length)&&(0,j.jsx)("button",{type:"button",onClick:()=>re({taskType:"",amount:""}),className:se("isAlltask")?"hidden":"bg-header text-white p-2 px-4 rounded",children:"Add Task Details"}),(0,j.jsx)("div",{className:"w-full md:flex flex-row items-end justify-end my-3",children:(0,j.jsxs)("div",{className:"",children:[(0,j.jsxs)("div",{className:"",children:[(0,j.jsx)("label",{className:"".concat(n.Q0),children:"Total Amount"}),(0,j.jsx)("input",{type:"number",step:"0.01",value:null!==(V=null===de||void 0===de?void 0:de.totalAmount)&&void 0!==V?V:0,className:"".concat(n.Ol),placeholder:"totalAmount",disabled:!0})]}),(0,j.jsxs)("div",{className:"",children:[(0,j.jsx)("label",{className:"".concat(n.Q0),children:"Discount"}),(0,j.jsx)("input",{type:"number",step:"0.01",disabled:!0,value:null!==(M=null===de||void 0===de?void 0:de.totalDiscount)&&void 0!==M?M:0,className:"".concat(n.Ol),placeholder:"Discount"})]}),(0,j.jsxs)("div",{className:"",children:[(0,j.jsx)("label",{className:"".concat(n.Q0),children:"Discounted Price"}),(0,j.jsx)("input",{type:"number",step:"0.01",disabled:!0,value:null!==(z=null===de||void 0===de?void 0:de.totalDiscountedPrice)&&void 0!==z?z:0,className:"".concat(n.Ol),placeholder:"Discounted Price"})]}),"intrastate"===ke&&(0,j.jsxs)("div",{className:"",children:[(0,j.jsx)("label",{className:"".concat(n.Q0),children:"IGST"}),(0,j.jsx)("input",{type:"number",step:"0.01",value:null!==($=null===de||void 0===de?void 0:de.totalGST)&&void 0!==$?$:0,disabled:!0,className:"".concat(n.Ol),placeholder:"IGST"})]}),"interstate"===ke&&(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)("div",{className:"",children:[(0,j.jsx)("label",{className:"".concat(n.Q0),children:"Total SGST"}),(0,j.jsx)("input",{type:"number",step:"0.01",disabled:!0,value:null!==(J=(null===de||void 0===de?void 0:de.totalGST)/2)&&void 0!==J?J:0,className:"".concat(n.Ol),placeholder:"SGST"})]}),(0,j.jsxs)("div",{className:"",children:[(0,j.jsx)("label",{className:"".concat(n.Q0),children:"Total CGST"}),(0,j.jsx)("input",{type:"number",disabled:!0,value:null!==(U=(null===de||void 0===de?void 0:de.totalGST)/2)&&void 0!==U?U:0,className:"".concat(n.Ol),placeholder:"CGST"})]})]}),(0,j.jsxs)("div",{className:"",children:[(0,j.jsx)("label",{className:"".concat(n.Q0),children:"Grand Total"}),(0,j.jsx)("input",{type:"number",value:null!==(X=null===de||void 0===de?void 0:de.totalFinalAmount)&&void 0!==X?X:0,className:"".concat(n.Ol),placeholder:"grandTotal",disabled:!0})]})]})})]}),(0,j.jsx)("div",{className:"flex justify-end my-4",children:(0,j.jsx)("button",{type:"submit",disabled:ve,className:"".concat(ve?"bg-gray-400":"bg-header"," text-white p-2 px-4 rounded"),children:ve?(0,j.jsx)(x.A,{}):"Submit"})})]})]})})},y=e=>{let{label:l,value:s}=e;return(0,j.jsxs)("div",{children:[(0,j.jsx)("p",{className:"text-sm font-medium text-gray-500",children:l}),(0,j.jsx)("p",{className:"text-sm text-gray-800 mt-1",children:null!==s&&void 0!==s?s:"-"})]})}}}]);
//# sourceMappingURL=3870.f29791e4.chunk.js.map