"use strict";(self.webpackChunkca_admin=self.webpackChunkca_admin||[]).push([[8861],{28861:(e,l,a)=>{a.r(l),a.d(l,{default:()=>w});var d=a(89379),s=a(24858),t=a(83003),i=a(73216),o=a(65043),r=a(31174),n=a(15187),c=a(65337),m=a(39160),u=a(42837),v=a(51957),x=a(65512),h=a(70337),p=a(56659),N=a(60446),g=a.n(N),j=a(84448),y=(a(735),a(89427)),I=a(33007),f=a(58215),b=a(94084),A=a(34857),D=a(55971),P=a(70579);const w=function(){const{loading:e}=(0,t.d4)(e=>e.visitor),[l,a]=(0,o.useState)([]),[N,w]=(0,o.useState)(""),{register:C,handleSubmit:S,setValue:q,control:M,formState:{errors:E}}=(0,s.mN)(),[O,T]=(0,o.useState)(!1),[L,_]=(0,o.useState)(!1),[Y,V]=(0,o.useState)(!1),H=(0,t.wA)(),Q=(0,i.Zp)(),{visitorIdEnc:F}=(0,i.g)(),k=(0,r.Yc)(F),{departmentListData:z,loading:B}=(0,t.d4)(e=>e.department),{generalVisitorDetails:R}=(0,t.d4)(e=>e.visitor),{employeList:U}=(0,t.d4)(e=>e.employe),{clientList:$,loading:Z}=(0,t.d4)(e=>e.client),{VisitReasonList:G}=(0,t.d4)(e=>e.visitReason),J=(0,s.FH)({control:M,name:"PDDepartmentId",defaultValue:[]}),K=(0,s.FH)({control:M,name:"PDDepartmentId",defaultValue:""}),W=(0,s.FH)({control:M,name:"PDPinCode",defaultValue:""}),X=(0,s.FH)({control:M,name:"category",defaultValue:""});(0,o.useEffect)(()=>{(async()=>{if(R&&("client"===(null===R||void 0===R?void 0:R.category)||"client"===X)){V(!0);try{const e=await H((0,h.Aq)({text:"",sort:!0,status:!0,isPagination:!1,companyId:null===R||void 0===R?void 0:R.companyId,branchId:null===R||void 0===R?void 0:R.branchId}));null!==e&&void 0!==e&&e.error||q("clientId",null===R||void 0===R?void 0:R.clientId)}catch(e){console.error("Error fetching client data:",e)}finally{V(!1)}}})()},[R,X]),(0,o.useEffect)(()=>{W&&W.length>=4&&W.length<=6&&/^\d{6}$/.test(W)&&(0,n.jh)(W).then(e=>{e&&(q("PDCity",e.city),q("PDState",e.state),q("PDCountry",e.country))}).catch(e=>{console.error("Error fetching data:",e)})},[W]),(0,o.useEffect)(()=>((async()=>{try{T(!0);const e={_id:k};await H((0,f.p_)(e)),T(!1)}catch(e){console.error("Error fetching data:",e)}})(),()=>{H((0,f.$V)())}),[]),(0,o.useEffect)(()=>{(async()=>{if(R){_(!0);try{var e,l,a,d;const s=await H((0,I.UU)({text:"",sort:!0,status:!0,isPagination:!1,companyId:null===R||void 0===R?void 0:R.companyId,branchId:null===R||void 0===R?void 0:R.branchId}));if(null!==s&&void 0!==s&&s.error)throw new Error("Failed to fetch department data");Array.isArray(null===R||void 0===R?void 0:R.departmentIds)&&R.departmentIds.length>0&&q("PDDepartmentId",R.departmentIds[0]);const t=await H((0,u.qV)({directorId:"",companyId:null===R||void 0===R?void 0:R.companyId,branchId:null===R||void 0===R?void 0:R.branchId,departmentId:null===R||void 0===R?void 0:R.departmentId,text:"",sort:!0,status:"",isPagination:!1}));if(null!==t&&void 0!==t&&t.error)throw new Error("Failed to fetch employee data");q("designationName",null===R||void 0===R?void 0:R.name),q("companyId",null===R||void 0===R?void 0:R.companyId),q("branchId",null===R||void 0===R?void 0:R.branchId),Array.isArray(null===R||void 0===R?void 0:R.employeIds)&&R.employeIds.length>0&&q("contactPersonId",R.employeIds[0]),q("employeId",null===R||void 0===R?void 0:R.employeId);const i=H((0,j.Ih)({companyId:null===R||void 0===R?void 0:R.companyId,directorId:"",branchId:null===R||void 0===R?void 0:R.branchId,text:"",sort:!0,status:!0,isPagination:!1}));q("visitorName",null===R||void 0===R?void 0:R.name),q("numberOfPerson",null===R||void 0===R?void 0:R.numberOfPerson),q("status",null===R||void 0===R?void 0:R.status),q("PDPinCode",null===R||void 0===R||null===(e=R.address)||void 0===e?void 0:e.pinCode),q("PDMobileCode",null===R||void 0===R||null===(l=R.mobile)||void 0===l?void 0:l.code),q("PDMobileNo",null===R||void 0===R||null===(a=R.mobile)||void 0===a?void 0:a.number),q("PDAddress",null===R||void 0===R||null===(d=R.address)||void 0===d?void 0:d.street),q("category",null===R||void 0===R?void 0:R.category),q("kilometer",null===R||void 0===R?void 0:R.kilometer),q("date",g()(null===R||void 0===R?void 0:R.date)),q("startTime",g()(null===R||void 0===R?void 0:R.timeDurationStart)),q("endTime",g()(null===R||void 0===R?void 0:R.timeDurationEnd));const o=await i;null!==o&&void 0!==o&&o.error||q("reason",null===R||void 0===R?void 0:R.reason),_(!1)}catch(s){console.error("Error loading visitor data:",s)}}})()},[R]);const[ee,le]=(0,o.useState)([]),[ae,de]=(0,o.useState)([]),[se,te]=(0,o.useState)(!1),[ie,oe]=(0,o.useState)(!1),re=(null===ee||void 0===ee||ee.map(e=>e.value),null===ae||void 0===ae||ae.map(e=>e.value),[{label:"Select All",value:"__all__"},...ee]),ne=[{label:"Select All",value:"__all__"},...Array.isArray(ae)?ae:[]];(0,o.useEffect)(()=>{const e=null===z||void 0===z?void 0:z.map(e=>{var l;return{label:null===e||void 0===e?void 0:e.name,value:null===e||void 0===e?void 0:e._id,searchText:null===e||void 0===e||null===(l=e.name)||void 0===l?void 0:l.toLowerCase()}});le(null!==e&&void 0!==e?e:[])},[z]),(0,o.useEffect)(()=>{const e=null===U||void 0===U?void 0:U.map(e=>{var l;return{label:null===e||void 0===e?void 0:e.fullName,value:null===e||void 0===e?void 0:e._id,searchText:null===e||void 0===e||null===(l=e.fullName)||void 0===l?void 0:l.toLowerCase()}});de(null!==e&&void 0!==e?e:[])},[U]);const ce=()=>{const e={companyId:null===R||void 0===R?void 0:R.companyId,directorId:"",branchId:null===R||void 0===R?void 0:R.branchId,departmentId:J,text:"",sort:!0,status:"",isPagination:!1,multipleDepartmentId:[]};H((0,u.qV)(e))};return console.log("loading",O,L,Y),(0,P.jsx)(m.A,{children:O||L||Y?(0,P.jsx)(D.A,{}):(0,P.jsx)("div",{className:"gap-4",children:(0,P.jsxs)("form",{autoComplete:"off",className:"mt-5",onSubmit:S(e=>{var l,a,d;const s={_id:k,companyId:null===R||void 0===R?void 0:R.companyId,directorId:"",branchId:null===R||void 0===R?void 0:R.branchId,departmentIds:null!==e&&void 0!==e&&e.PDDepartmentId?[null===e||void 0===e?void 0:e.PDDepartmentId]:[],employeIds:null!==e&&void 0!==e&&e.contactPersonId?[null===e||void 0===e?void 0:e.contactPersonId]:[],name:null===e||void 0===e?void 0:e.visitorName,reason:null===e||void 0===e?void 0:e.reason,kilometer:null===e||void 0===e?void 0:e.kilometer,numberOfPerson:Number(null===e||void 0===e?void 0:e.numberOfPerson),clientId:"client"==X?null===e||void 0===e?void 0:e.clientId:null,employeId:null===e||void 0===e?void 0:e.employeId,category:X,timeDurationStart:null===e||void 0===e?void 0:e.startTime,timeDurationEnd:null===e||void 0===e?void 0:e.endTime,date:null===e||void 0===e?void 0:e.date,address:{street:null!==(l=null===e||void 0===e?void 0:e.PDAddress)&&void 0!==l?l:""},mobile:{number:null!==(a=null===e||void 0===e?void 0:e.PDMobileNo)&&void 0!==a?a:"",code:null!==(d=null===e||void 0===e?void 0:e.PDMobileCode)&&void 0!==d?d:""}};H((0,f.o2)(s)).then(e=>{e.error||Q(-1)})}),children:[(0,P.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 md:gap-8 gap-4 md:my-2",children:[(0,P.jsxs)("div",{className:"w-full",children:[(0,P.jsxs)("label",{className:"".concat(n.Q0),children:["Category ",(0,P.jsx)("span",{className:"text-red-600",children:"*"})]}),(0,P.jsx)(s.xI,{control:M,name:"category",rules:{required:"category is required"},render:e=>{let{field:l}=e;return(0,P.jsxs)(x.A,(0,d.A)((0,d.A)({},l),{},{defaultValue:"",className:" ".concat(n.Hy," "),showSearch:!0,filterOption:(e,l)=>String(null===l||void 0===l?void 0:l.children).toLowerCase().includes(e.toLowerCase()),onChange:e=>{l.onChange(e)},children:[(0,P.jsx)(x.A.Option,{className:"",value:"",children:"Select Category"}),(0,P.jsx)(x.A.Option,{value:"general",children:"Employee Visitor"}),(0,P.jsx)(x.A.Option,{value:"client",children:"client Visitor"})]}))}}),E.category&&(0,P.jsx)("p",{className:"text-red-500 text-sm",children:E.category.message})]}),"client"==X&&(0,P.jsxs)("div",{className:"w-full",children:[(0,P.jsxs)("label",{className:"".concat(n.Q0),children:["Client ",(0,P.jsx)("span",{className:"text-red-600",children:"*"})]}),(0,P.jsx)(s.xI,{control:M,name:"clientId",rules:{required:"client is required"},render:e=>{let{field:l}=e;return(0,P.jsxs)(x.A,(0,d.A)((0,d.A)({},l),{},{defaultValue:"",className:" ".concat(n.Hy," "),showSearch:!0,filterOption:(e,l)=>String(null===l||void 0===l?void 0:l.children).toLowerCase().includes(e.toLowerCase()),onFocus:()=>{},onChange:async e=>{var d,s;l.onChange(e);const t=await H((0,A.wo)({_id:e}));null!==t&&void 0!==t&&null!==(d=t.payload)&&void 0!==d&&null!==(s=d.data)&&void 0!==s&&s.departmentData?a(t.payload.data.departmentData):a([])},children:[(0,P.jsx)(x.A.Option,{className:"",value:"",children:"Select Client"}),Z?(0,P.jsx)(x.A.Option,{disabled:!0,children:(0,P.jsx)(y.A,{})}):null===$||void 0===$?void 0:$.map(e=>(0,P.jsx)(x.A.Option,{value:null===e||void 0===e?void 0:e._id,children:null===e||void 0===e?void 0:e.fullName}))]}))}}),E.clientId&&(0,P.jsx)("p",{className:"text-red-500 text-sm",children:E.clientId.message})]}),(0,P.jsxs)("div",{className:"w-full",children:[(0,P.jsxs)("label",{className:"".concat(n.Q0),children:["Name ",(0,P.jsx)("span",{className:"text-red-600",children:"*"})]}),(0,P.jsx)("input",(0,d.A)((0,d.A)({type:"text"},C("visitorName",{required:"Name is required"})),{},{className:"placeholder: ".concat(n.Ol," ").concat(E.visitorName?"border-[1px] ":"border-gray-300"),placeholder:"Enter Name"})),E.visitorName&&(0,P.jsx)("p",{className:"text-red-500 text-sm",children:E.visitorName.message})]}),(0,P.jsxs)("div",{className:"w-full",children:[(0,P.jsxs)("label",{className:"".concat(n.Q0),children:["Department ",(0,P.jsx)("span",{className:"text-red-600",children:"*"})]}),(0,P.jsx)(s.xI,{name:"PDDepartmentId",control:M,rules:{required:"At least one Department is required"},render:e=>{let{field:l}=e;return(0,P.jsx)(x.A,(0,d.A)((0,d.A)({},l),{},{placeholder:"Assign To",size:"large",style:{width:"100%"},options:re,className:"inputAntdMultipleSelectClassName",showSearch:!0,filterOption:(e,l)=>String(null===l||void 0===l?void 0:l.children).toLowerCase().includes(e.toLowerCase())}))}}),E.PDDepartmentId&&(0,P.jsx)("p",{className:"text-red-500 text-sm",children:E.PDDepartmentId.message})]}),"employe"===X&&(0,P.jsxs)("div",{className:"w-full",children:[(0,P.jsxs)("label",{className:"".concat(n.Q0),children:["Employe ",(0,P.jsx)("span",{className:"text-red-600",children:"*"})]}),(0,P.jsxs)("select",(0,d.A)((0,d.A)({onFocus:()=>{const e={directorId:"",companyId:null===R||void 0===R?void 0:R.companyId,branchId:null===R||void 0===R?void 0:R.branchId,departmentId:K,text:"",sort:!0,status:"",isPagination:!1};H((0,u.qV)(e))}},C("employeId",{required:"Employe is required"})),{},{className:" ".concat(n.Ol," ").concat(E.employeId?"border-[1px] ":"border-gray-300"),showSearch:!0,filterOption:(e,l)=>String(null===l||void 0===l?void 0:l.children).toLowerCase().includes(e.toLowerCase()),children:[(0,P.jsx)("option",{className:"",value:"",children:"Select Employe"}),null===U||void 0===U?void 0:U.map(e=>(0,P.jsx)("option",{value:null===e||void 0===e?void 0:e._id,children:null===e||void 0===e?void 0:e.fullName}))]})),E.employeId&&(0,P.jsx)("p",{className:"text-red-500 text-sm",children:E.employeId.message})]}),(0,P.jsxs)("div",{className:"w-full",children:[(0,P.jsxs)("label",{className:"".concat(n.Q0),children:["Contact Person ",(0,P.jsx)("span",{className:"text-red-600",children:"*"})]}),(0,P.jsx)(s.xI,{name:"contactPersonId",control:M,rules:{required:"At least one Contact Person is required"},render:e=>{let{field:l}=e;return(0,P.jsx)(x.A,(0,d.A)((0,d.A)({},l),{},{placeholder:"Assign To",onFocus:ce,size:"large",style:{width:"100%"},options:ne||[],className:"inputAntdMultipleSelectClassName",showSearch:!0,filterOption:(e,l)=>String(null===l||void 0===l?void 0:l.children).toLowerCase().includes(e.toLowerCase())}))}}),E.contactPersonId&&(0,P.jsx)("p",{className:"text-red-500 text-sm",children:E.contactPersonId.message})]}),(0,P.jsxs)("div",{className:"",children:[(0,P.jsxs)("label",{className:"".concat(n.Q0),children:["Start Time ",(0,P.jsx)("span",{className:"text-red-600",children:"*"})]}),(0,P.jsx)(s.xI,{name:"startTime",control:M,showTime:!0,rules:{required:"Start Time  is required"},format:"DD/MM/YYYY HH:mm",render:e=>{let{field:l}=e;return(0,P.jsx)(b.A,{field:l,showTime:!0,format:"DD/MM/YYYY HH:mm",errors:E,disabledDate:e=>e&&e.isBefore(g()().endOf("day"),"day")})}}),E.startTime&&(0,P.jsx)("p",{className:"text-red-500 text-sm",children:E.startTime.message})]}),(0,P.jsxs)("div",{className:"",children:[(0,P.jsxs)("label",{className:"".concat(n.Q0),children:["End Time ",(0,P.jsx)("span",{className:"text-red-600",children:"*"})]}),(0,P.jsx)(s.xI,{name:"endTime",control:M,showTime:!0,rules:{required:"ENd Time  is required"},format:"DD/MM/YYYY HH:mm",render:e=>{let{field:l}=e;return(0,P.jsx)(b.A,{field:l,showTime:!0,format:"DD/MM/YYYY HH:mm",errors:E,disabledDate:e=>e&&e.isBefore(g()().endOf("day"),"day")})}}),E.endTime&&(0,P.jsx)("p",{className:"text-red-500 text-sm",children:E.endTime.message})]}),(0,P.jsxs)("div",{className:"",children:[(0,P.jsxs)("label",{className:"".concat(n.Q0),children:["Date ",(0,P.jsx)("span",{className:"text-red-600",children:"*"})]}),(0,P.jsx)(s.xI,{name:"date",control:M,rules:{required:"date  is required"},render:e=>{let{field:l}=e;return(0,P.jsx)(b.A,{field:l,errors:E,disabledDate:e=>e&&e.isBefore(g()().endOf("day"),"day")})}}),E.date&&(0,P.jsx)("p",{className:"text-red-500 text-sm",children:E.date.message})]}),(0,P.jsxs)("div",{className:"w-full",children:[(0,P.jsxs)("label",{className:"".concat(n.Q0),children:["Reason ",(0,P.jsx)("span",{className:"text-red-600",children:"*"})]}),(0,P.jsx)(s.xI,{control:M,name:"reason",rules:{required:"reason is required"},render:e=>{var l;let{field:a}=e;return(0,P.jsx)(v.A,(0,d.A)((0,d.A)({className:"w-full"},a),{},{onChange:e=>{a.onChange(e)},options:null===(l=(0,n._o)(G))||void 0===l?void 0:l.map(e=>({value:null===e||void 0===e?void 0:e.title})),children:(0,P.jsx)("input",{placeholder:"Enter Country",className:"".concat(n.Ol)})}))}}),E.reason&&(0,P.jsx)("p",{className:"text-red-500 text-sm",children:E.reason.message})]})]}),(0,P.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 md:gap-8 md:my-2 my-4",children:(0,P.jsxs)("div",{className:"col-span-2",children:[(0,P.jsxs)("label",{className:"".concat(n.Q0),children:["Address"," ","general"!==X&&(0,P.jsx)("span",{className:"text-red-600",children:"*"})]}),(0,P.jsx)("input",(0,d.A)((0,d.A)({type:"text"},C("PDAddress",{required:"general"!==X&&"Address is required"})),{},{className:"".concat(n.Ol," ").concat(E.PDAddress?"border-[1px] ":"border-gray-300"),placeholder:"Enter Address "})),E.PDAddress&&(0,P.jsx)("p",{className:"text-red-500 text-sm",children:E.PDAddress.message})]})}),(0,P.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 md:gap-8 gap-4 my-3 ",children:(0,P.jsxs)("div",{className:"flex gap-3",children:[(0,P.jsxs)("div",{className:"w-[150px]",children:[(0,P.jsxs)("label",{className:"".concat(n.Q0),children:["Code ",(0,P.jsx)("span",{className:"text-red-600",children:"*"})]}),(0,P.jsx)(s.xI,{control:M,name:"PDMobileCode",rules:{required:"code is required"},render:e=>{let{field:l}=e;return(0,P.jsx)(p.A,{field:l,errors:E})}}),E.PDMobileCode&&(0,P.jsx)("p",{className:"".concat(n.ci),children:E.PDMobileCode.message})]}),(0,P.jsxs)("div",{className:"w-full",children:[(0,P.jsxs)("label",{className:"".concat(n.Q0),children:["Mobile No ",(0,P.jsx)("span",{className:"text-red-600",children:"*"})]}),(0,P.jsx)("input",(0,d.A)((0,d.A)({type:"number"},C("PDMobileNo",{required:"Mobile No is required",minLength:{value:10,message:"Must be exactly 10 digits"},maxLength:{value:10,message:"Must be exactly 10 digits"}})),{},{className:" ".concat(n.Ol," ").concat(E.PDMobileNo?"border-[1px] ":"border-gray-300"),placeholder:"Enter Mobile No",maxLength:10,onInput:e=>{e.target.value.length>10&&(e.target.value=e.target.value.slice(0,10))}})),E.PDMobileNo&&(0,P.jsx)("p",{className:"text-red-500 text-sm",children:E.PDMobileNo.message})]})]})}),(0,P.jsx)("div",{className:"flex justify-end ",children:(0,P.jsx)("button",{type:"submit",disabled:e,className:"".concat(e?"bg-gray-400":"bg-header"," text-white p-2 px-4 rounded mt-3"),children:e?(0,P.jsx)(c.A,{}):"Submit"})})]})})})}},65337:(e,l,a)=>{a.d(l,{A:()=>t});var d=a(91686),s=a(70579);const t=function(){return(0,s.jsx)("div",{className:"flex justify-center items-center h-[80vh]",children:(0,s.jsx)(d.A,{size:"large"})})}}}]);
//# sourceMappingURL=8861.68cf056a.chunk.js.map