"use strict";(self.webpackChunkca_admin=self.webpackChunkca_admin||[]).push([[9571],{29571:(e,t,a)=>{a.r(t),a.d(t,{default:()=>T});var n=a(65043),l=a(39160),i=a(73216),s=a(35475),o=a(83003),d=a(23156),c=a(47196),r=a(30064),u=a.n(r),v=a(31174),m=a(78227),x=a(15187),h=(a(31744),a(47989)),p=a(60184),b=a(30326),y=a(96603),f=a(65512),g=a(96651),j=a(4938),N=a(55971),w=a(60446),D=a.n(w),A=a(83002),I=a(89427),P=a(60397),k=a(8928),C=(a(33007),a(6720)),S=a(59e3),L=a(70579);const T=function(){var e;const t=(0,i.Zp)(),a=(0,o.wA)(),{invoiceListData:r,totalinvoiceListCount:w,loading:T}=(0,o.d4)(e=>e.invoice),{officeAddressListData:_,loading:B}=(0,o.d4)(e=>e.officeAddress),{branchList:F,branchListloading:z}=(0,o.d4)(e=>e.branch),{departmentListData:O,loading:Y}=(0,o.d4)(e=>e.department),H=JSON.parse(localStorage.getItem("user_info_".concat(x.AU))),[M,E]=(0,s.ok)(),R=parseInt(M.get("page"))||1,W=M.get("branchId")||"",q=M.get("status")||"",G=M.get("isDeleted")||"false",J=M.get("layoutId")||"",K=M.get("departmentId")||"",[U,V]=(0,n.useState)(R),[X,Z]=(0,n.useState)(10),[Q,$]=(0,n.useState)(q),[ee,te]=(0,n.useState)(G),[ae,ne]=(0,n.useState)(J),[le,ie]=(0,n.useState)(""),[se,oe]=(0,n.useState)(W),[de,ce]=(0,n.useState)(K);(0,n.useEffect)(()=>{const e=new URLSearchParams;U>1&&e.set("page",U),se&&e.set("branchId",se),Q&&e.set("status",Q),ae&&e.set("layoutId",ae),de&&e.set("departmentId",de),ee&&e.set("isDeleted",ee),E(e)},[U,X,se,Q,ae,le,de,ee]),(0,n.useEffect)(()=>{"manager"===(null===H||void 0===H?void 0:H.roleKey)&&"employee"===(null===H||void 0===H?void 0:H.userType)&&re()},[U,X,se,Q,ae,le,de,ee]);const re=()=>{const e={currentPage:U,pageSize:X,reqData:{directorId:"",companyId:null===H||void 0===H?void 0:H.companyId,branchId:null===H||void 0===H?void 0:H.branchId,invoiceLayoutId:ae,departmentId:null===H||void 0===H?void 0:H.departmentId,text:le,sort:!0,status:Q,isPagination:!0,isDeleted:!0===ee||"true"===ee}};a((0,h.uB)(e))},{canCreate:ue,canRead:ve,canUpdate:me,canDelete:xe}=(0,j.A)();(0,n.useEffect)(()=>{"manager"===(null===H||void 0===H?void 0:H.roleKey)&&"employee"===(null===H||void 0===H?void 0:H.userType)&&he()},[se]);const he=()=>{a((0,k.XY)({companyId:"company"===(null===H||void 0===H?void 0:H.userType)?null===H||void 0===H?void 0:H._id:null===H||void 0===H?void 0:H.companyId,branchId:"company"===(null===H||void 0===H?void 0:H.userType)||"admin"===(null===H||void 0===H?void 0:H.userType)||"companyDirector"===(null===H||void 0===H?void 0:H.userType)?se:"companyBranch"===(null===H||void 0===H?void 0:H.userType)?null===H||void 0===H?void 0:H._id:null===H||void 0===H?void 0:H.branchId,directorId:"",text:"",sort:!0,status:!0,type:"invoice",isPagination:!1,bankAccountId:"",isGSTEnabled:""}))};return"manager"!==(null===H||void 0===H?void 0:H.roleKey)||"employee"!==(null===H||void 0===H?void 0:H.userType)?(0,L.jsx)(l.A,{children:(0,L.jsx)("div",{className:"bg-red-100 text-red-800 p-4 rounded-md mt-2",children:(0,L.jsx)("p",{className:"text-center font-semibold",children:"You are not a Manager. This page is viewable for Manager only."})})}):(0,L.jsx)(l.A,{onChange:e=>{ie(e)},children:(0,L.jsxs)(L.Fragment,{children:[(0,L.jsxs)("div",{className:"",children:[(0,L.jsxs)(y.Ay.Group,{onChange:e=>{te((null===e||void 0===e?void 0:e.target.value)||e),V(1)},value:ee||"",disabled:T,optionType:"button",buttonStyle:"solid",style:{width:"100%"},children:[(0,L.jsx)(y.Ay.Button,{value:"false",style:{flex:1,textAlign:"center",fontWeight:"500"},children:"Active Records"}),(0,L.jsx)(y.Ay.Button,{value:"true",style:{flex:1,textAlign:"center",fontWeight:"500"},children:"Deleted Records"})]}),(0,L.jsxs)("div",{class:"sm:flex justify-between items-center py-1 lg:space-y-0 space-y-2 overflow-y-auto",children:[(0,L.jsxs)("div",{className:"grid md:flex sm:grid-cols-3 grid-cols-1 flex-wrap md:gap-3 gap-1.5",children:[(0,L.jsx)("div",{className:"",children:(0,L.jsxs)(f.A,{value:ae,onChange:e=>{ne(e),V(1)},disabled:T,showSearch:!0,filterOption:(e,t)=>{var a;return null===t||void 0===t||null===(a=t.label)||void 0===a?void 0:a.toLowerCase().includes(e.toLowerCase())},className:"".concat(x.Lp," "),placeholder:"Select Layout",onFocus:()=>{},children:[(0,L.jsx)(f.A.Option,{className:"",value:"",children:"Select Layout"}),B?(0,L.jsx)(f.A.Option,{disabled:!0,children:(0,L.jsx)(I.A,{})}):null===(e=(0,x._o)(_,"firmName"))||void 0===e?void 0:e.map(e=>(0,L.jsx)(f.A.Option,{value:null===e||void 0===e?void 0:e._id,children:null===e||void 0===e?void 0:e.firmName}))]})}),(0,L.jsx)("div",{children:(0,L.jsxs)(f.A,{value:Q,onChange:e=>{$(e),V(1)},disabled:T,className:"".concat(x.Lp," "),showSearch:!0,filterOption:(e,t)=>String(null===t||void 0===t?void 0:t.children).toLowerCase().includes(e.toLowerCase()),children:[(0,L.jsx)(f.A.Option,{value:"",children:"Select status"}),(0,L.jsx)(f.A.Option,{value:"PendingPayment",children:"Pending Payment"}),(0,L.jsx)(f.A.Option,{value:"Paid",children:"Paid"})]})})]}),(0,L.jsxs)("div",{className:"flex justify-end items-center gap-2 ",children:[(0,L.jsx)("button",{onClick:()=>{V(1),oe(""),$(""),ne(""),ie("")},className:"bg-header   py-[6px]  rounded-md  flex px-5 justify-center items-center  text-white",children:(0,L.jsx)("span",{className:"whitespace-nowrap  text-[12px]",children:"Reset"})}),ue&&(0,L.jsx)(g.A,{placement:"topLeft",title:"Add Invoice",children:(0,L.jsxs)("button",{onClick:()=>{t("/admin/invoice/create")},className:"bg-header px-2 py-1.5 rounded-md flex justify-center items-center space-x-2 text-white",children:[(0,L.jsx)(d.OiG,{}),(0,L.jsx)("span",{className:"text-[12px] whitespace-nowrap",children:"Add Invoice"})]})})]})]})]}),(0,L.jsx)("div",{className:"bg-[#ffffff] w-full overflow-x-auto mt-1 rounded-xl",children:ve&&(0,L.jsxs)("table",{className:"w-full max-w-full rounded-xl overflow-x-auto ",children:[(0,L.jsx)("thead",{className:"",children:(0,L.jsxs)("tr",{className:"border-b-[1px] border-[#DDDDDD] bg-header capitalize text-[#ffff] font-[500] h-[40px]",children:[(0,L.jsx)("th",{className:"tableHead w-[10%]",children:"S.No."}),(0,L.jsx)("th",{className:"tableHead",children:"Date"}),(0,L.jsx)("th",{className:"tableHead",children:"Invoice number"}),(0,L.jsx)("th",{className:"tableHead",children:"Client Name"}),(0,L.jsx)("th",{className:"tableHead",children:"Invoice Amount"}),me&&"false"==ee&&(0,L.jsx)("th",{className:"tableHead",children:"Status"}),(me||xe||ve)&&"false"==ee&&(0,L.jsx)("th",{className:"tableHead w-[10%]",children:"Action"}),"true"==ee&&(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)("th",{className:"tableHead",children:"Deleted By"}),(0,L.jsx)("th",{className:"tableHead",children:"Deleted At"})]})]})}),T?(0,L.jsx)("tr",{className:"bg-white bg-opacity-5 ",children:(0,L.jsx)("td",{colSpan:10,className:"px-6 py-2 whitespace-nowrap font-[600] text-sm text-gray-500",children:(0,L.jsx)(N.A,{})})}):(0,L.jsx)("tbody",{children:r&&(null===r||void 0===r?void 0:r.length)>0?null===r||void 0===r?void 0:r.map((e,n)=>(0,L.jsxs)("tr",{className:"text-black ".concat(n%2===0?"bg-[#e9ecef]/80":"bg-white"," border-b-[1px] border-[#DDDDDD]"),children:[(0,L.jsx)("td",{className:"tableData",children:n+1+(U-1)*X}),(0,L.jsx)("td",{className:"tableData",children:D()(null===e||void 0===e?void 0:e.createdAt).format("DD-MM-YYYY hh:mm a")||"-"}),(0,L.jsx)("td",{className:"tableData text-left",children:null===e||void 0===e?void 0:e.invoiceNumber}),(0,L.jsx)("td",{className:"tableData",children:null===e||void 0===e?void 0:e.clientName}),(0,L.jsx)("td",{className:"tableData",children:(0,x.w2)((null===e||void 0===e?void 0:e.grandTotal)||0)}),me&&"false"==ee&&(0,L.jsx)("td",{className:"tableData",children:(0,L.jsx)("span",{className:"px-2 py-1 whitespace-nowrap rounded text-xs font-[500] ".concat("PendingPayment"===(null===e||void 0===e?void 0:e.status)?"bg-rose-100 border-[1px] border-rose-400 text-rose-700":"bg-green-100 border-[1px] border-green-400 text-green-700"),children:"PendingPayment"===(null===e||void 0===e?void 0:e.status)?"Payment Pending":null===e||void 0===e?void 0:e.status})}),(me||xe||ve)&&"false"==ee&&(0,L.jsx)("td",{className:"tableData",children:(0,L.jsxs)("span",{className:"py-1.5 flex justify-start items-center space-x-2.5",children:[(0,L.jsx)(g.A,{placement:"topLeft",title:"Download Invoice",children:ve&&(0,L.jsx)("button",{onClick:()=>t("/admin/viewInvoice?invoiceId=".concat((0,v.w)(null===e||void 0===e?void 0:e._id),"&type=invoice&downloadPdfPath=").concat(null!==e&&void 0!==e&&e.invoicePDFPath?(0,v.w)(null===e||void 0===e?void 0:e.invoicePDFPath):"")),className:"px-2 py-1.5 text-xs rounded-md bg-transparent border border-muted",type:"button",children:(0,L.jsx)(p.Ny1,{className:"hover:text-header text-header",size:15})})}),(0,L.jsx)(g.A,{placement:"topLeft",title:"More Actions",children:(0,L.jsx)(b.A,{menu:{items:[me&&{key:"edit",label:"PendingPayment"===(null===e||void 0===e?void 0:e.status)&&me?(0,L.jsxs)("span",{onClick:()=>{window.location.href="/admin/invoice/edit/".concat((0,v.w)(null===e||void 0===e?void 0:e._id))},className:"flex items-center text-[#3c8dbc] hover:text-[#337ab7]",children:[(0,L.jsx)(d.Jcp,{className:"mr-2",size:16}),"Edit"]}):(0,L.jsxs)("span",{className:"flex items-center text-gray-500 cursor-not-allowed",children:[(0,L.jsx)(d.Jcp,{className:"mr-2",size:16}),"Paid (No Actions)"]})},xe&&{key:"delete",label:"Paid"!==(null===e||void 0===e?void 0:e.status)&&xe?(0,L.jsxs)("span",{onClick:()=>(e=>{let t={_id:e};u().fire({title:"Warning",text:"Are you sure you want to delete!",icon:"warning",showCancelButton:!0,cancelButtonText:"No"}).then(e=>{e.isConfirmed&&a((0,h.n1)(t)).then(e=>{re()})})})(null===e||void 0===e?void 0:e._id),className:"flex items-center text-red-600 hover:text-red-500",children:[(0,L.jsx)(c.tqC,{className:"mr-2",size:16}),"Delete"]}):(0,L.jsxs)("span",{className:"flex items-center text-gray-500 cursor-not-allowed",children:[(0,L.jsx)(c.tqC,{className:"mr-2",size:16}),"Paid (No Actions)"]})},{key:"created-by",label:(0,L.jsxs)("span",{onClick:()=>(0,x.v2)((null===e||void 0===e?void 0:e.createdBy)||"Data not available"),className:"flex items-center text-sky-800 hover:text-sky-700",children:[(0,L.jsx)(P.cCX,{className:"mr-2",size:16}),"Created By"]})},{key:"send-email",label:(0,L.jsxs)("span",{onClick:()=>(e=>{var t,n;const l='\n    <div style="font-family: Arial, sans-serif; color: #333;">\n      <h2>Invoice #'.concat(null===e||void 0===e?void 0:e.invoiceNumber,"</h2>\n      <p>Dear ").concat(null===e||void 0===e||null===(t=e.clientData)||void 0===t?void 0:t.fullName,',</p>\n      <p>Please find your invoice attached.</p>\n      \n      \x3c!-- Optional: iframe preview (note: most email clients block this) --\x3e\n      <p><strong>Invoice Preview:</strong></p>\n      <a href="').concat(null===e||void 0===e?void 0:e.invoicePDFurl,'" target="_blank" style="color: #1a73e8;">View Invoice</a>\n      \n      \x3c!-- Download Button (styled as link because buttons aren\'t reliable in email) --\x3e\n      <p>\n        <a href="').concat(null===e||void 0===e?void 0:e.invoicePDFurl,'" download style="\n          display: inline-block;\n          padding: 10px 15px;\n          background-color: #4CAF50;\n          color: white;\n          text-decoration: none;\n          border-radius: 5px;\n        ">\n          Download Invoice PDF\n        </a>\n      </p>\n      \n      <hr>\n      <p>Thank you<br></p>\n    </div>\n  ');a((0,S.MD)({content:l,to:null===e||void 0===e||null===(n=e.clientData)||void 0===n?void 0:n.email,cc:[],subject:"Invoice ".concat(null===e||void 0===e?void 0:e.invoiceNumber),attachments:[]})).then(e=>{e.error||u().fire({icon:"success",title:"Email Sent",html:"<p>Invoice sent to Client</p>",confirmButtonColor:"#3085d6"})})})(e),className:"flex items-center text-sky-800 hover:text-sky-700",children:[(0,L.jsx)(C.mm2,{className:"mr-2",size:16}),"send Invoice Mail"]})},{key:"View Invoice",label:(0,L.jsxs)("span",{onClick:()=>{if(null!==e&&void 0!==e&&e.invoicePDFPath){const t="".concat("https://vigapi.vigorousit.com","/public").concat(null===e||void 0===e?void 0:e.invoicePDFPath),a=document.createElement("a");a.href=t,a.target="_blank",a.rel="noopener noreferrer",document.body.appendChild(a),a.click(),document.body.removeChild(a)}},className:"flex items-center text-sky-800 hover:text-sky-700",children:[(0,L.jsx)(p.WCW,{className:"mr-2",size:16}),"Downlaod Invoice"]})}]},trigger:["click"],children:(0,L.jsx)("button",{className:"px-2 py-1.5 text-xs rounded-md bg-transparent border border-muted",type:"button",children:(0,L.jsx)(A.xWf,{className:"hover:text-[#337ab7] text-[#3c8dbc]",size:16})})})})]})}),"true"==ee&&(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)("td",{className:"tableData",children:null!==e&&void 0!==e&&e.updatedBy?null===e||void 0===e?void 0:e.updatedBy:"-"}),(0,L.jsx)("td",{className:"tableData",children:null!==e&&void 0!==e&&e.updatedAt?D()(null===e||void 0===e?void 0:e.updatedAt).format("DD-MM-YYYY hh:mm a"):"-"})]})]})):(0,L.jsx)("tr",{className:"bg-white bg-opacity-5",children:(0,L.jsx)("td",{colSpan:5,className:"px-6 py-2 whitespace-nowrap font-[600] text-sm text-gray-500",children:"Record Not Found"})})})]})}),(null===r||void 0===r?void 0:r.length)>0&&(0,L.jsx)(m.A,{totalCount:w,pageSize:X,currentPage:U,onChange:e=>V(e)})]})})}}}]);
//# sourceMappingURL=9571.12d63046.chunk.js.map