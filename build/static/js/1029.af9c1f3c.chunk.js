"use strict";(self.webpackChunkca_admin=self.webpackChunkca_admin||[]).push([[1029],{41029:(e,l,a)=>{a.r(l),a.d(l,{default:()=>w});var s=a(89379),r=a(24858),n=a(83003),t=a(73216),d=a(65043),i=a(31174),o=a(15187),c=a(58215),u=a(65337),m=a(39160),v=a(42837),x=a(51957),h=a(65512),p=a(30575),N=a(36105),g=a(84480),j=a(70337),y=a(86178),b=a.n(y),P=a(56659),f=(a(60446),a(84448)),I=(a(735),a(89427)),D=a(33007),A=a(55971),C=a(70579);const w=function(){const{loading:e}=(0,n.d4)(e=>e.visitor),[l,a]=(0,d.useState)([]),{register:y,handleSubmit:w,setValue:O,control:q,formState:{errors:S}}=(0,r.mN)(),[E,L]=(0,d.useState)(!1),[M,Q]=(0,d.useState)(!1),k=(0,n.wA)(),V=(0,t.Zp)(),{visitorIdEnc:F}=(0,t.g)(),H=(0,i.Yc)(F),{visitorDetails:_}=(0,n.d4)(e=>e.visitor),{departmentListData:T,loading:B}=(0,n.d4)(e=>e.department),{countryListData:R}=(0,n.d4)(e=>e.country),{stateListData:Y}=(0,n.d4)(e=>e.states),{cityListData:z}=(0,n.d4)(e=>e.city),{clientList:U}=(0,n.d4)(e=>e.client),{VisitReasonList:$}=(0,n.d4)(e=>e.visitReason),G=(0,r.FH)({control:q,name:"PDDepartmentId",defaultValue:""}),K=(0,r.FH)({control:q,name:"PDState",defaultValue:""}),Z=(0,r.FH)({control:q,name:"PDCountry",defaultValue:""}),J=(0,r.FH)({control:q,name:"PDPinCode",defaultValue:""}),W=(0,r.FH)({control:q,name:"category",defaultValue:""});return(0,d.useEffect)(()=>{J&&J.length>=4&&J.length<=6&&/^\d{6}$/.test(J)&&(0,o.jh)(J).then(e=>{e&&(O("PDCity",e.city),O("PDState",e.state),O("PDCountry",e.country))}).catch(e=>{console.error("Error fetching data:",e)})},[J]),(0,d.useEffect)(()=>{L(!0);return(async()=>{try{const e={_id:H};await k((0,c.Rd)(e))}catch(e){console.error("Error fetching data:",e)}finally{L(!1)}})(),()=>{k((0,c.$V)())}},[]),(0,d.useEffect)(()=>{(async()=>{if(_)try{var e,l,s,r,n,t,d;Q(!0);const[i,o]=await Promise.all([k((0,D.UU)({text:"",sort:!0,status:!0,isPagination:!1,companyId:null===_||void 0===_?void 0:_.companyId,branchId:null===_||void 0===_?void 0:_.branchId})),k((0,j.Aq)({text:"",sort:!0,status:!0,isPagination:!1,companyId:null===_||void 0===_?void 0:_.companyId,branchId:null===_||void 0===_?void 0:_.branchId}))]);if(null!==i&&void 0!==i&&i.error||null!==o&&void 0!==o&&o.error)throw new Error("Failed to fetch department or client data");const c=await k((0,v.qV)({directorId:"",companyId:null===_||void 0===_?void 0:_.companyId,branchId:null===_||void 0===_?void 0:_.branchId,departmentId:null===_||void 0===_?void 0:_.departmentId,text:"",sort:!0,status:"",isPagination:!1,isBranch:!0,isDirector:!0}));if(null!==c&&void 0!==c&&c.error)throw new Error("Failed to fetch employee data");const u=null===c||void 0===c||null===(e=c.payload)||void 0===e||null===(l=e.data)||void 0===l||null===(s=l.docs)||void 0===s?void 0:s.map(e=>({label:(0,C.jsxs)("div",{className:"flex gap-2 items-center",children:[e.fullName,(0,C.jsx)("div",{className:"text-[10px] text-gray-500",children:"companyDirector"===e.userType?"Director":"companyBranch"===e.userType?"Branch Head":""})]}),value:e._id,searchText:e.fullName.toLowerCase()}));a(u);const m=await k((0,f.Ih)({companyId:null===_||void 0===_?void 0:_.companyId,directorId:"",branchId:null===_||void 0===_?void 0:_.branchId,text:"",sort:!0,status:!0,isPagination:!1}));null!==m&&void 0!==m&&m.error||O("reason",null===_||void 0===_?void 0:_.visitReasonId),O("clientId",null===_||void 0===_?void 0:_.clientId),O("PDDepartmentId",null===_||void 0===_?void 0:_.departmentId),O("designationName",null===_||void 0===_?void 0:_.name),O("companyId",null===_||void 0===_?void 0:_.companyId),O("branchId",null===_||void 0===_?void 0:_.branchId),O("contactPersonId",null===_||void 0===_?void 0:_.contactPersonId),O("employeId",null===_||void 0===_?void 0:_.employeId),O("visitorName",null===_||void 0===_?void 0:_.name),O("numberOfPerson",null===_||void 0===_?void 0:_.numberOfPerson),O("PDDepartmentId",null===_||void 0===_?void 0:_.departmentId),O("status",null===_||void 0===_?void 0:_.status),O("PDPinCode",null===_||void 0===_||null===(r=_.address)||void 0===r?void 0:r.pinCode),O("PDMobileCode",null===_||void 0===_||null===(n=_.mobile)||void 0===n?void 0:n.code),O("PDMobileNo",null===_||void 0===_||null===(t=_.mobile)||void 0===t?void 0:t.number),O("PDAddress",null===_||void 0===_||null===(d=_.address)||void 0===d?void 0:d.street),O("category",null===_||void 0===_?void 0:_.category),O("kilometer",null===_||void 0===_?void 0:_.kilometer),O("date",b()(null===_||void 0===_?void 0:_.date).format("YYYY-MM-DD")),Q(!1)}catch(i){console.error("Error fetching visitor details:",i)}})()},[_]),(0,C.jsx)(m.A,{children:E||M?(0,C.jsx)(A.A,{}):(0,C.jsx)("div",{className:"gap-4",children:(0,C.jsxs)("form",{autoComplete:"off",className:"mt-0",onSubmit:w(e=>{var l,a,s,r,n,t,d;const i={_id:H,companyId:null===_||void 0===_?void 0:_.companyId,directorId:"",branchId:null===_||void 0===_?void 0:_.branchId,departmentId:G,contactPersonId:null===e||void 0===e?void 0:e.contactPersonId,name:null===e||void 0===e?void 0:e.visitorName,reason:null===e||void 0===e?void 0:e.reason,visitReasonId:null===e||void 0===e?void 0:e.reason,status:null===e||void 0===e?void 0:e.status,clientId:null===e||void 0===e?void 0:e.clientId,employeId:null===e||void 0===e?void 0:e.employeId,numberOfPerson:Number(null===e||void 0===e?void 0:e.numberOfPerson),category:null===e||void 0===e?void 0:e.category,kilometer:Number(null===e||void 0===e?void 0:e.kilometer),date:null!==e&&void 0!==e&&e.date?null===e||void 0===e?void 0:e.date:null,checkOutTime:null,address:{street:null!==(l=null===e||void 0===e?void 0:e.PDAddress)&&void 0!==l?l:"",city:null!==(a=null===e||void 0===e?void 0:e.PDCity)&&void 0!==a?a:"",state:null!==(s=null===e||void 0===e?void 0:e.PDState)&&void 0!==s?s:"",country:null!==(r=null===e||void 0===e?void 0:e.PDCountry)&&void 0!==r?r:"",pinCode:null!==(n=null===e||void 0===e?void 0:e.PDPinCode)&&void 0!==n?n:""},mobile:{number:null!==(t=null===e||void 0===e?void 0:e.PDMobileNo)&&void 0!==t?t:"",code:null!==(d=null===e||void 0===e?void 0:e.PDMobileCode)&&void 0!==d?d:""}};k((0,c._z)(i)).then(e=>{e.error||V(-1)})}),children:[(0,C.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 md:gap-8 gap-4 md:my-2",children:[(0,C.jsxs)("div",{className:"w-full",children:[(0,C.jsxs)("label",{className:"".concat(o.Q0),children:["Category ",(0,C.jsx)("span",{className:"text-red-600",children:"*"})]}),(0,C.jsx)(r.xI,{control:q,name:"category",rules:{required:"category is required"},render:e=>{let{field:l}=e;return(0,C.jsxs)(h.A,(0,s.A)((0,s.A)({},l),{},{defaultValue:"",disabled:!0,className:" ".concat(o.Hy," "),showSearch:!0,filterOption:(e,l)=>String(null===l||void 0===l?void 0:l.children).toLowerCase().includes(e.toLowerCase()),children:[(0,C.jsx)(h.A.Option,{className:"",value:"",children:"Select Category"}),(0,C.jsx)(h.A.Option,{value:"general",children:"General Visitor"}),(0,C.jsx)(h.A.Option,{value:"existing",children:"Existing Client"}),(0,C.jsx)(h.A.Option,{value:"new",children:"New Client"})]}))}}),S.category&&(0,C.jsx)("p",{className:"text-red-500 text-sm",children:S.category.message})]}),(0,C.jsxs)("div",{className:"w-full",children:[(0,C.jsxs)("label",{className:"".concat(o.Q0),children:["Name ",(0,C.jsx)("span",{className:"text-red-600",children:"*"})]}),(0,C.jsx)("input",(0,s.A)((0,s.A)({type:"text"},y("visitorName",{required:"Name is required"})),{},{className:"placeholder: ".concat(o.Ol," ").concat(S.visitorName?"border-[1px] ":"border-gray-300"),placeholder:"Enter Name"})),S.visitorName&&(0,C.jsx)("p",{className:"text-red-500 text-sm",children:S.visitorName.message})]}),(0,C.jsxs)("div",{className:"w-full",children:[(0,C.jsxs)("label",{className:"".concat(o.Q0),children:["Department ",(0,C.jsx)("span",{className:"text-red-600",children:"*"})]}),(0,C.jsx)(r.xI,{name:"PDDepartmentId",control:q,rules:{required:"Department is required"},render:e=>{let{field:l}=e;return(0,C.jsxs)(h.A,(0,s.A)((0,s.A)({},l),{},{className:"".concat(o.Hy," ").concat(S.PDDepartmentId?"":"border-gray-300"),showSearch:!0,filterOption:(e,l)=>String(null===l||void 0===l?void 0:l.children).toLowerCase().includes(e.toLowerCase()),onChange:e=>{l.onChange(e)},placeholder:"Select Department",children:[(0,C.jsx)(h.A.Option,{value:"",children:"Select Department"}),B?(0,C.jsx)(h.A.Option,{disabled:!0,children:(0,C.jsx)(I.A,{})}):null===T||void 0===T?void 0:T.map(e=>(0,C.jsx)(h.A.Option,{value:null===e||void 0===e?void 0:e._id,children:null===e||void 0===e?void 0:e.name},null===e||void 0===e?void 0:e._id))]}))}}),S.PDDepartmentId&&(0,C.jsx)("p",{className:"text-red-500 text-sm",children:S.PDDepartmentId.message})]}),(0,C.jsxs)("div",{className:"w-full",children:[(0,C.jsxs)("label",{className:"".concat(o.Q0),children:["Contact Person ",(0,C.jsx)("span",{className:"text-red-600",children:"*"})]}),(0,C.jsx)(r.xI,{control:q,name:"contactPersonId",rules:{required:"contact Person is required"},render:e=>{let{field:r}=e;return(0,C.jsx)(h.A,(0,s.A)((0,s.A)({},r),{},{defaultValue:"",onFocus:()=>{var e;const l={directorId:"",companyId:null===_||void 0===_?void 0:_.companyId,branchId:null===_||void 0===_?void 0:_.branchId,departmentId:G,text:"",sort:!0,status:"",isPagination:!1,isBranch:!0,isDirector:!0};null===(e=k((0,v.qV)(l)))||void 0===e||e.then(e=>{var l,s,r;const n=null===e||void 0===e||null===(l=e.payload)||void 0===l||null===(s=l.data)||void 0===s||null===(r=s.docs)||void 0===r?void 0:r.map(e=>({label:(0,C.jsxs)("div",{className:"flex gap-2 items-center",children:[e.fullName,(0,C.jsx)("div",{className:"text-[10px] text-gray-500",children:"companyDirector"===e.userType?"Director":"companyBranch"===e.userType?"Branch Head":""})]}),value:e._id,searchText:e.fullName.toLowerCase()}));a(n)})},className:" ".concat(o.Hy," "),showSearch:!0,filterOption:(e,l)=>String(null===l||void 0===l?void 0:l.children).toLowerCase().includes(e.toLowerCase()),options:l}))}}),S.contactPersonId&&(0,C.jsx)("p",{className:"text-red-500 text-sm",children:S.contactPersonId.message})]}),("existing"===W||"employe"===W)&&(0,C.jsxs)("div",{className:"w-full",children:[(0,C.jsxs)("label",{className:"".concat(o.Q0),children:["Client ",(0,C.jsx)("span",{className:"text-red-600",children:"*"})]}),(0,C.jsx)(r.xI,{control:q,name:"clientId",rules:{required:"client is required"},render:e=>{let{field:l}=e;return(0,C.jsxs)(h.A,(0,s.A)((0,s.A)({},l),{},{className:" ".concat(o.Hy," "),showSearch:!0,filterOption:(e,l)=>String(null===l||void 0===l?void 0:l.children).toLowerCase().includes(e.toLowerCase()),onFocus:()=>{const e={directorId:"",companyId:null===_||void 0===_?void 0:_.companyId,branchId:null===_||void 0===_?void 0:_.branchId,userType:"client",text:"",sort:!0,status:"",isPagination:!1};k((0,j.Aq)(e))},children:[(0,C.jsx)(h.A.Option,{className:"",value:"",children:"Select Client"}),null===U||void 0===U?void 0:U.map(e=>(0,C.jsx)(h.A.Option,{value:null===e||void 0===e?void 0:e._id,children:null===e||void 0===e?void 0:e.fullName}))]}))}}),S.clientId&&(0,C.jsx)("p",{className:"text-red-500 text-sm",children:S.clientId.message})]}),"employe"!==W&&(0,C.jsxs)("div",{className:"w-full",children:[(0,C.jsxs)("label",{className:"".concat(o.Q0),children:["Number Of Person ",(0,C.jsx)("span",{className:"text-red-600",children:"*"})]}),(0,C.jsx)("input",(0,s.A)((0,s.A)({type:"number"},y("numberOfPerson",{required:"Number Of Person is required"})),{},{className:"placeholder: ".concat(o.Ol," ").concat(S.numberOfPerson?"border-[1px] ":"border-gray-300"),placeholder:"Enter Number Of Person"})),S.numberOfPerson&&(0,C.jsx)("p",{className:"text-red-500 text-sm",children:S.numberOfPerson.message})]}),(0,C.jsxs)("div",{className:"w-full",children:[(0,C.jsxs)("label",{className:"".concat(o.Q0),children:["Reason ",(0,C.jsx)("span",{className:"text-red-600",children:"*"})]}),(0,C.jsx)(r.xI,{control:q,name:"reason",rules:{required:"reason is required"},render:e=>{var l;let{field:a}=e;return(0,C.jsx)(x.A,(0,s.A)((0,s.A)({className:"w-full"},a),{},{onChange:e=>{a.onChange(e)},options:null===(l=(0,o._o)($))||void 0===l?void 0:l.map(e=>({value:null===e||void 0===e?void 0:e.title})),children:(0,C.jsx)("input",{placeholder:"Enter Reason",className:"".concat(o.Ol)})}))}}),S.reason&&(0,C.jsx)("p",{className:"text-red-500 text-sm",children:S.reason.message})]}),"employe"===W&&(0,C.jsxs)("div",{className:"w-full",children:[(0,C.jsxs)("label",{className:"".concat(o.Q0),children:["KM ",(0,C.jsx)("span",{className:"text-red-600",children:"*"})]}),(0,C.jsx)("input",(0,s.A)((0,s.A)({type:"number"},y("kilometer",{required:"Number kilometer is required"})),{},{className:"placeholder: ".concat(o.Ol," ").concat(S.kilometer?"border-[1px] ":"border-gray-300"),placeholder:"Enter Number kilometer"})),S.designationName&&(0,C.jsx)("p",{className:"text-red-500 text-sm",children:S.kilometer.message})]}),"employe"===W&&(0,C.jsxs)("div",{className:"w-full",children:[(0,C.jsxs)("label",{className:"".concat(o.Q0),children:["Date ",(0,C.jsx)("span",{className:"text-red-600",children:"*"})]}),(0,C.jsx)("input",(0,s.A)((0,s.A)({type:"date",min:(new Date).toISOString().split("T")[0]},y("date",{required:"Date is required"})),{},{className:" ".concat(o.Ol," ").concat(S.date?"border-[1px] ":"border-gray-300"),placeholder:"Enter Date of Birth"})),S.date&&(0,C.jsx)("p",{className:"text-red-500 text-sm",children:S.date.message})]})]}),(0,C.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 md:my-2 my-4",children:(0,C.jsxs)("div",{className:"col-span-2",children:[(0,C.jsxs)("label",{className:"".concat(o.Q0),children:["Address ","general"!==W&&(0,C.jsx)("span",{className:"text-red-600",children:"*"})]}),(0,C.jsx)("input",(0,s.A)((0,s.A)({type:"text"},y("PDAddress",{required:"general"!==W&&"Address is required"})),{},{className:"".concat(o.Ol," ").concat(S.PDAddress?"border-[1px] ":"border-gray-300"),placeholder:"Enter Address "})),S.PDAddress&&(0,C.jsx)("p",{className:"text-red-500 text-sm",children:S.PDAddress.message})]})}),(0,C.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 md:gap-8 gap-4 my-3 ",children:[(0,C.jsxs)("div",{children:[(0,C.jsxs)("div",{className:"".concat(o.Q0),children:["Country ","general"!==W&&(0,C.jsx)("span",{className:"text-red-600",children:"*"})]}),(0,C.jsx)(r.xI,{control:q,name:"PDCountry",rules:{required:"general"!==W&&"Country is required"},render:e=>{var l;let{field:a}=e;return(0,C.jsx)(x.A,(0,s.A)((0,s.A)({className:"w-full"},a),{},{onChange:e=>{a.onChange(e)},options:null===R||void 0===R||null===(l=R.docs)||void 0===l?void 0:l.map(e=>({value:null===e||void 0===e?void 0:e.name})),children:(0,C.jsx)("input",{placeholder:"Enter Country",onFocus:()=>{k((0,N.dw)({isPagination:!1,text:"",sort:!0,status:!0}))},className:"".concat(o.Ol," ").concat(S.PDCountry?"border-[1px] ":"border-gray-300")})}))}}),S.PDCountry&&(0,C.jsx)("p",{className:"".concat(o.ci),children:S.PDCountry.message})]}),(0,C.jsxs)("div",{children:[(0,C.jsxs)("div",{className:"".concat(o.Q0),children:["State ","general"!==W&&(0,C.jsx)("span",{className:"text-red-600",children:"*"})]}),(0,C.jsx)(r.xI,{control:q,name:"PDState",rules:{required:"general"!==W&&"State is required"},render:e=>{var l;let{field:a}=e;return(0,C.jsx)(x.A,(0,s.A)((0,s.A)({className:"w-full"},a),{},{onChange:e=>a.onChange(e),options:null===Y||void 0===Y||null===(l=Y.docs)||void 0===l?void 0:l.map(e=>({value:null===e||void 0===e?void 0:e.name})),children:(0,C.jsx)("input",{placeholder:"Enter State",onFocus:()=>{k((0,p.mz)({isPagination:!1,text:"",countryName:Z,sort:!0,status:!0}))},className:"".concat(o.Ol," ").concat(S.PDState?"border-[1px] ":"border-gray-300")})}))}}),S.PDState&&(0,C.jsx)("p",{className:"".concat(o.ci),children:S.PDState.message})]}),(0,C.jsxs)("div",{children:[(0,C.jsxs)("div",{className:"".concat(o.Q0),children:["City ","general"!==W&&(0,C.jsx)("span",{className:"text-red-600",children:"*"})]}),(0,C.jsx)(r.xI,{control:q,name:"PDCity",rules:{required:"general"!==W&&"City is required"},render:e=>{var l;let{field:a}=e;return(0,C.jsx)(x.A,(0,s.A)((0,s.A)({className:"w-full"},a),{},{onChange:e=>a.onChange(e),options:null===z||void 0===z||null===(l=z.docs)||void 0===l?void 0:l.map(e=>({value:null===e||void 0===e?void 0:e.name})),children:(0,C.jsx)("input",{onFocus:()=>{k((0,g.cY)({isPagination:!1,text:"",sort:!0,status:!0,stateName:K}))},placeholder:"Enter City",className:"".concat(o.Ol," ").concat(S.PDCity?"border-[1px] ":"border-gray-300")})}))}}),S.PDCity&&(0,C.jsx)("p",{className:"".concat(o.ci),children:S.PDCity.message})]}),(0,C.jsxs)("div",{children:[(0,C.jsxs)("label",{className:"".concat(o.Q0),children:["Pin Code ","general"!==W&&(0,C.jsx)("span",{className:"text-red-600",children:"*"})]}),(0,C.jsx)(r.xI,{control:q,name:"PDPinCode",rules:{required:"general"!==W&&"Pincode is required"},render:e=>{let{field:l}=e;return(0,C.jsx)("input",(0,s.A)((0,s.A)({},l),{},{type:"number",placeholder:"Enter Pin Code",maxLength:6,onInput:e=>{e.target.value.length>6&&(e.target.value=e.target.value.slice(0,6))},className:"".concat(o.Ol," ").concat(S.PDPinCode?"border-[1px] ":"border-gray-300")}))}}),S.PDPinCode&&(0,C.jsx)("p",{className:"text-red-500 text-sm",children:S.PDPinCode.message})]})]}),(0,C.jsx)("div",{className:"w-full",children:(0,C.jsxs)("div",{className:"flex gap-3",children:[(0,C.jsxs)("div",{className:"w-[150px]",children:[(0,C.jsxs)("label",{className:"".concat(o.Q0),children:["Code ",(0,C.jsx)("span",{className:"text-red-600",children:"*"})]}),(0,C.jsx)(r.xI,{control:q,name:"PDMobileCode",rules:{required:"code is required"},render:e=>{let{field:l}=e;return(0,C.jsx)(P.A,{field:l,errors:S})}}),S.PDMobileCode&&(0,C.jsx)("p",{className:"".concat(o.ci),children:S.PDMobileCode.message})]}),(0,C.jsxs)("div",{className:"w-full",children:[(0,C.jsxs)("label",{className:"".concat(o.Q0),children:["Mobile No ",(0,C.jsx)("span",{className:"text-red-600",children:"*"})]}),(0,C.jsx)("input",(0,s.A)((0,s.A)({type:"number"},y("PDMobileNo",{required:"Mobile No is required",minLength:{value:10,message:"Must be exactly 10 digits"},maxLength:{value:10,message:"Must be exactly 10 digits"}})),{},{className:" ".concat(o.Ol," ").concat(S.PDMobileNo?"border-[1px] ":"border-gray-300"),placeholder:"Enter Mobile No",maxLength:10,onInput:e=>{e.target.value.length>10&&(e.target.value=e.target.value.slice(0,10))}})),S.PDMobileNo&&(0,C.jsx)("p",{className:"text-red-500 text-sm",children:S.PDMobileNo.message})]})]})}),(0,C.jsx)("div",{className:"flex justify-end my-2",children:(0,C.jsx)("button",{type:"submit",disabled:e,className:"".concat(e?"bg-gray-400":"bg-header"," text-white p-2 px-4 rounded mt-3"),children:e?(0,C.jsx)(u.A,{}):"Submit"})})]})})})}},65337:(e,l,a)=>{a.d(l,{A:()=>n});var s=a(91686),r=a(70579);const n=function(){return(0,r.jsx)("div",{className:"flex justify-center items-center h-[80vh]",children:(0,r.jsx)(s.A,{size:"large"})})}}}]);
//# sourceMappingURL=1029.af9c1f3c.chunk.js.map