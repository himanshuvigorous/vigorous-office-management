"use strict";(self.webpackChunkca_admin=self.webpackChunkca_admin||[]).push([[9539],{29539:(e,t,l)=>{l.d(t,{A:()=>k});var s=l(29813),a=l(13382),n=l(96651),i=l(99472),c=l(65043),o=l(15187),d=l(83003),r=l(32256),x=l(86178),u=l.n(x),m=l(85051),h=l(6720),p=l(60184),v=l(91686),f=l(53913),y=l(8873),g=l(70579);const{Title:j,Text:N}=s.A,w=e=>{let{visible:t,onClose:l,actionType:s,todayAttendanceData:n,userInfoglobal:i,onSuccess:o}=e;const x=(0,d.wA)(),[m,h]=(0,c.useState)(null),[w,b]=(0,c.useState)(""),[k,I]=(0,c.useState)(!1),[A,T]=(0,c.useState)(1),[C,S]=(0,c.useState)(null),[O,D]=(0,c.useState)(null),M=(0,c.useRef)(null),[Y,L]=(0,c.useState)(!0);(0,c.useEffect)(()=>{t?(T(1),E()):(h(null),b(""),S(null),D(null))},[t,s]),(0,c.useEffect)(()=>{2===A&&m&&!window.google?_():2===A&&m&&window.google&&U()},[A,m]);const _=()=>{if(window.google)return;const e=document.createElement("script");e.src="https://maps.googleapis.com/maps/api/js?key=".concat("AIzaSyBvvP_yGYoHaxiANhSQYVNUcTuORGx3kRU","&libraries=places"),e.async=!0,e.defer=!0,e.onload=()=>{U()},e.onerror=()=>{console.error("Failed to load Google Maps script"),L(!1)},document.head.appendChild(e)},U=()=>{if(m&&M.current&&window.google){L(!0);try{const e=window.google,t={center:{lat:m.lat,lng:m.lng},zoom:16,mapTypeId:e.maps.MapTypeId.ROADMAP,streetViewControl:!1,mapTypeControl:!1,fullscreenControl:!1,styles:[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]}]},l=new e.maps.Map(M.current,t);S(l);const a=new e.maps.Marker({position:{lat:m.lat,lng:m.lng},map:l,title:"Your current location",icon:{url:"data:image/svg+xml;base64,"+btoa('\n            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24">\n              <path fill="'.concat("checkIn"===s?"#1890ff":"#ff4d4f",'" d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5a2.5 2.5 0 0 1 0-5a2.5 2.5 0 0 1 0 5z"/>\n            </svg>\n          ')),scaledSize:new e.maps.Size(32,32),anchor:new e.maps.Point(16,32)}});D(a),m.accuracy&&new e.maps.Circle({strokeColor:"checkIn"===s?"#1890ff":"#ff4d4f",strokeOpacity:.4,strokeWeight:1,fillColor:"checkIn"===s?"#1890ff":"#ff4d4f",fillOpacity:.2,map:l,center:{lat:m.lat,lng:m.lng},radius:m.accuracy}),L(!1)}catch(e){console.error("Error initializing map:",e),L(!1)}}},E=async()=>{try{if(!navigator.geolocation)return(0,y.D)({message:"Geolocation is not supported by your browser",type:"error"}),void l();const e=await new Promise((e,t)=>{navigator.geolocation.getCurrentPosition(e,t,{enableHighAccuracy:!0,timeout:15e3,maximumAge:0})}),{latitude:t,longitude:s,accuracy:a}=e.coords;a>200&&(0,y.D)({message:"Low GPS accuracy (".concat(Math.round(a)," meters). For better results, enable GPS."),type:"warning"});h({lat:t,lng:s,accuracy:a});const n=await P(t,s);b(n),T(2)}catch(e){console.error("Error getting location:",e),(0,y.D)({message:"Failed to get your location. Please try again.",type:"error"}),l()}},P=async(e,t)=>{try{const l=await fetch("https://maps.googleapis.com/maps/api/geocode/json?latlng=".concat(e,",").concat(t,"&key=").concat("AIzaSyBvvP_yGYoHaxiANhSQYVNUcTuORGx3kRU")),s=await l.json();return s.results&&s.results.length>0?s.results[0].formatted_address:"Address not available"}catch(l){return console.error("Error getting address:",l),"Could not retrieve address"}},F=async()=>{I(!0);try{const e=(new Date).toISOString();if("checkIn"===s){const t={_id:null===n||void 0===n?void 0:n._id,employeId:null===i||void 0===i?void 0:i._id,companyId:(null===i||void 0===i?void 0:i.companyId)||null,branchId:(null===i||void 0===i?void 0:i.branchId)||null,directorId:(null===i||void 0===i?void 0:i.directorId)||null,attendanceDate:u()().format("YYYY-MM-DD"),checkInTime:e,checkOutTime:null,method:"google_api",checkInLocation:{latitude:m.lat,longitude:m.lng,address:w}};await x((0,r.xn)(t)),(0,y.D)({message:"Checked in successfully!",type:"success"})}else if("checkOut"===s){const t={_id:n._id,employeId:n.employeId||null,companyId:n.companyId,branchId:n.branchId,directorId:n.directorId,attendanceDate:n.attendanceDate,checkInTime:n.checkInTime,checkOutTime:e,method:"google_api",checkOutLocation:{latitude:m.lat,longitude:m.lng,address:w}};await x((0,r.Ab)(t)),(0,y.D)({message:"Checked out successfully!",type:"success"})}T(3),setTimeout(()=>{o(),l()},1500)}catch(t){var e;console.error("Error processing attendance:",t),(0,y.D)({message:(null===t||void 0===t||null===(e=t.data)||void 0===e?void 0:e.message)||"Failed to ".concat("checkIn"===s?"check in":"check out",". Please try again."),type:"error"})}finally{I(!1)}};return(0,g.jsx)(f.A,{title:(0,g.jsxs)("div",{className:"flex items-center",children:[(0,g.jsx)(p.A4L,{className:"mr-2 text-blue-500"}),"checkIn"===s?"Check-In":"Check-Out"," Verification"]}),open:t,onCancel:l,footer:null,width:550,closable:1!==A,destroyOnClose:!0,children:(()=>{switch(A){case 1:return(0,g.jsxs)("div",{className:"text-center py-8",children:[(0,g.jsx)("div",{className:"animate-pulse",children:(0,g.jsx)(p.vq8,{className:"text-4xl text-blue-500 mx-auto mb-4"})}),(0,g.jsx)(j,{level:4,className:"text-gray-700",children:"Getting your location..."}),(0,g.jsx)(N,{className:"text-gray-500",children:"Please allow location access to continue"})]});case 2:return(0,g.jsxs)("div",{className:"py-4",children:[(0,g.jsxs)("div",{className:"text-center mb-6",children:[(0,g.jsx)(p.vq8,{className:"text-3xl text-blue-500 mx-auto mb-2"}),(0,g.jsx)(j,{level:4,className:"text-gray-700",children:"Confirm Your Location"}),(0,g.jsxs)(N,{className:"text-gray-500",children:["Please verify this is your correct location before ","checkIn"===s?"checking in":"checking out"]})]}),(0,g.jsxs)("div",{className:"mb-6 rounded-lg overflow-hidden border border-gray-200",style:{height:"250px"},children:[Y&&(0,g.jsx)("div",{className:"h-full flex items-center justify-center bg-gray-100",children:(0,g.jsx)(v.A,{tip:"Loading map..."})}),(0,g.jsx)("div",{ref:M,className:"w-full h-full",style:{display:Y?"none":"block"}})]}),(0,g.jsxs)("div",{className:"bg-gray-100 p-4 rounded-lg mb-6",children:[(0,g.jsx)(N,{strong:!0,className:"block mb-2",children:"Your current location:"}),(0,g.jsx)(N,{className:"text-gray-700",children:w}),m&&(0,g.jsxs)("div",{className:"mt-3 text-sm text-gray-500",children:[(0,g.jsxs)("div",{children:["Latitude: ",m.lat.toFixed(6)]}),(0,g.jsxs)("div",{children:["Longitude: ",m.lng.toFixed(6)]}),(0,g.jsxs)("div",{children:["Accuracy: ",Math.round(m.accuracy)," meters"]})]})]}),(0,g.jsx)("div",{className:"bg-blue-50 p-4 rounded-lg mb-6",children:(0,g.jsxs)(N,{className:"text-blue-700",children:[(0,g.jsx)("strong",{children:"Note:"})," Your location will be recorded for attendance purposes."]})}),(0,g.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,g.jsx)(a.Ay,{onClick:l,disabled:k,children:"Cancel"}),(0,g.jsxs)(a.Ay,{type:"primary",onClick:F,loading:k,icon:(0,g.jsx)(p.vq8,{}),children:["Confirm ","checkIn"===s?"Check-In":"Check-Out"]})]})]});case 3:return(0,g.jsxs)("div",{className:"text-center py-8",children:[(0,g.jsx)(p.A7C,{className:"text-5xl text-green-500 mx-auto mb-4"}),(0,g.jsxs)(j,{level:4,className:"text-gray-700",children:["checkIn"===s?"Checked In":"Checked Out"," Successfully!"]}),(0,g.jsx)(N,{className:"text-gray-500",children:"Your attendance has been recorded"})]});default:return null}})()})},{Text:b}=s.A,k=e=>{var t;let{leaveList:l,birthdaydata:s,inActiveUserToday:x,todayWfhRequstData:v}=e;const f=JSON.parse(localStorage.getItem("user_info_".concat(o.AU))),{todayAttendanceData:y,loading:j}=(0,d.d4)(e=>e.attendance),N=(0,d.wA)(),[k,I]=(0,c.useState)(u()()),[A,T]=(0,c.useState)(null),[C,S]=(0,c.useState)(null),[O,D]=(0,c.useState)("00:00:00"),[M,Y]=(0,c.useState)(!1),[L,_]=(0,c.useState)("");(0,c.useEffect)(()=>{const e=setInterval(()=>{I(u()())},1e3);return()=>clearInterval(e)},[]),(0,c.useEffect)(()=>{y&&(T(null!==y&&void 0!==y&&y.checkInTime?u()(y.checkInTime):null),S(null!==y&&void 0!==y&&y.checkOutTime?u()(y.checkOutTime):null))},[y]),(0,c.useEffect)(()=>{if(A&&!C){const e=setInterval(()=>{const e=u().duration(u()().diff(A)),t=String(e.hours()).padStart(2,"0"),l=String(e.minutes()).padStart(2,"0"),s=String(e.seconds()).padStart(2,"0");D("".concat(t,":").concat(l,":").concat(s))},1e3);return()=>clearInterval(e)}if(A&&C){const e=u().duration(C.diff(A)),t=String(e.hours()).padStart(2,"0"),l=String(e.minutes()).padStart(2,"0"),s=String(e.seconds()).padStart(2,"0");D("".concat(t,":").concat(l,":").concat(s))}},[A,C]),(0,c.useEffect)(()=>{"employee"===(null===f||void 0===f?void 0:f.userType)&&U()},[]);const U=()=>{N((0,r.zE)({employeId:"employee"===(null===f||void 0===f?void 0:f.userType)?null===f||void 0===f?void 0:f._id:null}))},E=e=>{_(e),Y(!0)};return console.log(v,l),(0,g.jsxs)("div",{className:"w-full bg-[#ffff] rounded-md py-[10px] px-3 space-y-3 my-2",children:[(0,g.jsxs)("div",{className:"3xl:text-[20px] xl:text-[12px] lg:text-[14px] md:text-[18px] font-[500] text-header text-ellipsis",children:["Hello, ",null===f||void 0===f?void 0:f.fullName]}),(0,g.jsxs)("div",{className:"flex justify-between items-start xl:pr4",children:[(0,g.jsxs)("div",{className:"3xl:text-[20px] xl:text-[12px] lg:text-[14px] md:text-[18px] font-[500] text-header",children:[(0,g.jsx)("div",{children:k.format("DD MMM YYYY")}),(0,g.jsxs)("div",{className:"",children:[" ",k.format("hh:mm:ss A")]})]}),(0,g.jsx)("div",{className:"bg-gray-100 px-2 py-1 rounded-md text-[14px] font-[500] text-header space-y-1",children:(0,g.jsxs)("div",{className:"text-nowrap",children:["On Leave: ",null!==(t=null===l||void 0===l?void 0:l.length)&&void 0!==t?t:0]})})]}),"employee"==(null===f||void 0===f?void 0:f.userType)&&(0,g.jsx)("div",{className:"p-2 bg-gray-200 shadow-sm shadow-black rounded-md",children:(0,g.jsxs)("div",{className:"gap-2 items-center p-2",children:[(0,g.jsxs)("div",{className:"flex justify-between items-center",children:[A&&(0,g.jsxs)("div",{className:"text-[14px] flex items-center gap-2 font-medium text-header",children:[(0,g.jsx)(m.yNh,{})," ",A.format("hh:mm:ss A")]}),C&&(0,g.jsxs)("div",{className:"text-[14px] flex items-center gap-2 font-medium text-header",children:[(0,g.jsx)(m.JtW,{})," ",C.format("hh:mm:ss A")]})]}),(0,g.jsxs)("div",{className:"text-[18px] font-medium text-header text-center my-1 md:text-left flex justify-center items-center gap-2",children:[(0,g.jsx)(h.hdM,{}),(0,g.jsx)("span",{className:"font-semibold",children:O})]}),A||j?!A||C||j?!j&&(0,g.jsx)(b,{type:"secondary",children:"You've checked out for today"}):(0,g.jsx)(a.Ay,{className:"w-full",type:"button",color:"danger",variant:"solid",onClick:()=>E("checkOut"),icon:(0,g.jsx)(p.vq8,{}),children:"Check Out"}):(0,g.jsx)(a.Ay,{className:"w-full",color:"cyan",type:"button",variant:"solid",onClick:()=>E("checkIn"),icon:(0,g.jsx)(p.vq8,{}),children:"Check In"})]})}),(null===l||void 0===l?void 0:l.length)>0?(0,g.jsxs)("div",{children:[(0,g.jsx)("div",{className:"3xl:text-[19px] xl:text-[16px] font-[500] text-header",children:"On Leave Today"}),(0,g.jsx)("div",{className:"w-full overflow-x-auto py-2 scrollable-x",children:(0,g.jsx)("div",{className:"w-full flex justify-start items-center space-x-3",children:null===l||void 0===l?void 0:l.map((e,t)=>(0,g.jsx)(n.A,{placement:"topLeft",title:null===e||void 0===e?void 0:e.tooltip,children:(0,g.jsxs)("div",{className:"flex flex-col cursor-pointer",children:[(0,g.jsx)("div",{className:"w-[50px] h-[50px] text-center m-auto",children:(0,g.jsx)("img",{src:null===e||void 0===e?void 0:e.imgUrl,alt:"",className:"w-full h-full rounded-full"})}),(0,g.jsx)("span",{className:"text-[14px] text-nowrap py-1",children:null===e||void 0===e?void 0:e.name})]})},t))})})]}):(0,g.jsxs)("div",{children:[(0,g.jsx)("div",{className:"3xl:text-[19px] xl:text-[16px] font-[500] text-header",children:"On Leave Today"}),(0,g.jsx)("div",{className:"w-full overflow-x-auto py-2 scrollable-x",children:(0,g.jsx)(i.A,{image:"/images/empty.svg",styles:{image:{height:40,display:"flex",justifyContent:"center",alignItems:"center"}},description:"No One Is On Leave Today"})})]}),(null===v||void 0===v?void 0:v.length)>0?(0,g.jsxs)("div",{children:[(0,g.jsx)("div",{className:"3xl:text-[19px] xl:text-[16px] font-[500] text-header",children:"On WFH Today"}),(0,g.jsx)("div",{className:"w-full overflow-x-auto py-2 scrollable-x",children:(0,g.jsx)("div",{className:"w-full flex justify-start items-center space-x-3",children:null===v||void 0===v?void 0:v.map((e,t)=>(0,g.jsxs)("div",{className:"flex flex-col cursor-pointer relative",children:[(0,g.jsx)(n.A,{title:null!==e&&void 0!==e&&e.hasAttendanceMarked?"\u2705 Attendance Marked":"\u274c Attendance Not Marked",children:(0,g.jsx)("div",{className:"absolute top-0 right-0 w-3 h-3 rounded-full border-2 border-white",style:{backgroundColor:null!==e&&void 0!==e&&e.hasAttendanceMarked?"#4CAF50":"#F44336"}})}),(0,g.jsx)(n.A,{placement:"topLeft",title:null===e||void 0===e?void 0:e.tooltip,children:(0,g.jsx)("div",{className:"w-[50px] h-[50px] text-center m-auto",children:(0,g.jsx)("img",{src:null===e||void 0===e?void 0:e.imgUrl,alt:"",className:"w-full h-full rounded-full"})})}),(0,g.jsx)("span",{className:"text-[14px] text-nowrap py-1",children:null===e||void 0===e?void 0:e.name})]},t))})})]}):(0,g.jsxs)("div",{children:[(0,g.jsx)("div",{className:"3xl:text-[19px] xl:text-[16px] font-[500] text-header",children:"On WFH Today"}),(0,g.jsx)("div",{className:"w-full overflow-x-auto py-2 scrollable-x",children:(0,g.jsx)(i.A,{image:"/images/empty.svg",styles:{image:{height:40,display:"flex",justifyContent:"center",alignItems:"center"}},description:"No One Is On WFH Today"})})]}),(null===s||void 0===s?void 0:s.length)>0?(0,g.jsxs)("div",{children:[(0,g.jsx)("div",{className:"3xl:text-[19px] xl:text-[16px] font-[500] text-header",children:"Birthdays Today"}),(0,g.jsx)("div",{className:"w-full overflow-x-auto py-2 scrollable-x",children:(0,g.jsx)("div",{className:"w-full flex justify-start items-center space-x-3",children:null===s||void 0===s?void 0:s.map((e,t)=>(0,g.jsx)(n.A,{placement:"topLeft",title:null===e||void 0===e?void 0:e.tooltip,children:(0,g.jsxs)("div",{className:"flex flex-col",children:[(0,g.jsx)("div",{className:"w-[50px] h-[50px]",children:(0,g.jsx)("img",{src:null===e||void 0===e?void 0:e.imgUrl,alt:"",className:"w-full h-full rounded-full"})}),(0,g.jsx)("span",{className:"text-[14px] py-1",children:null===e||void 0===e?void 0:e.name})]})},t))})})]}):(0,g.jsxs)("div",{children:[(0,g.jsx)("div",{className:"3xl:text-[19px] xl:text-[16px] font-[500] text-header",children:"Birthdays Today"}),(0,g.jsx)("div",{className:"w-full overflow-x-auto py-2",children:(0,g.jsx)(i.A,{image:"/images/empty.svg",styles:{image:{height:40,display:"flex",justifyContent:"center",alignItems:"center"}},description:"No Birthdays Today"})})]}),("employee"!==(null===f||void 0===f?void 0:f.userType)||"employee"===(null===f||void 0===f?void 0:f.userType)&&"hr"==(null===f||void 0===f?void 0:f.roleKey)||"employee"===(null===f||void 0===f?void 0:f.userType)&&"manager"==(null===f||void 0===f?void 0:f.roleKey))&&((null===x||void 0===x?void 0:x.length)>0?(0,g.jsxs)("div",{children:[(0,g.jsx)("div",{className:"3xl:text-[19px] xl:text-[16px] font-[500] text-header",children:"In-Active User Today"}),(0,g.jsx)("div",{className:"w-full overflow-x-auto py-2 scrollable-x",children:(0,g.jsx)("div",{className:"w-full flex justify-start items-center space-x-3",children:null===x||void 0===x?void 0:x.map((e,t)=>(0,g.jsx)(n.A,{placement:"topLeft",title:null===e||void 0===e?void 0:e.tooltip,children:(0,g.jsxs)("div",{className:"flex flex-col",children:[(0,g.jsx)("div",{className:"w-[50px] h-[50px]",children:(0,g.jsx)("img",{src:null===e||void 0===e?void 0:e.imgUrl,alt:"",className:"w-full h-full rounded-full"})}),(0,g.jsx)("span",{className:"text-[14px] py-1",children:null===e||void 0===e?void 0:e.name})]},t)},t))})})]}):(0,g.jsxs)("div",{children:[(0,g.jsx)("div",{className:"3xl:text-[19px] xl:text-[16px] font-[500] text-header",children:"In-Active User Today"}),(0,g.jsx)("div",{className:"w-full overflow-x-auto py-2 scrollable-x",children:(0,g.jsx)(i.A,{image:"/images/empty.svg",styles:{image:{height:40,display:"flex",justifyContent:"center",alignItems:"center"}},description:"No Inactive Users Today"})})]})),(0,g.jsx)(w,{visible:M,onClose:()=>Y(!1),actionType:L,todayAttendanceData:y,userInfoglobal:f,onSuccess:()=>{U()}})]})}}}]);
//# sourceMappingURL=9539.87bf0de1.chunk.js.map