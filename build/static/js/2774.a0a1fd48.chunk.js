"use strict";(self.webpackChunkca_admin=self.webpackChunkca_admin||[]).push([[2774],{42774:(e,a,l)=>{l.r(a),l.d(a,{default:()=>D});var n=l(89379),d=l(24858),t=l(39160),s=l(83003),o=l(73216),i=l(65043),c=l(15187),r=l(31744),u=l(66015),v=l(42837),m=l(88967),x=l(93898),p=l(96603),h=l(65512),N=l(31174),b=l(86178),j=l.n(b),y=l(94084),g=l(60184),f=l(17995),A=l(70579);const D=()=>{var e,a,l,b,D,I,k,T,M,S,w,F,q,Q,C,V,Y;const{loading:_}=(0,s.d4)(e=>e.payment),{paymentDetails:B}=(0,s.d4)(e=>e.payment),{paymentIdEnc:E}=(0,o.g)(),H=(0,N.Yc)(E),O=(0,s.wA)(),G=(0,o.Zp)(),{branchDetailsData:P}=(0,s.d4)(e=>e.branch),{employeList:L}=(0,s.d4)(e=>e.employe),[Z,R]=(0,i.useState)([]),{register:$,handleSubmit:z,control:J,getValues:K,watch:U,formState:{errors:W},setValue:X,resetField:ee,trigger:ae}=(0,d.mN)({defaultValues:{isDiscountApplicable:!1,isTDS:!1,isAdvance:!1,discount:0,tds:0,advance:0,grandTotal:0}}),le=(0,d.FH)({control:J,name:"isAdvance"}),ne=((0,d.FH)({control:J,name:"advance"}),(0,d.FH)({control:J,name:"maxAdvance"})),de=(0,d.FH)({control:J,name:"isDiscountApplicable"}),te=(0,d.FH)({control:J,name:"discount"}),se=(0,d.FH)({control:J,name:"isTDS"}),oe=(0,d.FH)({control:J,name:"tds"}),ie=(0,d.FH)({control:J,name:"totalBeforeGrand"}),ce=(0,d.FH)({control:J,name:"grandTotal"});(0,i.useEffect)(()=>{H&&O((0,x.F$)({_id:H}))},[H]),(0,i.useEffect)(()=>{var e;B&&(X("paymentMode","cash"),X("totalBeforeGrand",(null===B||void 0===B?void 0:B.amount)||0),X("maxAdvance",(null===B||void 0===B||null===(e=B.applicableAdvance)||void 0===e?void 0:e.availableBalance)||0),X("grandTotal",(null===B||void 0===B?void 0:B.amount)||0))},[B]),(0,i.useEffect)(()=>{(()=>{let e=Number(ie)||0,a=0,l=0,n=0;if(de&&(a=Math.min(Number(te)||0,e),e-=a),se&&e>0&&(l=Math.min(Number(oe)||0,e),e-=l),le&&e>0){const a=Number(ne)||0;n=Math.min(a,e),e-=n}de&&X("discount",a,{shouldValidate:!0}),se&&X("tds",l,{shouldValidate:!0}),le&&X("advance",n,{shouldValidate:!0}),X("grandTotal",e,{shouldValidate:!0})})()},[ie,de,te,se,oe,le,ne]),(0,i.useEffect)(()=>{de||(ee("discount"),X("discount",0))},[de]),(0,i.useEffect)(()=>{se||(ee("tds"),X("tds",0))},[se]),(0,i.useEffect)(()=>{le||(ee("advance"),X("advance",0))},[le]);const re=function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return l=>{let n=parseFloat(l.target.value)||0;n<0&&(n=0),null!==a&&n>a&&(n=a),X(e,n,{shouldValidate:!0})}},ue=()=>Number(ie)||0,ve=()=>{const e=Number(ie)||0,a=de&&Number(te)||0;return Math.max(0,e-a)},me=e=>{let a=parseFloat(e.target.value)||0;a<0&&(a=0);const l=ie-(de?te:0)-(se?oe:0),n=Math.min(ne,l);a>n&&(a=n),X("advance",a,{shouldValidate:!0});const d=l-a;X("grandTotal",d>0?d:0)};return(0,A.jsx)(t.A,{children:(0,A.jsx)("div",{className:"gap-4",children:(0,A.jsxs)("form",{autoComplete:"off",className:"mt-2 border border-gray-200 rounded-xl",onSubmit:z(async e=>{var a,l,n,d,t;if(!await ae())return;const s={_id:null===B||void 0===B?void 0:B._id,companyId:null===B||void 0===B?void 0:B.companyId,directorId:null===B||void 0===B?void 0:B.directorId,branchId:null===B||void 0===B?void 0:B.branchId,purchaseId:"purchase"===(null===B||void 0===B?void 0:B.type)?null===B||void 0===B||null===(a=B.purchaseAssetData)||void 0===a?void 0:a._id:"",cashBookId:"cashBook"===(null===B||void 0===B?void 0:B.type)?null===B||void 0===B||null===(l=B.cashbookData)||void 0===l?void 0:l._id:"",advanceAId:"advance"===(null===B||void 0===B?void 0:B.type)?null===B||void 0===B||null===(n=B.advanceData)||void 0===n?void 0:n._id:"",type:null===B||void 0===B?void 0:B.type,paymentMode:ce>0?null===e||void 0===e?void 0:e.paymentMode:"cash",employeId:ce>0?"cash"===(null===e||void 0===e?void 0:e.paymentMode)?null===e||void 0===e||null===(d=e.employeeId)||void 0===d?void 0:d.value:null:"",bankAccId:ce>0?"cash"!==(null===e||void 0===e?void 0:e.paymentMode)?null===e||void 0===e?void 0:e.bankId:null:"",chequeNo:ce>0?"cheque"===(null===e||void 0===e?void 0:e.paymentMode)?null===e||void 0===e?void 0:e.chequeNo:null:"",transactionNo:ce>0?"bank"===(null===e||void 0===e?void 0:e.paymentMode)?null===e||void 0===e?void 0:e.transactionNo:null:"",amount:null===e||void 0===e?void 0:e.totalBeforeGrand,totalAdjuustAmount:null===B||void 0===B||null===(t=B.applicableAdvance)||void 0===t?void 0:t.availableBalance,isAdjust:(null===e||void 0===e?void 0:e.isAdvance)||!1,adjustAmount:null!==e&&void 0!==e&&e.isAdvance?+(null===e||void 0===e?void 0:e.advance):0,totalAmount:null===e||void 0===e?void 0:e.grandTotal,date:null===e||void 0===e?void 0:e.date,remarks:ce>0?null===e||void 0===e?void 0:e.naration:"",attachment:Z,status:"Paid",isTDS:(null===e||void 0===e?void 0:e.isTDS)||!1,TDSAmount:null!==e&&void 0!==e&&e.isTDS?+(null===e||void 0===e?void 0:e.tds):0,isDiscount:(null===e||void 0===e?void 0:e.isDiscountApplicable)||!1,discountAmount:null!==e&&void 0!==e&&e.isDiscountApplicable?+(null===e||void 0===e?void 0:e.discount):0};O((0,x.M0)(s)).then(e=>{e.error||G(-1)})}),children:[(0,A.jsxs)("div",{className:"bg-header text-white text-xs px-3 py-2 rounded-t-xl",children:["advance"===(null===B||void 0===B?void 0:B.type)&&"".concat((null===B||void 0===B?void 0:B.type)||"","  ").concat(null!==B&&void 0!==B&&null!==(e=B.advanceData)&&void 0!==e&&e.advanceType?"/".concat(null===B||void 0===B||null===(a=B.advanceData)||void 0===a?void 0:a.advanceType):"","  ").concat(null!==B&&void 0!==B&&null!==(l=B.advanceData)&&void 0!==l&&l.userName?"/".concat(null===B||void 0===B||null===(b=B.advanceData)||void 0===b?void 0:b.userName):""," ").concat(null!==B&&void 0!==B&&null!==(D=B.advanceData)&&void 0!==D&&D.date?"/(".concat(j()(null===B||void 0===B||null===(I=B.advanceData)||void 0===I?void 0:I.date).format("DD/MM/YYYY"),")"):""),"purchase"===(null===B||void 0===B?void 0:B.type)&&"".concat((null===B||void 0===B?void 0:B.type)||"","  ").concat(null!==B&&void 0!==B&&null!==(k=B.purchaseAssetData)&&void 0!==k&&k.purchaseType?"/".concat(null===B||void 0===B||null===(T=B.purchaseAssetData)||void 0===T?void 0:T.purchaseType):"","  ").concat("Vendor"===(null===B||void 0===B||null===(M=B.purchaseAssetData)||void 0===M?void 0:M.purchaseType)?"/".concat(null===B||void 0===B||null===(S=B.purchaseAssetData)||void 0===S?void 0:S.assetName):"/".concat(null===B||void 0===B||null===(w=B.purchaseAssetData)||void 0===w?void 0:w.vendorOtherName)," ").concat(null!==B&&void 0!==B&&null!==(F=B.purchaseAssetData)&&void 0!==F&&F.date?"/(".concat(j()(null===B||void 0===B||null===(q=B.purchaseAssetData)||void 0===q?void 0:q.date).format("DD/MM/YYYY"),")"):""),"cashBook"===(null===B||void 0===B?void 0:B.type)&&"".concat((null===B||void 0===B?void 0:B.type)||""," ").concat(null!==B&&void 0!==B&&null!==(Q=B.cashbookData)&&void 0!==Q&&Q.userName?"/".concat(null===B||void 0===B||null===(C=B.cashbookData)||void 0===C?void 0:C.userName):""," ").concat(null!==B&&void 0!==B&&null!==(V=B.cashbookData)&&void 0!==V&&V.date?"/(".concat(j()(null===B||void 0===B||null===(Y=B.cashbookData)||void 0===Y?void 0:Y.date).format("DD/MM/YYYY"),")"):"")]}),(0,A.jsxs)("div",{className:"px-3",children:["payroll"!==(null===B||void 0===B?void 0:B.type)&&(0,A.jsxs)("div",{className:"space-y-2 mb-4",children:[(0,A.jsxs)("label",{className:"".concat(c.Q0," flex items-center"),children:[(0,A.jsx)("input",(0,n.A)({type:"checkbox"},$("isDiscountApplicable"))),(0,A.jsx)("span",{className:"mx-2 text-[15px]",children:"Is Discount"})]}),(0,A.jsxs)("label",{className:"".concat(c.Q0," flex items-center"),children:[(0,A.jsx)("input",(0,n.A)({type:"checkbox"},$("isTDS"))),(0,A.jsx)("span",{className:"mx-2 text-[15px]",children:"Is TDS"})]})]}),(0,A.jsx)("div",{className:"w-full flex flex-row items-end justify-end",children:(0,A.jsxs)("div",{className:"space-y-2 w-full max-w-md",children:[(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{className:c.Q0,children:"Total Amount"}),(0,A.jsx)("input",(0,n.A)((0,n.A)({type:"text"},$("totalBeforeGrand")),{},{className:c.id,disabled:!0}))]}),de&&(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{className:c.Q0,children:"Discount"}),(0,A.jsx)(d.xI,{name:"discount",control:J,rules:{validate:e=>{const a=Number(e)||0;return a<0?"Discount cannot be negative":!(a>ue())||"Discount cannot exceed ".concat(ue())}},render:e=>{let{field:a}=e;return(0,A.jsx)("input",(0,n.A)((0,n.A)({},a),{},{type:"number",step:"0.01",min:"0",max:ue(),className:c.Ol,onChange:re("discount",ue())}))}}),W.discount&&(0,A.jsx)("p",{className:"text-red-500 text-sm mt-1",children:W.discount.message})]}),se&&(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{className:c.Q0,children:"TDS"}),(0,A.jsx)(d.xI,{name:"tds",control:J,rules:{validate:e=>{const a=Number(e)||0;return a<0?"TDS cannot be negative":!(a>ve())||"TDS cannot exceed ".concat(ve())}},render:e=>{let{field:a}=e;return(0,A.jsx)("input",(0,n.A)((0,n.A)({},a),{},{type:"number",step:"0.01",min:"0",max:ve(),className:c.Ol,onChange:re("tds",ve())}))}}),W.tds&&(0,A.jsx)("p",{className:"text-red-500 text-sm mt-1",children:W.tds.message})]}),le&&(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{className:c.Q0,children:"Advance"}),(0,A.jsx)(d.xI,{name:"advance",control:J,rules:{validate:e=>{const a=Number(e)||0;if(a<0)return"Advance cannot be negative";const l=ie-(de?te:0)-(se?oe:0),n=Math.min(ne,l);return!(a>n)||"Advance cannot exceed ".concat(n)}},render:e=>{let{field:a}=e;const l=ie-(de?te:0)-(se?oe:0),d=Math.min(ne,l);return(0,A.jsx)("input",(0,n.A)((0,n.A)({},a),{},{type:"number",step:"0.01",min:"0",max:d,className:c.Ol,onChange:me}))}}),(0,A.jsxs)("div",{className:"text-sm text-gray-600",children:["Max available advance: ",ne]}),W.advance&&(0,A.jsx)("p",{className:"text-red-500 text-sm mt-1",children:W.advance.message})]}),(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{className:c.Q0,children:"Grand Total"}),(0,A.jsx)("input",(0,n.A)((0,n.A)({type:"text"},$("grandTotal")),{},{className:c.id,disabled:!0}))]})]})})]}),Number(ce)>0&&(0,A.jsxs)("div",{className:"py-2",children:[(0,A.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-1 md:gap-2 md:my-1 px-3 md:mt-2",children:[(0,A.jsxs)("div",{className:"",children:[(0,A.jsxs)("div",{className:"flex items-center gap-4",children:[(0,A.jsx)("label",{className:"your-input-label-class",children:(0,A.jsx)(d.xI,{name:"paymentMode",control:J,rules:{required:"Type is required"},render:e=>{let{field:a}=e;return(0,A.jsxs)(p.Ay.Group,(0,n.A)((0,n.A)({defaultValue:"cash"},a),{},{value:null===a||void 0===a?void 0:a.value,onChange:e=>{var l,n;a.onChange(null===e||void 0===e||null===(l=e.target)||void 0===l?void 0:l.value),"cash"==(null===e||void 0===e||null===(n=e.target)||void 0===n?void 0:n.value)?(X("bankId",""),X("transactionNo","")):X("employeeId","")},children:[(0,A.jsx)(p.Ay,{className:"".concat(c.Q0),value:"cash",children:"Cash"}),(0,A.jsx)(p.Ay,{className:"".concat(c.Q0),value:"bank",children:"Bank"})]}))}})}),W.type&&(0,A.jsx)("span",{className:"error-message",children:W.type.message})]}),W.type&&(0,A.jsx)("p",{className:"text-red-500 text-sm",children:W.type.message})]}),"cash"!==U("paymentMode")&&(0,A.jsxs)("div",{className:"",children:[(0,A.jsxs)("label",{className:"".concat(c.Q0),children:["Sender Bank",(0,A.jsx)("span",{className:"text-red-600",children:"*"})]}),(0,A.jsx)(d.xI,{control:J,name:"bankId",rules:{required:"bankId is required"},render:e=>{var a,l;let{field:d}=e;return(0,A.jsxs)(h.A,(0,n.A)((0,n.A)({},d),{},{defaultValue:"",className:"".concat(c.Hy," "),showSearch:!0,filterOption:(e,a)=>String(null===a||void 0===a?void 0:a.children).toLowerCase().includes(e.toLowerCase()),onFocus:()=>{O((0,r.ZN)({_id:null===B||void 0===B?void 0:B.branchId}))},children:[(0,A.jsx)(h.A.Option,{value:"",children:"Select Bank"}),(null===P||void 0===P||null===(a=P.data)||void 0===a?void 0:a.bankData)&&(null===P||void 0===P||null===(l=P.data)||void 0===l?void 0:l.bankData.length)>0&&P.data.bankData.map(e=>(0,A.jsx)(h.A.Option,{value:e._id,children:(0,c.ig)(e)},e._id))]}))}}),W.bankId&&(0,A.jsx)("p",{className:"text-red-500 text-sm",children:W.bankId.message})]}),"cash"===U("paymentMode")&&(0,A.jsxs)("div",{className:"w-full",children:[(0,A.jsx)("label",{className:"".concat(c.Q0),children:"Employee"}),(0,A.jsx)(d.xI,{name:"employeeId",control:J,rules:{required:"Employee is required"},render:e=>{let{field:a}=e;return(0,A.jsx)(u.Ay,(0,n.A)((0,n.A)({},a),{},{onFocus:()=>O((0,v.qV)({text:"",status:!0,sort:!0,isTL:"",isHR:"",isPagination:!1,departmentId:"",designationId:"",companyId:null===B||void 0===B?void 0:B.companyId,branchId:null===B||void 0===B?void 0:B.branchId})),options:null===L||void 0===L?void 0:L.map(e=>({value:null===e||void 0===e?void 0:e._id,label:null===e||void 0===e?void 0:e.fullName})),classNamePrefix:"react-select",className:"".concat(c.Ph," ").concat(W.employeeId?"border-[1px] ":"border-gray-300"),placeholder:"Select Employee"}))}}),W.employeeId&&(0,A.jsx)("p",{className:"text-red-500 text-sm",children:W.employeeId.message})]}),"bank"===U("paymentMode")&&(0,A.jsxs)("div",{className:"",children:[(0,A.jsxs)("label",{className:"".concat(c.Q0),children:["Transaction No",(0,A.jsx)("span",{className:"text-red-600",children:"*"})]}),(0,A.jsx)("input",(0,n.A)((0,n.A)({type:"text"},$("transactionNo",{required:"transaction No is required"})),{},{className:" ".concat(c.Ol," ").concat(W.transactionNo?"border-[1px] ":"border-gray-300"),placeholder:"Enter transaction no"})),W.transactionNo&&(0,A.jsx)("p",{className:"text-red-500 text-sm",children:W.transactionNo.message})]})]}),(0,A.jsxs)("div",{className:"px-3",children:[(0,A.jsxs)("div",{className:"",children:[(0,A.jsxs)("label",{className:"".concat(c.Q0),children:["Naration",(0,A.jsx)("span",{className:"text-red-600",children:"*"})]}),(0,A.jsx)("textarea",(0,n.A)((0,n.A)({},$("naration",{required:"Naration is required"})),{},{className:" ".concat(c.Ol," ").concat(W.naration?"border-[1px] ":"border-gray-300"),placeholder:"Enter Naration"})),W.naration&&(0,A.jsx)("p",{className:"text-red-500 text-sm",children:W.naration.message})]}),(0,A.jsxs)("div",{children:[(0,A.jsx)("label",{className:"".concat(c.Q0),children:"Payment Date"}),(0,A.jsx)(d.xI,{name:"date",control:J,render:e=>{let{field:a}=e;return(0,A.jsx)(y.A,{field:a,errors:W})}}),W.date&&(0,A.jsx)("p",{className:"text-red-500 text-sm",children:"Date is required"})]}),(0,A.jsx)("div",{className:"pt-4",children:(0,A.jsxs)("div",{className:"space-y-4",children:[(0,A.jsx)("input",{type:"file",onChange:e=>{const a=e.target.files[0];if(a){e.target.value=null;const l={filePath:a,isVideo:!1,isMultiple:!1};O((0,m.Sg)(l)).then(e=>{var a;null!==e&&void 0!==e&&null!==(a=e.payload)&&void 0!==a&&a.data&&R(a=>{var l;return[...a,null===(l=e.payload)||void 0===l?void 0:l.data]})})}},className:"hidden",id:"file-upload"}),(0,A.jsxs)("label",{htmlFor:"file-upload",className:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white cursor-pointer",children:[(0,A.jsx)(g.chT,{className:"mr-2"})," Add Attachments"]}),(0,A.jsx)("div",{className:"space-y-2",children:null===Z||void 0===Z?void 0:Z.map((e,a)=>(0,A.jsxs)("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded-md",children:[(0,A.jsxs)("a",{href:"".concat("https://vigapi.vigorousit.com","/public/").concat(e),className:"flex items-center space-x-2",target:"_blank",rel:"noopener noreferrer",children:[(0,A.jsx)(g.chT,{className:"text-gray-500"}),(0,A.jsx)("span",{className:"text-sm text-gray-600",children:e})]}),(0,A.jsx)("button",{type:"button",onClick:()=>(e=>{R(a=>a.filter((a,l)=>l!==e))})(a),className:"text-red-500 hover:text-red-700",children:(0,A.jsx)(g.QCr,{})})]},a))})]})})]})]}),(0,A.jsx)("div",{className:"flex justify-end m-2",children:(0,A.jsx)("button",{type:"submit",disabled:_,className:"".concat(_?"bg-gray-400":"bg-header"," text-white p-2 px-4 rounded"),children:_?(0,A.jsx)(f.A,{}):"Submit"})})]})})})}}}]);
//# sourceMappingURL=2774.a0a1fd48.chunk.js.map