"use strict";(self.webpackChunkca_admin=self.webpackChunkca_admin||[]).push([[963],{16973:(e,a,o)=>{o.d(a,{A:()=>T});var t=o(89379),n=o(24858),i=o(83003),l=o(65043),d=o(66015),s=o(60446),r=o.n(s),c=o(53913),u=o(64656),m=o(13382),v=o(89073),h=o(58168);const p={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M400 317.7h73.9V656c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V317.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 163a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"upload",theme:"outlined"};var x=o(22172),g=function(e,a){return l.createElement(x.A,(0,h.A)({},e,{ref:a,icon:p}))};const y=l.forwardRef(g);var f=o(61966),j=o(15187),b=o(78729),w=o(88967),N=o(31536),A=o(27810),k=o(31744),I=o(73216),O=o(94084),S=o(17995),P=o(70579);const T=e=>{let{visible:a,onCancel:o,onSuccess:s}=e;const{register:h,handleSubmit:p,control:x,watch:g,formState:{errors:T},setValue:D,reset:L}=(0,n.mN)(),C=(0,i.wA)(),E=((0,I.Zp)(),JSON.parse(localStorage.getItem("user_info_".concat(j.AU)))),{expenseTypeList:G}=(0,i.d4)(e=>e.expenceHead),M=(0,n.FH)({control:x,name:"PDCompanyId",defaultValue:""}),V=(0,n.FH)({control:x,name:"PDBranchId",defaultValue:""}),{loading:_}=(0,i.d4)(e=>e.cashbook),[H,q]=(0,l.useState)([]);(0,l.useEffect)(()=>{(M||"company"===(null===E||void 0===E?void 0:E.userType)||"companyDirector"===(null===E||void 0===E?void 0:E.userType))&&C((0,k.d0)({text:"",sort:!0,status:!0,isPagination:!1,companyId:"admin"===(null===E||void 0===E?void 0:E.userType)?M:"company"===(null===E||void 0===E?void 0:E.userType)?null===E||void 0===E?void 0:E._id:null===E||void 0===E?void 0:E.companyId}))},[M]),(0,l.useEffect)(()=>{"admin"===(null===E||void 0===E?void 0:E.userType)&&C((0,b.Ar)({text:"",sort:!0,status:!0,isPagination:!1}))},[]),(0,l.useEffect)(()=>{D("totalAmount",Number(g("amount"))+Number(g("gstAmount")))},[g("amount"),g("gstAmount")]);const B=e=>{q(H.filter(a=>a.uid!==e.uid))};return(0,P.jsx)(c.A,{title:"Create Employee Cashbook",visible:null===a||void 0===a?void 0:a.isOpen,onCancel:o,footer:null,width:800,className:"antmodalclassName",children:(0,P.jsxs)("form",{autoComplete:"off",className:"mt-2 md:px-1",onSubmit:p(e=>{var t,n,i,l,d,r;const c={companyId:null===a||void 0===a||null===(t=a.data)||void 0===t?void 0:t.companyId,directorId:null===a||void 0===a||null===(n=a.data)||void 0===n?void 0:n.directorId,branchId:null===a||void 0===a||null===(i=a.data)||void 0===i?void 0:i.branchId,employeId:Array.isArray(null===a||void 0===a||null===(l=a.data)||void 0===l?void 0:l.employeIds)&&(null===a||void 0===a?void 0:a.data.employeIds.length)>0?null===a||void 0===a?void 0:a.data.employeIds[0]:null,expenseTypeId:null===e||void 0===e||null===(d=e.expencehead)||void 0===d?void 0:d.value,expenseFor:"Employe",amount:+(null===e||void 0===e?void 0:e.amount),naration:null===e||void 0===e?void 0:e.naration,GSTamount:0,totalAmount:+(null===e||void 0===e?void 0:e.amount),date:null===e||void 0===e?void 0:e.date,status:"Pending",attachment:H.map(e=>e.uid),visitorId:null===a||void 0===a||null===(r=a.data)||void 0===r?void 0:r._id};C((0,A.pn)(c)).then(e=>{e.error||(s(),o(),L())})}),children:[(0,P.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 md:gap-4 gap-2 md:my-1 px-3 md:mt-4",children:[(0,P.jsxs)("div",{className:"w-full",children:[(0,P.jsx)("label",{className:"".concat(j.Q0),children:"Expence Head"}),(0,P.jsx)(n.xI,{name:"expencehead",control:x,rules:{required:"Expence Head is required"},render:e=>{let{field:a}=e;return(0,P.jsx)(d.Ay,(0,t.A)((0,t.A)({menuPortalTarget:document.body,menuPosition:"fixed",styles:{menuPortal:e=>(0,t.A)((0,t.A)({},e),{},{zIndex:9999})},onFocus:()=>{const e={directorId:"",companyId:"admin"===(null===E||void 0===E?void 0:E.userType)?M:"company"===(null===E||void 0===E?void 0:E.userType)?null===E||void 0===E?void 0:E._id:null===E||void 0===E?void 0:E.companyId,branchId:"company"===(null===E||void 0===E?void 0:E.userType)||"admin"===(null===E||void 0===E?void 0:E.userType)||"companyDirector"===(null===E||void 0===E?void 0:E.userType)?V:"companyBranch"===(null===E||void 0===E?void 0:E.userType)?null===E||void 0===E?void 0:E._id:null===E||void 0===E?void 0:E.branchId,text:"",sort:!0,status:"",isPagination:!1};C((0,N.dV)(e))}},a),{},{options:null===G||void 0===G?void 0:G.map(e=>({value:null===e||void 0===e?void 0:e._id,label:null===e||void 0===e?void 0:e.name})),classNamePrefix:"react-select",className:"".concat(j.Ph," ").concat(T.expencehead?"border-[1px] ":"border-gray-300"),placeholder:"Select Expence Head"}))}}),T.expencehead&&(0,P.jsx)("p",{className:"text-red-500 text-sm",children:T.expencehead.message})]}),(0,P.jsxs)("div",{className:"",children:[(0,P.jsxs)("label",{className:"".concat(j.Q0),children:["Amount ",(0,P.jsx)("span",{className:"text-red-600",children:"*"})]}),(0,P.jsx)("input",(0,t.A)((0,t.A)({type:"number",step:"0.01"},h("amount",{required:"Amount is required"})),{},{className:" ".concat(j.Ol," ").concat(T.amount?"border-[1px] ":"border-gray-300"),placeholder:"Enter Amount"})),T.amount&&(0,P.jsx)("p",{className:"text-red-500 text-sm",children:T.amount.message})]}),(0,P.jsxs)("div",{className:"",children:[(0,P.jsxs)("label",{className:"".concat(j.Q0),children:["Naration ",(0,P.jsx)("span",{className:"text-red-600",children:"*"})]}),(0,P.jsx)("textarea",(0,t.A)((0,t.A)({},h("naration",{required:"Naration is required"})),{},{className:" ".concat(j.Ol," ").concat(T.naration?"border-[1px] ":"border-gray-300"),placeholder:"Enter Naration"})),T.naration&&(0,P.jsx)("p",{className:"text-red-500 text-sm",children:T.naration.message})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)("label",{className:"".concat(j.Q0),children:"Bill Date"}),(0,P.jsx)(n.xI,{name:"date",control:x,render:e=>{let{field:a}=e;return(0,P.jsx)(O.A,{field:a,errors:T,disabledDate:e=>{if(!e)return!0;const a=r()().startOf("day"),o=e.startOf("day");if(a.date()<=5){const e=a.subtract(1,"month"),t=e.endOf("month").startOf("day"),n=e.date(t.date()-4).startOf("day"),i=(o.isAfter(n)||o.isSame(n))&&(o.isBefore(t)||o.isSame(t)),l=a.startOf("month"),d=(o.isAfter(l)||o.isSame(l))&&(o.isBefore(a)||o.isSame(a));return!(i||d)}{const e=a.startOf("month");return!((o.isAfter(e)||o.isSame(e))&&(o.isBefore(a)||o.isSame(a)))}}})}}),T.date&&(0,P.jsx)("p",{className:"text-red-500 text-sm",children:"Date is required"})]}),(0,P.jsxs)("div",{className:"",children:[(0,P.jsx)(u.A,{fileList:H,beforeUpload:async e=>{const a={filePath:e,isVideo:!1,isMultiple:!1};try{var o;const t=await C((0,w.Sg)(a));return null!==t&&void 0!==t&&null!==(o=t.payload)&&void 0!==o&&o.data&&q(a=>[...a,{uid:t.payload.data,name:e.name,status:"done",url:"".concat("https://vigapi.vigorousit.com","/public/").concat(t.payload.data)}]),!1}catch(t){return console.error("Upload failed:",t),!1}},onRemove:B,multiple:!0,children:(0,P.jsx)(m.Ay,{icon:(0,P.jsx)(y,{}),children:"Upload Documents"})}),(0,P.jsx)("div",{className:"mt-2 space-y-2",children:null===H||void 0===H?void 0:H.map(e=>(0,P.jsx)(v.A,{size:"small",actions:[(0,P.jsx)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",children:"View"}),(0,P.jsx)(f.A,{onClick:()=>B(e)})],children:(0,P.jsx)(v.A.Meta,{title:e.name})},e.uid))})]})]}),(0,P.jsx)("div",{className:"flex justify-end",children:(0,P.jsx)("button",{type:"submit",disabled:_,className:"".concat(_?"bg-gray-400":"bg-header"," text-white p-2 px-4 rounded"),children:_?(0,P.jsx)(S.A,{}):"Submit"})})]})})}},21541:(e,a,o)=>{o.d(a,{Aw:()=>y,Ay:()=>x,Lu:()=>g});var t=o(89379),n=o(53986),i=o(13382),l=o(53913),d=o(24858),s=o(8873),r=o(83003),c=o(15187),u=o(58215),m=o(60446),v=o.n(m),h=o(70579);const p=["date","checkInTime","checkOutTime","timeDurationStart","timeDurationEnd"],x=e=>{var a;let{setVisitorModal:o,visitorModal:s,updateList:m}=e;const{control:x,handleSubmit:f,setValue:j,formState:{errors:b},reset:w,register:N}=(0,d.mN)(),A=null!==(a=null===s||void 0===s?void 0:s.data)&&void 0!==a?a:null,k=(0,r.wA)();return(0,h.jsx)(l.A,{className:"antmodalclassName",title:"Visitor Request",width:600,height:400,open:null===s||void 0===s?void 0:s.isOpen,onCancel:()=>o({data:null,isOpen:!1}),footer:[],children:(0,h.jsx)("div",{children:(0,h.jsx)("div",{className:"grid grid-col-1  gap-4",children:(0,h.jsxs)("form",{onSubmit:f(async e=>{var a,i;const{date:l,checkInTime:d,checkOutTime:s,timeDurationStart:r,timeDurationEnd:c}=A,h=(0,n.A)(A,p),x=await g(),f=await y(null===x||void 0===x?void 0:x.lat,null===x||void 0===x?void 0:x.lng),b=(0,t.A)((0,t.A)({},h),{},{checkOutTime:v()(),checkOutLocation:{latitude:null!==(a=null===x||void 0===x?void 0:x.lat)&&void 0!==a?a:0,longitude:null!==(i=x.lng)&&void 0!==i?i:0,address:null!==f&&void 0!==f?f:""},kilometer:Number(null===e||void 0===e?void 0:e.km)});k((0,u.o2)(b)).then(e=>{e.error||j("km",null),o({data:null,isOpen:!1}),m()})}),children:[(0,h.jsxs)("div",{className:"",children:[(0,h.jsxs)("label",{className:"".concat(c.Q0),children:["Km ",(0,h.jsx)("span",{className:"text-red-600",children:"*"})]}),(0,h.jsx)("input",(0,t.A)((0,t.A)({type:"number"},N("km",{})),{},{className:"placeholder: ".concat(c.Ol," ").concat(b.km?"border-[1px] ":"border-gray-300"),placeholder:"Enter Km"})),b.km&&(0,h.jsx)("p",{className:"text-red-500 text-sm",children:b.km.message})]}),(0,h.jsx)("div",{className:"flex justify-end items-center m-2",children:(0,h.jsx)(i.Ay,{type:"primary",htmlType:"submit",children:"Check out"},"checkin")})]})})})})},g=async()=>{if(!navigator.geolocation)throw(0,s.D)({message:"Geolocation is not supported by your browser",type:"error"}),new Error("Geolocation not supported");try{const e=await new Promise((e,a)=>{navigator.geolocation.getCurrentPosition(e,a,{enableHighAccuracy:!0,timeout:15e3,maximumAge:0})}),{latitude:a,longitude:o,accuracy:t}=e.coords;if(t>200){(0,s.D)({message:"Low GPS accuracy. For better results, enable GPS in device settings.",type:"warning"});if(!await new Promise(e=>{l.A.confirm({title:"Low GPS Accuracy",content:"Your location accuracy is low (".concat(Math.round(t)," meters). Do you want to continue anyway?"),okText:"Yes, continue",cancelText:"Cancel",onOk:()=>e(!0),onCancel:()=>e(!1)})}))return null}return{lat:a,lng:o,accuracy:t,timestamp:e.timestamp,isFresh:Date.now()-e.timestamp<3e4}}catch(a){console.warn("Primary geolocation failed:",a);try{var e;const a=await(null===(e=navigator.permissions)||void 0===e?void 0:e.query({name:"geolocation"}));if("granted"===(null===a||void 0===a?void 0:a.state)){const e="AIzaSyBvvP_yGYoHaxiANhSQYVNUcTuORGx3kRU";if(!e)throw new Error("Missing Google Maps API key");const a=await fetch("https://www.googleapis.com/geolocation/v1/geolocate?key=".concat(e),{method:"POST"}),o=await a.json();if(o.location)return(0,s.D)({message:"Using network-based location (enable GPS for higher accuracy)",type:"info"}),{lat:o.location.lat,lng:o.location.lng,accuracy:o.accuracy||1e3,isApproximate:!0}}}catch(o){console.error("Fallback failed:",o)}throw(0,s.D)({message:"Location not available. Please enable location services in your browser or device settings.",type:"error"}),new Error("Location access failed")}},y=async(e,a)=>new Promise((o,t)=>{if(!window.google||!window.google.maps||!window.google.maps.Geocoder)return console.error("Google Maps API is not loaded properly."),void t("Google Maps API is not loaded properly.");(new window.google.maps.Geocoder).geocode({location:{lat:e,lng:a}},(e,a)=>{"OK"===a&&e[0]?o(e[0].formatted_address):t("Geocoder failed due to: ".concat(a))})})},51371:(e,a,o)=>{o.d(a,{A:()=>d});var t=o(79942),n=o(53913),i=o(3825),l=o(70579);const d=e=>{var a,o,d,s,r,c,u,m,v,h;let{empDetailModalData:p,empCheckInDetailModalOpen:x,checkIn:g,setEmpCheckinDetailModalOpen:y}=e;return(0,l.jsxs)(n.A,{className:"antmodalclassName sm:!w-[60%] !w-[100%] !h-[50%]",title:"",open:x,onCancel:()=>y(!1),footer:null,children:[(0,l.jsx)("div",{className:"flex justify-between items-center mb-4",children:(0,l.jsxs)("table",{className:"w-full rounded-lg shadow-md overflow-hidden bg-white",children:[(0,l.jsx)("thead",{children:(0,l.jsx)("tr",{children:(0,l.jsx)("th",{className:"text-header",children:(0,l.jsx)("div",{className:"mt-2 ml-2",children:" "})})})}),(0,l.jsx)("tbody",{className:"text-sm text-gray-700",children:(0,l.jsx)("tr",{className:"hover:bg-indigo-50",children:(0,l.jsxs)("td",{className:"p-3 text-gray-600",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(i.cC2,{className:"size-4 text-header text-lg"}),(0,l.jsx)("span",{className:"text-[16px] font-medium",children:"Address"})]}),(0,l.jsx)("span",{className:"block text-[15px] ml-4 font-light mt-1",children:("checkin"===g?null===p||void 0===p||null===(a=p.checkInLocation)||void 0===a?void 0:a.address:null===p||void 0===p||null===(o=p.checkOutLocation)||void 0===o?void 0:o.address)||"N/A"})]})})})]})}),(0,l.jsx)("div",{className:"h-[400px] w-full rounded-lg overflow-hidden shadow-md",children:p&&(0,l.jsx)(t.u6,{mapContainerStyle:{width:"100%",height:"400px"},center:{lat:"checkin"===g?null===p||void 0===p||null===(d=p.checkInLocation)||void 0===d?void 0:d.latitude:null===p||void 0===p||null===(s=p.checkOutLocation)||void 0===s?void 0:s.latitude,lng:"checkin"===g?null===p||void 0===p||null===(r=p.checkInLocation)||void 0===r?void 0:r.longitude:null===p||void 0===p||null===(c=p.checkOutLocation)||void 0===c?void 0:c.longitude},zoom:15,children:(0,l.jsx)(t.pH,{position:{lat:"checkin"===g?null===p||void 0===p||null===(u=p.checkInLocation)||void 0===u?void 0:u.latitude:null===p||void 0===p||null===(m=p.checkOutLocation)||void 0===m?void 0:m.latitude,lng:"checkin"===g?null===p||void 0===p||null===(v=p.checkInLocation)||void 0===v?void 0:v.longitude:null===p||void 0===p||null===(h=p.checkOutLocation)||void 0===h?void 0:h.longitude}})})})]})}}}]);
//# sourceMappingURL=963.7b5f5a5e.chunk.js.map